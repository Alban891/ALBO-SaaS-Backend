<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary: #4f46e5;
        --primary-dark: #4338ca;
        --secondary: #06b6d4;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #1e293b;
        --gray: #64748b;
        --light: #f1f5f9;
        --white: #ffffff;
        --border: #e2e8f0;
        --shadow: 0 1px 3px rgba(0,0,0,0.12);
        --shadow-lg: 0 10px 40px rgba(0,0,0,0.15);
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* Loading Screen */
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: opacity 0.5s;
    }

    .loading-content {
        text-align: center;
        color: white;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255,255,255,0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Header */
    .header {
        background: rgba(255, 255, 255, 0.98);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        transition: all 0.3s ease;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        max-width: 1600px;
        margin: 0 auto;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 24px;
        font-weight: bold;
        color: var(--primary);
    }

    .mode-switcher {
        display: flex;
        gap: 10px;
        background: var(--light);
        padding: 5px;
        border-radius: 12px;
    }

    .mode-btn {
        padding: 10px 20px;
        border: none;
        background: transparent;
        color: var(--gray);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .mode-btn.active {
        background: var(--white);
        color: var(--primary);
        box-shadow: 0 2px 10px rgba(79, 70, 229, 0.2);
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .notification-badge {
        position: relative;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .notification-badge:hover {
        background: var(--light);
    }

    .badge-count {
        position: absolute;
        top: 5px;
        right: 5px;
        background: var(--danger);
        color: white;
        font-size: 10px;
        padding: 2px 5px;
        border-radius: 10px;
        font-weight: bold;
    }

    /* Main Container */
    .main-container {
        margin-top: 80px;
        padding: 2rem;
        max-width: 1600px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Mode Content */
    .mode-content {
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .mode-content.active {
        display: block;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Executive View Styles */
    .executive-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .kpi-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .kpi-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }

    .kpi-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .kpi-label {
        color: var(--gray);
        font-size: 14px;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .kpi-value {
        font-size: 32px;
        font-weight: bold;
        color: var(--dark);
        margin-bottom: 8px;
    }

    .kpi-change {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }

    .kpi-change.positive {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .kpi-change.negative {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
    }

    /* Team View Styles */
    .team-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .agent-card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .agent-card:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .agent-avatar {
        font-size: 48px;
        margin-bottom: 10px;
    }

    .agent-name {
        font-weight: bold;
        color: var(--dark);
        margin-bottom: 5px;
    }

    .agent-status {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
    }

    .status-online {
        background: var(--success);
        animation: pulse 2s infinite;
    }

    .status-busy {
        background: var(--warning);
    }

    .status-offline {
        background: var(--gray);
    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
        }
    }

    .agent-tasks {
        color: var(--gray);
        font-size: 12px;
    }

    /* Team Chat */
    .team-chat {
        background: white;
        border-radius: 16px;
        padding: 20px;
        height: 400px;
        display: flex;
        flex-direction: column;
    }

    .chat-header {
        font-weight: bold;
        color: var(--dark);
        padding-bottom: 15px;
        border-bottom: 1px solid var(--light);
        margin-bottom: 15px;
    }

    .chat-messages {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 15px;
    }

    .chat-message {
        margin-bottom: 15px;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .message-author {
        font-weight: 600;
        color: var(--primary);
        font-size: 14px;
        margin-bottom: 4px;
    }

    .message-content {
        background: var(--light);
        padding: 10px 15px;
        border-radius: 12px;
        font-size: 14px;
        color: var(--dark);
    }

    .message-time {
        font-size: 11px;
        color: var(--gray);
        margin-top: 4px;
    }

    /* Workflow View */
    .workflow-container {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
    }

    .workflow-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    .workflow-title {
        font-size: 24px;
        font-weight: bold;
        color: var(--dark);
    }

    .workflow-item {
        background: var(--light);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        transition: all 0.3s ease;
    }

    .workflow-item:hover {
        background: white;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .workflow-name {
        font-weight: bold;
        color: var(--dark);
        margin-bottom: 10px;
        font-size: 18px;
    }

    .workflow-progress {
        background: #e0e0e0;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        margin: 15px 0;
    }

    .workflow-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: 4px;
        transition: width 0.5s ease;
        position: relative;
        overflow: hidden;
    }

    .workflow-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.3),
            transparent
        );
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% {
            transform: translateX(-100%);
        }
        100% {
            transform: translateX(100%);
        }
    }

    .workflow-stats {
        display: flex;
        justify-content: space-between;
        color: var(--gray);
        font-size: 14px;
    }

    /* M&A Specific Styles */
    .ma-phase-card {
        min-width: 250px;
        background: rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .ma-phase-card:hover {
        background: rgba(255,255,255,0.2);
        transform: translateY(-2px);
    }

    .ma-phase-card h4 {
        margin: 0 0 10px 0;
        color: white;
    }

    .ma-phase-card p {
        font-size: 12px;
        opacity: 0.9;
        color: white;
        margin: 0 0 10px 0;
    }

    .ma-phase-card button {
        width: 100%;
        background: rgba(255,255,255,0.2);
        border: 1px solid rgba(255,255,255,0.3);
        color: white;
        padding: 8px;
        border-radius: 6px;
        cursor: pointer;
    }

    .ma-phase-card button:hover {
        background: rgba(255,255,255,0.3);
    }

    /* Legacy View (Original Dashboard) */
    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .category-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        transition: all 0.3s;
        cursor: pointer;
    }

    .category-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .category-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 18px;
        font-weight: 600;
    }

    .category-icon {
        font-size: 24px;
    }

    .category-count {
        background: var(--light);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        color: var(--primary);
        font-weight: 600;
    }

    .prompt-list {
        display: none;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
    }

    .category-card.expanded .prompt-list {
        display: block;
    }

    .prompt-item {
        padding: 12px;
        margin-bottom: 10px;
        background: var(--light);
        border-radius: 10px;
        transition: all 0.3s;
    }

    .prompt-item:hover {
        background: linear-gradient(135deg, rgba(79,70,229,0.1), rgba(139,92,246,0.1));
    }

    .prompt-title {
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--dark);
    }

    .prompt-description {
        font-size: 14px;
        color: #64748b;
        margin-bottom: 8px;
    }

    .prompt-tags {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    .tag {
        padding: 2px 8px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 12px;
        color: #64748b;
    }

    .complexity-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 8px;
    }

    .complexity-low {
        background: #d1fae5;
        color: #065f46;
    }

    .complexity-medium {
        background: #fed7aa;
        color: #9a3412;
    }

    .complexity-high {
        background: #fecaca;
        color: #991b1b;
    }

    /* Execute Button */
    .execute-btn {
        margin-top: 10px;
        padding: 8px 16px;
        background: linear-gradient(135deg, var(--success), #059669);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .execute-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16,185,129,0.3);
    }

    /* Decision Cards */
    .decision-container {
        background: white;
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
    }

    .decision-header {
        font-size: 20px;
        font-weight: bold;
        color: var(--dark);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .decision-item {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(245, 158, 11, 0.05));
        border-left: 4px solid var(--warning);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .decision-content {
        flex: 1;
    }

    .decision-title {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 5px;
    }

    .decision-desc {
        color: var(--gray);
        font-size: 14px;
    }

    .decision-actions {
        display: flex;
        gap: 10px;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
    }

    .btn-approve {
        background: var(--success);
        color: white;
    }

    .btn-approve:hover {
        background: #059669;
        transform: translateY(-2px);
    }

    .btn-delegate {
        background: var(--primary);
        color: white;
    }

    .btn-delegate:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }

    .btn-primary {
        padding: 10px 24px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-secondary {
        padding: 10px 24px;
        background: var(--light);
        color: var(--dark);
        border: 2px solid var(--border);
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    /* Activity Feed */
    .activity-feed {
        background: white;
        border-radius: 16px;
        padding: 20px;
        max-height: 500px;
        overflow-y: auto;
    }

    .activity-header {
        font-weight: bold;
        color: var(--dark);
        margin-bottom: 20px;
        font-size: 18px;
    }

    .activity-item {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--light);
    }

    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;
    }

    .activity-icon.success {
        background: rgba(16, 185, 129, 0.1);
    }

    .activity-icon.warning {
        background: rgba(245, 158, 11, 0.1);
    }

    .activity-icon.info {
        background: rgba(6, 182, 212, 0.1);
    }

    .activity-content {
        flex: 1;
    }

    .activity-title {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 4px;
    }

    .activity-desc {
        color: var(--gray);
        font-size: 14px;
        margin-bottom: 4px;
    }

    .activity-time {
        color: var(--gray);
        font-size: 12px;
    }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 16px;
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 20px;
        font-weight: 600;
    }

    .close-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: none;
        background: var(--light);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        transition: all 0.3s;
    }

    .close-btn:hover {
        background: var(--danger);
        color: white;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .context-input {
        width: 100%;
        min-height: 100px;
        padding: 12px;
        border: 2px solid var(--border);
        border-radius: 10px;
        font-size: 14px;
        resize: vertical;
        margin-bottom: 1rem;
    }

    .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }

    /* AI Response */
    .ai-response {
        display: none;
        margin-top: 1.5rem;
        padding: 1rem;
        background: linear-gradient(135deg, rgba(79,70,229,0.05), rgba(139,92,246,0.05));
        border-radius: 10px;
        border-left: 4px solid var(--primary);
    }

    .ai-response.active {
        display: block;
    }

    .response-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--primary);
    }

    .response-content {
        color: var(--dark);
        line-height: 1.6;
    }

    /* Quick Actions FAB */
    .quick-actions {
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 100;
    }

    .fab {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(79, 70, 229, 0.3);
        transition: all 0.3s ease;
    }

    .fab:hover {
        transform: scale(1.1) rotate(90deg);
        box-shadow: 0 8px 30px rgba(79, 70, 229, 0.4);
    }

    /* Grid Layout for Executive View */
    .executive-layout {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
    }

    .main-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .side-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* Notion Prompts Section */
    #notion-prompts-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 30px;
        margin: 20px 0;
        border-radius: 16px;
        color: white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    /* Role Selector für Legacy View */
    .role-selector {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-lg);
    }

    .role-tabs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .role-tab {
        padding: 12px 24px;
        border: 2px solid var(--border);
        border-radius: 12px;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
    }

    .role-tab:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    .role-tab.active {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border-color: var(--primary);
    }

    .role-description {
        padding: 1rem;
        background: var(--light);
        border-radius: 8px;
        margin-top: 1rem;
    }

    /* Search & Filter */
    .search-section {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-lg);
    }

    .search-container {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .search-input {
        flex: 1;
        padding: 12px 20px;
        border: 2px solid var(--border);
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .search-btn {
        padding: 12px 30px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s;
    }

    .search-btn:hover {
        transform: translateY(-2px);
    }

    .filter-chips {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .chip {
        padding: 6px 16px;
        background: var(--light);
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
    }

    .chip:hover {
        border-color: var(--primary);
    }

    .chip.active {
        background: var(--primary);
        color: white;
    }

    /* Notification Toast */
    .notification-toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        padding: 15px 20px;
        background: var(--success);
        color: white;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        z-index: 10000;
        font-weight: 500;
        animation: slideInRight 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .executive-layout {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            gap: 15px;
        }

        .mode-switcher {
            width: 100%;
            justify-content: center;
        }

        .executive-grid,
        .team-grid {
            grid-template-columns: 1fr;
        }

        .main-container {
            padding: 1rem;
        }

        .categories-grid {
            grid-template-columns: 1fr;
        }
        
        .role-tabs {
            flex-direction: column;
        }
    }
</style>
<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo">
            <span>🚀</span>
            <span>ALBO AI</span>
        </div>
        
        <div class="mode-switcher">
            <button class="mode-btn active" onclick="switchMode('executive')">
                <span>📊</span>
                <span>Executive</span>
            </button>
            <button class="mode-btn" onclick="switchMode('team')">
                <span>👥</span>
                <span>Team</span>
            </button>
            <button class="mode-btn" onclick="switchMode('workflow')">
                <span>⚡</span>
                <span>Workflows</span>
            </button>
            <button class="mode-btn" onclick="switchMode('prompts')">
                <span>📚</span>
                <span>Prompts</span>
            </button>
            <button class="mode-btn" onclick="switchMode('sap')">
                <span>🔗</span>
                <span>SAP</span>
            </button>
        </div>
        
        <div class="header-actions">
            <button class="notification-badge" onclick="checkForEmails()">
                <span>📧</span>
                <span class="badge-count" id="emailCount">0</span>
            </button>
            <div class="notification-badge">
                <span>🔔</span>
                <span class="badge-count">3</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>👤</span>
                <span style="font-weight: 600;">CFO</span>
            </div>
        </div>
    </div>
</header>

<!-- Main Container -->
<div class="main-container">
    
    <!-- Executive View -->
    <div class="mode-content active" id="executive-view">
        <!-- Notion Prompts Section (wenn geladen) -->
        <div id="notion-prompts-section" style="display: none;"></div>
        
        <div class="executive-layout">
            <div class="main-section">
                <!-- KPI Cards -->
                <div class="executive-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">Umsatz YTD</div>
                        <div class="kpi-value">€12.4M</div>
                        <div class="kpi-change positive">
                            <span>↑</span>
                            <span>23% vs VJ</span>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">EBITDA</div>
                        <div class="kpi-value">€2.3M</div>
                        <div class="kpi-change positive">
                            <span>↑</span>
                            <span>18% vs Plan</span>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">Cash Position</div>
                        <div class="kpi-value">€4.7M</div>
                        <div class="kpi-change negative">
                            <span>↓</span>
                            <span>5% vs Vormonat</span>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">Working Capital</div>
                        <div class="kpi-value">€1.2M</div>
                        <div class="kpi-change positive">
                            <span>↑</span>
                            <span>Optimiert</span>
                        </div>
                    </div>
                </div>

                <!-- Agent Performance -->
                <div class="workflow-container">
                    <div class="workflow-header">
                        <div class="workflow-title">🤖 Agent Performance Today</div>
                    </div>
                    
                    <div class="executive-grid">
                        <div class="kpi-card">
                            <div class="kpi-label">Aktive Agenten</div>
                            <div class="kpi-value">11/11</div>
                            <div class="kpi-change positive">
                                <span>●</span>
                                <span>Alle Online</span>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label">Tasks Completed</div>
                            <div class="kpi-value">1,247</div>
                            <div class="kpi-change positive">
                                <span>↑</span>
                                <span>99.7% Success</span>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label">Zeit gespart</div>
                            <div class="kpi-value">147h</div>
                            <div class="kpi-change positive">
                                <span>⚡</span>
                                <span>Diese Woche</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="side-section">
                <!-- Critical Decisions -->
                <div class="decision-container">
                    <div class="decision-header">
                        <span>⚠️</span>
                        <span>Kritische Entscheidungen</span>
                    </div>
                    
                    <div class="decision-item">
                        <div class="decision-content">
                            <div class="decision-title">Investment Freigabe</div>
                            <div class="decision-desc">€2M für neue Produktionslinie</div>
                        </div>
                        <div class="decision-actions">
                            <button class="btn btn-approve" onclick="handleDecision('approve')">Freigeben</button>
                            <button class="btn btn-delegate" onclick="handleDecision('delegate')">Delegieren</button>
                        </div>
                    </div>
                    
                    <div class="decision-item">
                        <div class="decision-content">
                            <div class="decision-title">Kreditlinie Erhöhung</div>
                            <div class="decision-desc">Treasury empfiehlt +€3M</div>
                        </div>
                        <div class="decision-actions">
                            <button class="btn btn-approve" onclick="handleDecision('approve')">Freigeben</button>
                            <button class="btn btn-delegate" onclick="handleDecision('delegate')">Analyse</button>
                        </div>
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="activity-feed">
                    <div class="activity-header">📈 Live Activity</div>
                    
                    <div class="activity-item">
                        <div class="activity-icon success">✓</div>
                        <div class="activity-content">
                            <div class="activity-title">Monatsabschluss Oktober</div>
                            <div class="activity-desc">Controller Agent: Abgeschlossen</div>
                            <div class="activity-time">vor 5 Minuten</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon warning">!</div>
                        <div class="activity-content">
                            <div class="activity-title">Liquiditätswarnung</div>
                            <div class="activity-desc">Treasury: Engpass in 30 Tagen möglich</div>
                            <div class="activity-time">vor 12 Minuten</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon info">📧</div>
                        <div class="activity-content">
                            <div class="activity-title">234 Rechnungen verarbeitet</div>
                            <div class="activity-desc">Kreditor Agent: Skonto €4,500 realisiert</div>
                            <div class="activity-time">vor 23 Minuten</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team View -->
    <div class="mode-content" id="team-view">
        <h2 style="color: white; margin-bottom: 30px;">Mein Finance Team - 11 KI-Agenten</h2>
        
        <div class="team-grid">
            <div class="agent-card" onclick="selectAgent('CFO')">
                <div class="agent-avatar">👔</div>
                <div class="agent-name">CFO</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">5 Entscheidungen</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Controller')">
                <div class="agent-avatar">📊</div>
                <div class="agent-name">Controller</div>
                <div><span class="agent-status status-busy"></span>Working</div>
                <div class="agent-tasks">23 Reports</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Treasury')">
                <div class="agent-avatar">🏦</div>
                <div class="agent-name">Treasury</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Cash Forecast</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Bilanzbuchhalter')">
                <div class="agent-avatar">📚</div>
                <div class="agent-name">Bilanz</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Monatsabschluss</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Kreditor')">
                <div class="agent-avatar">💳</div>
                <div class="agent-name">Kreditor</div>
                <div><span class="agent-status status-busy"></span>Busy</div>
                <div class="agent-tasks">47 Rechnungen</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Debitor')">
                <div class="agent-avatar">💰</div>
                <div class="agent-name">Debitor</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Mahnlauf</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Anlagen')">
                <div class="agent-avatar">🏭</div>
                <div class="agent-name">Anlagen</div>
                <div><span class="agent-status status-offline"></span>Idle</div>
                <div class="agent-tasks">AfA berechnet</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Business Dev')">
                <div class="agent-avatar">🚀</div>
                <div class="agent-name">Business Dev</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">M&A Analyse</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('M&A')">
                <div class="agent-avatar">🤝</div>
                <div class="agent-name">M&A Berater</div>
                <div><span class="agent-status status-busy"></span>Analyzing</div>
                <div class="agent-tasks">Due Diligence</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Anwalt')">
                <div class="agent-avatar">⚖️</div>
                <div class="agent-name">Anwalt</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Vertragsreview</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Steuerberater')">
                <div class="agent-avatar">📋</div>
                <div class="agent-name">Steuerberater</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Tax Compliance</div>
            </div>
        </div>

        <!-- Team Chat -->
        <div class="team-chat">
            <div class="chat-header">💬 Team Communication</div>
            <div class="chat-messages" id="chat-messages">
                <div class="chat-message">
                    <div class="message-author">CFO Agent</div>
                    <div class="message-content">Team, bitte Monatsabschluss Oktober priorisieren.</div>
                    <div class="message-time">10:23</div>
                </div>
                
                <div class="chat-message">
                    <div class="message-author">Controller Agent</div>
                    <div class="message-content">Verstanden. Koordiniere mit Buchhaltung. ETA: 4 Stunden.</div>
                    <div class="message-time">10:24</div>
                </div>
                
                <div class="chat-message">
                    <div class="message-author">Kreditor Agent</div>
                    <div class="message-content">47 offene Rechnungen. Benötige Freigabe für 3 über €10k.</div>
                    <div class="message-time">10:25</div>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="teamMessageInput" placeholder="Nachricht an Team..." style="flex: 1; padding: 10px; border: 1px solid var(--light); border-radius: 8px;">
                <button class="btn btn-delegate" onclick="sendTeamMessage()">Senden</button>
            </div>
        </div>
    </div>

    <!-- Workflow View WITH M&A -->
    <div class="mode-content" id="workflow-view">
        
        <!-- M&A INPUT SECTION -->
        <div id="ma-input-section" style="
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        ">
            <h2 style="margin: 0 0 20px 0; color: #333;">📥 M&A Deal Input</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Email Integration Box -->
                <div style="
                    border: 2px dashed #667eea;
                    border-radius: 12px;
                    padding: 30px;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s;
                " onmouseover="this.style.borderColor='#4338ca'; this.style.background='#f8f7ff'" 
                   onmouseout="this.style.borderColor='#667eea'; this.style.background='white'"
                   onclick="checkOutlookEmails()">
                    
                    <div style="font-size: 48px; margin-bottom: 15px;">📧</div>
                    <h3 style="margin: 0 0 10px 0; color: #333;">Email Integration</h3>
                    <p style="color: #666; font-size: 14px; margin: 0 0 15px 0;">
                        Emails aus Outlook mit M&A Dokumenten automatisch verarbeiten
                    </p>
                    <div id="emailStatus" style="
                        background: #f0f0f0;
                        padding: 8px 15px;
                        border-radius: 8px;
                        font-size: 12px;
                        color: #666;
                    ">
                        <span id="emailCountMA">0</span> neue M&A Emails
                    </div>
                </div>
                
                <!-- Manual Upload Box -->
                <div style="
                    border: 2px dashed #10b981;
                    border-radius: 12px;
                    padding: 30px;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s;
                " onmouseover="this.style.borderColor='#059669'; this.style.background='#f0fdf4'" 
                   onmouseout="this.style.borderColor='#10b981'; this.style.background='white'"
                   onclick="openManualUpload()">
                    
                    <div style="font-size: 48px; margin-bottom: 15px;">📁</div>
                    <h3 style="margin: 0 0 10px 0; color: #333;">Manueller Upload</h3>
                    <p style="color: #666; font-size: 14px; margin: 0 0 15px 0;">
                        PDFs, Excel-Files und Case-Beschreibung hochladen
                    </p>
                    <button style="
                        background: linear-gradient(135deg, #10b981, #059669);
                        color: white;
                        border: none;
                        padding: 8px 20px;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                    ">
                        + Dokumente hochladen
                    </button>
                </div>
            </div>
        </div>

        <!-- M&A WORKFLOW PIPELINE -->
        <div class="workflow-container" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
            <div class="workflow-header">
                <div class="workflow-title" style="color: white;">🤝 M&A Deal Pipeline</div>
                <button class="btn" style="background: white; color: #667eea;" onclick="startMADeal()">+ Neuer Deal</button>
            </div>
            
            <!-- M&A Process Steps -->
            <div style="display: flex; gap: 10px; margin-top: 20px; overflow-x: auto; padding: 10px 0;">
                <div class="ma-phase-card" onclick="executeMAPhase('strategic-fit')">
                    <h4>📋 Phase 1: Strategic Fit</h4>
                    <p>Target Screening & Analyse</p>
                    <button>Starten</button>
                </div>
                
                <div class="ma-phase-card" onclick="executeMAPhase('due-diligence')">
                    <h4>🔍 Phase 2: Due Diligence</h4>
                    <p>Financial, Legal, Commercial</p>
                    <button>Starten</button>
                </div>
                
                <div class="ma-phase-card" onclick="executeMAPhase('valuation')">
                    <h4>💰 Phase 3: Valuation</h4>
                    <p>DCF, Multiples, Synergien</p>
                    <button>Starten</button>
                </div>
                
                <div class="ma-phase-card" onclick="executeMAPhase('deal-structure')">
                    <h4>📑 Phase 4: Deal Structure</h4>
                    <p>Terms, Financing, Integration</p>
                    <button>Starten</button>
                </div>
            </div>
        </div>
        
        <!-- Active M&A Deals -->
        <div class="workflow-container">
            <div class="workflow-header">
                <div class="workflow-title">⚡ Aktive M&A Deals</div>
            </div>
            
            <div class="workflow-item">
                <div class="workflow-name">🏢 TechStartup GmbH Acquisition</div>
                <div class="workflow-progress">
                    <div class="workflow-progress-bar" style="width: 35%"></div>
                </div>
                <div class="workflow-stats">
                    <span>Phase 2: Due Diligence läuft...</span>
                    <span>Deal Size: €15-20M</span>
                </div>
            </div>
            
            <div class="workflow-item">
                <div class="workflow-name">🏭 Industrial Corp Merger</div>
                <div class="workflow-progress">
                    <div class="workflow-progress-bar" style="width: 75%"></div>
                </div>
                <div class="workflow-stats">
                    <span>Phase 3: Valuation abgeschlossen</span>
                    <span>Deal Size: €45M</span>
                </div>
            </div>
        </div>

        <!-- Workflow Templates -->
        <div class="workflow-container">
            <div class="workflow-header">
                <div class="workflow-title">📋 Quick Start Templates</div>
            </div>
            
            <div class="executive-grid">
                <div class="kpi-card" style="cursor: pointer;" onclick="startTemplate('monthly-close')">
                    <div class="kpi-label">Standard Process</div>
                    <div style="font-size: 24px; margin: 10px 0;">📊</div>
                    <div style="font-weight: bold; color: var(--dark);">Monatsabschluss</div>
                    <div style="color: var(--gray); font-size: 14px; margin-top: 8px;">9 Steps • 4-6 Stunden • 5 Agenten</div>
                </div>
                
                <div class="kpi-card" style="cursor: pointer;" onclick="startTemplate('invoice-processing')">
                    <div class="kpi-label">Automation</div>
                    <div style="font-size: 24px; margin: 10px 0;">💳</div>
                    <div style="font-weight: bold; color: var(--dark);">Rechnungsverarbeitung</div>
                    <div style="color: var(--gray); font-size: 14px; margin-top: 8px;">5 Steps • 30 Min • 3 Agenten</div>
                </div>
                
                <div class="kpi-card" style="cursor: pointer;" onclick="startTemplate('ma-evaluation')">
                    <div class="kpi-label">Complex Analysis</div>
                    <div style="font-size: 24px; margin: 10px 0;">🤝</div>
                    <div style="font-weight: bold; color: var(--dark);">M&A Evaluation</div>
                    <div style="color: var(--gray); font-size: 14px; margin-top: 8px;">12 Steps • 2-3 Tage • 7 Agenten</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompts View (Legacy) -->
    <div class="mode-content" id="prompts-view">
        <!-- Role Selector -->
        <div class="role-selector">
            <h2 style="margin-bottom: 1rem;">Wählen Sie Ihre Rolle</h2>
            <div class="role-tabs" id="roleTabs">
                <!-- Roles will be injected here -->
            </div>
            <div class="role-description" id="roleDescription">
                Wählen Sie eine Rolle, um spezialisierte Finance-Prompts zu sehen.
            </div>
            <!-- SAP Integration View -->
    <div class="mode-content" id="sap-view">
        <!-- SAP Content kommt hier rein -->
        <div style="padding: 20px;">
            <h2 style="color: white; margin-bottom: 30px;">🔗 SAP Integration</h2>
            
            <!-- Der SAP Demo Container -->
            <div style="background: white; border-radius: 16px; padding: 30px;">
                <!-- SAP Header -->
                <div style="background: linear-gradient(135deg, #0A6EBD 0%, #053B50 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin: 0;">SAP S/4HANA Integration</h3>
                    <p style="margin: 5px 0 0 0; opacity: 0.9;">Live-Verbindung zu Ihrem ERP-System</p>
                </div>
                
                <!-- SAP Buttons -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button onclick="connectToSAP()" style="padding: 12px 24px; background: #0A6EBD; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        🔌 Mit SAP verbinden
                    </button>
                    <button onclick="loadSAPData()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        📥 Daten laden
                    </button>
                </div>
                
                <!-- SAP Status -->
                <div id="sapStatus" style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 20px;">
                    Status: Nicht verbunden
                </div>
                
                <!-- SAP Data Table -->
                <div id="sapDataContainer" style="display: none;">
                    <h4>SAP Daten:</h4>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f0f0f0;">
                                <th style="padding: 10px; text-align: left;">Belegnummer</th>
                                <th style="padding: 10px; text-align: left;">Lieferant</th>
                                <th style="padding: 10px; text-align: left;">Betrag</th>
                                <th style="padding: 10px; text-align: left;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="sapTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
        </div>

        <!-- Search & Filter -->
        <div class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Suche nach Prompts, Keywords, Prozessen...">
                <button class="search-btn" onclick="searchPrompts()">
                    🔍 Suchen
                </button>
            </div>
            <div class="filter-chips">
                <span class="chip" onclick="toggleComplexity(this, 'low')">⚡ Einfach</span>
                <span class="chip" onclick="toggleComplexity(this, 'medium')">📊 Mittel</span>
                <span class="chip" onclick="toggleComplexity(this, 'high')">🚀 Komplex</span>
            </div>
        </div>

        <!-- Categories Grid -->
        <div class="categories-grid" id="categoriesGrid">
            <!-- Categories will be injected here -->
        </div>
    </div>
</div>

<!-- Execute Modal -->
<div class="modal" id="executeModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Prompt ausführen</h3>
            <button class="close-btn" onclick="closeModal()">×</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 1rem;">
                <strong>Prompt:</strong>
                <p id="modalPrompt" style="margin-top: 8px; color: #64748b;"></p>
            </div>
            
            <label style="font-weight: 600; margin-bottom: 8px; display: block;">
                Kontext hinzufügen (optional):
            </label>
            <textarea class="context-input" id="contextInput" 
                placeholder="Fügen Sie spezifische Details, Zahlen oder Kontext hinzu..."></textarea>
            
            <div class="modal-actions">
                <button class="btn-secondary" onclick="executeWithoutAI()">
                    📝 Template nutzen
                </button>
                <button class="btn-primary" onclick="executeWithAI()">
                    🤖 Mit KI ausführen
                </button>
            </div>
            
            <div class="ai-response" id="aiResponse">
                <div class="response-header">
                    <span>🤖</span>
                    <span>KI-Antwort</span>
                </div>
                <div class="response-content" id="responseContent">
                    <!-- AI response will appear here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions FAB -->
<div class="quick-actions">
    <button class="fab" onclick="quickAction()">+</button>
</div>

<!-- Notion Sync Button -->
<button onclick="syncWithNotion()" style="
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 30px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
">
    🔄 Notion Sync
</button>

<script>
    // ==========================
    // GLOBAL VARIABLES
    // ==========================
    let currentMode = 'executive';
    let currentRole = null;
    let currentPrompt = null;
    let selectedComplexity = null;
    let notionPrompts = [];

    // Finance Prompts Database
    const FINANCE_PROMPTS = {
        kreditor: {
            name: "Kreditorenbuchhalter",
            description: "Spezialisiert auf Rechnungsverarbeitung, Lieferantenzahlungen und SAP FI-AP",
            icon: "💳",
            categories: {
                rechnungsverarbeitung: {
                    name: "Rechnungsverarbeitung",
                    icon: "📄",
                    prompts: [
                        {
                            id: "kred_001",
                            title: "3-Wege-Abgleich durchführen",
                            prompt: "Führe einen 3-Wege-Abgleich durch zwischen Bestellung, Lieferschein und Rechnung.",
                            tags: ["validation", "invoice"],
                            complexity: "medium"
                        },
                        {
                            id: "kred_002",
                                title: "Skonto-Optimierung",
                                prompt: "Berechne optimale Zahlungsstrategie unter Berücksichtigung von Skonto.",
                                tags: ["discount", "payment"],
                                complexity: "high"
                            },
                            {
                                id: "kred_003",
                                title: "Duplicate Check",
                                prompt: "Prüfe auf doppelte Rechnungen.",
                                tags: ["validation"],
                                complexity: "low"
                            }
                        ]
                    },
                    lieferantenmanagement: {
                        name: "Lieferantenmanagement",
                        icon: "🤝",
                        prompts: [
                            {
                                id: "kred_010",
                                title: "Vendor Validation",
                                prompt: "Validiere Lieferantenstammdaten.",
                                tags: ["vendor", "compliance"],
                                complexity: "medium"
                            }
                        ]
                    }
                }
            },
            debitor: {
                name: "Debitorenbuchhalter",
                description: "Fokus auf Mahnwesen, Zahlungseingänge und Forderungsmanagement",
                icon: "💰",
                categories: {
                    mahnwesen: {
                        name: "Mahnwesen",
                        icon: "⚠️",
                        prompts: [
                            {
                                id: "deb_001",
                                title: "Mahnstufe ermitteln",
                                prompt: "Analysiere Zahlungshistorie und ermittle Mahnstufe.",
                                tags: ["dunning", "analysis"],
                                complexity: "medium"
                            },
                            {
                                id: "deb_002",
                                title: "Zahlungserinnerung",
                                prompt: "Erstelle höfliche Zahlungserinnerung.",
                                tags: ["communication"],
                                complexity: "low"
                            }
                        ]
                    }
                }
            },
            controller: {
                name: "Controller",
                description: "Reporting, Planung, Analyse und Kostenmanagement",
                icon: "📊",
                categories: {
                    reporting: {
                        name: "Reporting & Analyse",
                        icon: "📈",
                        prompts: [
                            {
                                id: "ctrl_001",
                                title: "Monatsabschluss-Analyse",
                                prompt: "Analysiere Monatsabschluss und erstelle Management Summary.",
                                tags: ["closing", "analysis"],
                                complexity: "high"
                            },
                            {
                                id: "ctrl_002",
                                title: "KPI-Dashboard",
                                prompt: "Aktualisiere KPIs: EBITDA, Working Capital, ROI.",
                                tags: ["kpi", "metrics"],
                                complexity: "medium"
                            }
                        ]
                    },
                    planung: {
                        name: "Planung & Forecast",
                        icon: "🎯",
                        prompts: [
                            {
                                id: "ctrl_010",
                                title: "Rolling Forecast",
                                prompt: "Erstelle 12-Monats Rolling Forecast.",
                                tags: ["forecast", "planning"],
                                complexity: "high"
                            }
                        ]
                    }
                }
            },
            cfo: {
                name: "CFO",
                description: "Strategische Finanzplanung, Risk Management und Investor Relations",
                icon: "👔",
                categories: {
                    strategie: {
                        name: "Strategische Planung",
                        icon: "🎯",
                        prompts: [
                            {
                                id: "cfo_001",
                                title: "Investment Case",
                                prompt: "Bewerte Investment: NPV, IRR, Payback.",
                                tags: ["investment", "valuation"],
                                complexity: "high"
                            }
                        ]
                    }
                }
            },
            treasury: {
                name: "Treasury Manager",
                description: "Cash Management, FX-Hedging und Liquiditätsplanung",
                icon: "🏦",
                categories: {
                    cashmanagement: {
                        name: "Cash Management",
                        icon: "💵",
                        prompts: [
                            {
                                id: "trs_001",
                                title: "Cash Flow Forecast",
                                prompt: "Erstelle 13-Wochen Cash Flow Forecast.",
                                tags: ["cashflow", "forecast"],
                                complexity: "high"
                            }
                        ]
                    }
                }
            },
            ma: {
                name: "M&A Berater",
                description: "Due Diligence, Valuation und Post-Merger Integration",
                icon: "🤝",
                categories: {
                    duediligence: {
                        name: "Due Diligence",
                        icon: "🔍",
                        prompts: [
                            {
                                id: "ma_001",
                                title: "Financial DD",
                                prompt: "Führe Financial Due Diligence durch.",
                                tags: ["dd", "analysis"],
                                complexity: "high"
                            }
                        ]
                    }
                }
            }
        };

        // ==========================
        // INITIALIZATION
        // ==========================
        window.addEventListener('DOMContentLoaded', () => {
            console.log('🎯 ALBO AI Dashboard geladen');
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 1000);

            // Check for email data from URL
            checkForEmailData();
            
            // Load Notion prompts
            loadNotionPrompts();
            
            // Initialize prompts view
            renderRoleTabs();
            updateStats();
        });

        // ==========================
        // MODE SWITCHING
        // ==========================
        function switchMode(mode) {
            currentMode = mode;
            
            // Update buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.mode-btn').classList.add('active');
            
            // Update content
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(mode + '-view').classList.add('active');
            
            // Animate transition
            document.getElementById(mode + '-view').style.animation = 'fadeIn 0.5s ease';
        }

        // ==========================
        // EMAIL ANALYSIS
        // ==========================
        function checkForEmailData() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('session');
            
            console.log('📧 Session Parameter gefunden:', sessionParam ? 'JA' : 'NEIN');
            
            if (sessionParam) {
                try {
                    const sessionData = JSON.parse(atob(sessionParam));
                    console.log('✅ E-Mail-Daten dekodiert:', sessionData);
                    
                    if (sessionData.email && sessionData.email.subject) {
                        window.currentEmailData = sessionData.email;
                        window.currentAgent = sessionData.agent || 'controller';
                        
                        // Update email count badge
                        document.getElementById('emailCount').textContent = '1';
                        
                        // Show notification
                        showNotification('📧 E-Mail aus Outlook geladen!', 'success');
                        
                        // Auto-select agent
                        if (sessionData.agent) {
                            setTimeout(() => {
                                selectRole(sessionData.agent);
                            }, 1500);
                        }
                    }
                } catch (error) {
                    console.error('❌ Fehler beim Dekodieren:', error);
                }
            }
        }

        function checkForEmails() {
            if (window.currentEmailData) {
                analyzeEmail();
            } else {
                alert('Keine E-Mails vorhanden. E-Mails können über Outlook-Integration geladen werden.');
            }
        }

        function analyzeEmail() {
            if (!window.currentEmailData) {
                alert('Keine E-Mail-Daten vorhanden');
                return;
            }
            
            console.log('📧 Analysiere E-Mail mit KI-Agenten:', window.currentEmailData);
            
            const modal = document.createElement('div');
            modal.id = 'emailAnalysisModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    width: 90%;
                    max-width: 1200px;
                    height: 85vh;
                    display: flex;
                    flex-direction: column;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                    animation: slideUp 0.3s ease;
                ">
                    <!-- Header -->
                    <div style="
                        background: linear-gradient(135deg, #4f46e5, #4338ca);
                        color: white;
                        padding: 25px 30px;
                        border-radius: 20px 20px 0 0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    ">
                        <div>
                            <h2 style="margin: 0 0 8px 0; font-size: 24px; display: flex; align-items: center; gap: 12px;">
                                📧 E-Mail Analyse mit KI-Agenten
                            </h2>
                            <div style="opacity: 0.9; font-size: 14px;">
                                Aktiver Agent: <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 5px; margin-left: 5px;">
                                    ${window.currentAgent || 'Controller'}
                                </span>
                            </div>
                        </div>
                        <button onclick="document.getElementById('emailAnalysisModal').remove()" style="
                            background: rgba(255,255,255,0.2);
                            border: none;
                            color: white;
                            width: 40px;
                            height: 40px;
                            border-radius: 50%;
                            font-size: 24px;
                            cursor: pointer;
                            transition: all 0.3s;
                        ">×</button>
                    </div>
                    
                    <!-- Body -->
                    <div style="
                        flex: 1;
                        display: flex;
                        gap: 20px;
                        padding: 20px;
                        overflow: hidden;
                    ">
                        <!-- E-Mail Content -->
                        <div style="flex: 1; overflow-y: auto;">
                            <div style="
                                background: #f8f9fa;
                                padding: 15px;
                                border-radius: 12px;
                                margin-bottom: 15px;
                            ">
                                <h4 style="margin: 0 0 12px 0; color: #4f46e5;">📋 E-Mail Details</h4>
                                <div style="display: grid; gap: 8px; font-size: 14px;">
                                    <div><strong>Betreff:</strong> ${window.currentEmailData.subject || 'Kein Betreff'}</div>
                                    <div><strong>Von:</strong> ${window.currentEmailData.from || 'Unbekannt'}</div>
                                    <div><strong>Datum:</strong> ${new Date().toLocaleString('de-DE')}</div>
                                </div>
                            </div>
                            
                            <div style="
                                background: white;
                                border: 1px solid #e1e1e1;
                                padding: 20px;
                                border-radius: 12px;
                            ">
                                <h4 style="margin: 0 0 15px 0;">📝 E-Mail Inhalt</h4>
                                <div style="white-space: pre-wrap; line-height: 1.6;">
                                    ${window.currentEmailData.body || 'Kein Inhalt'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Agent Actions -->
                        <div style="flex: 1; overflow-y: auto;">
                            <div id="agentActionsSection" style="
                                background: linear-gradient(135deg, rgba(79,70,229,0.05), rgba(139,92,246,0.05));
                                padding: 20px;
                                border-radius: 12px;
                                margin-bottom: 15px;
                            ">
                                <h4 style="margin: 0 0 15px 0; color: #4f46e5;">
                                    🤖 Verfügbare KI-Agenten
                                </h4>
                                <div style="display: grid; gap: 10px;">
                                    <button onclick="assignToAgent('kreditor')" style="
                                        background: white;
                                        border: 1px solid #e1e1e1;
                                        padding: 12px;
                                        border-radius: 8px;
                                        cursor: pointer;
                                        text-align: left;
                                        transition: all 0.3s;
                                    ">
                                        <div style="font-weight: 600;">💳 Kreditor Agent</div>
                                        <div style="font-size: 12px; color: #64748b;">Für Rechnungen & Zahlungen</div>
                                    </button>
                                    
                                    <button onclick="assignToAgent('controller')" style="
                                        background: white;
                                        border: 1px solid #e1e1e1;
                                        padding: 12px;
                                        border-radius: 8px;
                                        cursor: pointer;
                                        text-align: left;
                                        transition: all 0.3s;
                                    ">
                                        <div style="font-weight: 600;">📊 Controller Agent</div>
                                        <div style="font-size: 12px; color: #64748b;">Für Analysen & Reports</div>
                                    </button>
                                    
                                    <button onclick="assignToAgent('cfo')" style="
                                        background: white;
                                        border: 1px solid #e1e1e1;
                                        padding: 12px;
                                        border-radius: 8px;
                                        cursor: pointer;
                                        text-align: left;
                                        transition: all 0.3s;
                                    ">
                                        <div style="font-weight: 600;">👔 CFO Agent</div>
                                        <div style="font-size: 12px; color: #64748b;">Für strategische Entscheidungen</div>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="aiAnalysisContent" style="
                                background: white;
                                padding: 20px;
                                border-radius: 12px;
                            ">
                                <button onclick="performFullEmailAnalysis()" style="
                                    width: 100%;
                                    background: linear-gradient(135deg, #4f46e5, #4338ca);
                                    color: white;
                                    border: none;
                                    padding: 15px;
                                    border-radius: 8px;
                                    font-size: 16px;
                                    font-weight: 600;
                                    cursor: pointer;
                                ">
                                    🚀 Mit KI analysieren
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function performFullEmailAnalysis() {
            const contentDiv = document.getElementById('aiAnalysisContent');
            
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto;"></div>
                    <p style="margin-top: 15px; color: #4f46e5; font-weight: 600;">
                        🤖 Verbinde mit OpenAI GPT-4...
                    </p>
                </div>
            `;
            
            try {
                const response = await fetch('https://albo-saa-s-backend.vercel.app/api/analyze-api', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        emailContent: window.currentEmailData,
                        agent: window.currentAgent || 'controller'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('✅ KI-Analyse erhalten:', result);
                
                contentDiv.innerHTML = `
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px;">
                        <h5 style="color: #4f46e5; margin: 0 0 10px 0;">✅ Analyse abgeschlossen</h5>
                        <p>${result.analysis?.summary || 'Analyse durchgeführt'}</p>
                        <button onclick="document.getElementById('emailAnalysisModal').remove()" style="
                            margin-top: 10px;
                            padding: 8px 16px;
                            background: #4f46e5;
                            color: white;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                        ">Schließen</button>
                    </div>
                `;
                
            } catch (error) {
                console.error('❌ Analyse-Fehler:', error);
                contentDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 15px; border-radius: 8px;">
                        <p style="color: #c62828;">❌ Fehler bei der Analyse</p>
                        <p style="font-size: 14px;">${error.message}</p>
                    </div>
                `;
            }
        }

        function assignToAgent(agentType) {
            showNotification(`📧 E-Mail wurde an ${agentType.toUpperCase()} Agent weitergeleitet`, 'success');
            setTimeout(() => {
                switchMode('team');
                document.getElementById('emailAnalysisModal')?.remove();
            }, 1000);
        }

        // ==========================
        // EXECUTE WITH AI
        // ==========================
        async function executeWithAI() {
            const context = document.getElementById('contextInput').value;
            const responseDiv = document.getElementById('aiResponse');
            const responseContent = document.getElementById('responseContent');
            
            responseDiv.classList.add('active');
            responseContent.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto;"></div>
                    <p style="margin-top: 15px; color: #4f46e5; font-weight: 600;">
                        🤖 Verbinde mit OpenAI GPT-4...
                    </p>
                </div>
            `;
            
            try {
                const requestData = {
                    prompt: currentPrompt.prompt,
                    context: context,
                    agent: currentRole || 'controller',
                    temperature: 0.3,
                    maxTokens: 1500
                };
                
                if (window.currentEmailData) {
                    requestData.emailData = window.currentEmailData;
                }
                
                console.log('🚀 Sende an OpenAI API:', requestData);
                
                const response = await fetch('https://albo-saa-s-backend.vercel.app/api/execute-prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('✅ KI-Antwort erhalten:', result);
                
                if (result.success && result.result) {
                    displayAIResponse(result);
                } else {
                    throw new Error(result.error || 'Unbekannter Fehler');
                }
                
            } catch (error) {
                console.error('❌ KI-Ausführung fehlgeschlagen:', error);
                responseContent.innerHTML = `
                    <div style="background: #ffebee; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #c62828;">❌ Fehler bei der KI-Analyse</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function displayAIResponse(result) {
            const responseContent = document.getElementById('responseContent');
            
            responseContent.innerHTML = `
                <div style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 20px; border-radius: 10px;">
                    <h4 style="margin: 0 0 15px 0; color: #4f46e5;">
                        🤖 KI-Analyse Ergebnis
                    </h4>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        ${result.result}
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="copyAIResponse()" style="
                            padding: 8px 16px;
                            background: white;
                            border: 1px solid #d1d5db;
                            border-radius: 6px;
                            cursor: pointer;
                        ">📋 Kopieren</button>
                    </div>
                </div>
            `;
            
            window.lastAIResponse = result.result;
        }

        function copyAIResponse() {
            if (window.lastAIResponse) {
                navigator.clipboard.writeText(window.lastAIResponse).then(() => {
                    showNotification('✅ In Zwischenablage kopiert!', 'success');
                });
            }
        }

        function executeWithoutAI() {
            const responseDiv = document.getElementById('aiResponse');
            const responseContent = document.getElementById('responseContent');
            
            responseDiv.classList.add('active');
            responseContent.innerHTML = `
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px;">
                    <h4 style="color: #0d47a1;">📋 Template-Modus</h4>
                    <p>${currentPrompt.prompt}</p>
                </div>
            `;
        }

        // ==========================
        // M&A WORKFLOW FUNCTIONS
        // ==========================
        
        function startMADeal() {
            const modal = document.createElement('div');
            modal.id = 'maModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    width: 90%;
                    max-width: 800px;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <div style="
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 30px;
                        border-radius: 20px 20px 0 0;
                    ">
                        <h2 style="margin: 0;">🤝 Neuer M&A Deal - Initial Setup</h2>
                    </div>
                    
                    <div style="padding: 30px;">
                        <div style="display: grid; gap: 20px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                    Target Company Name
                                </label>
                                <input type="text" id="targetName" placeholder="z.B. TechStartup GmbH" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 16px;
                                ">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                    Deal Type
                                </label>
                                <select id="dealType" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 16px;
                                ">
                                    <option value="acquisition">Acquisition (100% Übernahme)</option>
                                    <option value="majority">Majority Stake (>50%)</option>
                                    <option value="minority">Minority Investment (<50%)</option>
                                    <option value="merger">Merger of Equals</option>
                                    <option value="asset">Asset Deal</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                    Expected Deal Size
                                </label>
                                <input type="text" id="dealSize" placeholder="z.B. €10-15M" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 16px;
                                ">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                    Strategic Rationale
                                </label>
                                <textarea id="strategicRationale" rows="4" placeholder="Warum macht dieser Deal strategisch Sinn?" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                    font-size: 16px;
                                    resize: vertical;
                                "></textarea>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 30px;">
                            <button onclick="document.getElementById('maModal').remove()" style="
                                flex: 1;
                                background: #e0e0e0;
                                color: #333;
                                border: none;
                                padding: 15px;
                                border-radius: 8px;
                                font-size: 16px;
                                cursor: pointer;
                            ">Abbrechen</button>
                            
                            <button onclick="createMADeal()" style="
                                flex: 2;
                                background: linear-gradient(135deg, #667eea, #764ba2);
                                color: white;
                                border: none;
                                padding: 15px;
                                border-radius: 8px;
                                font-size: 16px;
                                font-weight: 600;
                                cursor: pointer;
                            ">🚀 M&A Prozess starten</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function createMADeal() {
            const targetName = document.getElementById('targetName').value;
            const dealType = document.getElementById('dealType').value;
            const dealSize = document.getElementById('dealSize').value;
            const strategicRationale = document.getElementById('strategicRationale').value;
            
            if (!targetName) {
                alert('Bitte Target Company eingeben');
                return;
            }
            
            const dealData = {
                targetName,
                dealType,
                dealSize,
                strategicRationale,
                phase: 'strategic-fit',
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem('currentMADeal', JSON.stringify(dealData));
            document.getElementById('maModal').remove();
            showNotification(`✅ M&A Deal "${targetName}" wurde erstellt!`, 'success');
            
            setTimeout(() => {
                executeMAPhase('strategic-fit');
            }, 1000);
        }
        
        function checkOutlookEmails() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('session');
            
            if (sessionParam || window.currentEmailData) {
                processMAEmail();
            } else {
                showEmailIntegrationGuide();
            }
        }
        
        function processMAEmail() {
            if (!window.currentEmailData) {
                showEmailIntegrationGuide();
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'maEmailModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    width: 90%;
                    max-width: 900px;
                    max-height: 90vh;
                    overflow-y: auto;
                ">
                    <div style="
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 30px;
                        border-radius: 20px 20px 0 0;
                    ">
                        <h2 style="margin: 0;">📧 M&A Email Verarbeitung</h2>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">KI analysiert Email und Attachments</p>
                    </div>
                    
                    <div style="padding: 30px;">
                        <div style="
                            background: #f8f9fa;
                            padding: 20px;
                            border-radius: 12px;
                            margin-bottom: 20px;
                        ">
                            <h4 style="margin: 0 0 15px 0;">Email Details</h4>
                            <div style="display: grid; gap: 10px; font-size: 14px;">
                                <div><strong>Von:</strong> ${window.currentEmailData.from || 'Unbekannt'}</div>
                                <div><strong>Betreff:</strong> ${window.currentEmailData.subject || 'Kein Betreff'}</div>
                                <div><strong>Datum:</strong> ${new Date().toLocaleString('de-DE')}</div>
                            </div>
                        </div>
                        
                        <div style="
                            background: #f0f9ff;
                            padding: 20px;
                            border-radius: 12px;
                            margin-bottom: 20px;
                        ">
                            <h4 style="margin: 0 0 15px 0;">📎 Erkannte Dokumente</h4>
                            <div>
                                <div style="padding: 10px; background: white; border-radius: 8px; margin-bottom: 10px;">
                                    📄 Teaser_TechStartup.pdf (2.3 MB)
                                </div>
                                <div style="padding: 10px; background: white; border-radius: 8px; margin-bottom: 10px;">
                                    📊 Financial_Model.xlsx (1.5 MB)
                                </div>
                                <div style="padding: 10px; background: white; border-radius: 8px;">
                                    📋 NDA_Agreement.pdf (340 KB)
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button onclick="document.getElementById('maEmailModal').remove()" style="
                                flex: 1;
                                background: #e0e0e0;
                                border: none;
                                padding: 15px;
                                border-radius: 8px;
                                cursor: pointer;
                            ">Abbrechen</button>
                            
                            <button onclick="startMAFromEmail()" style="
                                flex: 2;
                                background: linear-gradient(135deg, #10b981, #059669);
                                color: white;
                                border: none;
                                padding: 15px;
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                            ">M&A Prozess starten</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function showEmailIntegrationGuide() {
            alert('Outlook Integration:\n\n1. Öffnen Sie die Email in Outlook\n2. Nutzen Sie das ALBO Add-In\n3. Wählen Sie "An Dashboard senden"\n\nDie Email wird dann hier automatisch verarbeitet.');
        }
        
        function startMAFromEmail() {
            showNotification('✅ M&A Prozess aus Email gestartet', 'success');
            document.getElementById('maEmailModal').remove();
            executeMAPhase('strategic-fit');
        }
        
        function openManualUpload() {
            const modal = document.createElement('div');
            modal.id = 'uploadModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 20px;
                    width: 90%;
                    max-width: 800px;
                    max-height: 90vh;
                    overflow-y: auto;
                ">
                    <div style="
                        background: linear-gradient(135deg, #10b981, #059669);
                        color: white;
                        padding: 30px;
                        border-radius: 20px 20px 0 0;
                    ">
                        <h2 style="margin: 0;">📁 M&A Dokumente Upload</h2>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">Laden Sie alle relevanten Dokumente hoch</p>
                    </div>
                    
                    <div style="padding: 30px;">
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                Case Beschreibung
                            </label>
                            <textarea id="caseDescription" rows="4" placeholder="Beschreiben Sie den M&A Case..." style="
                                width: 100%;
                                padding: 12px;
                                border: 2px solid #e0e0e0;
                                border-radius: 8px;
                                font-size: 16px;
                            "></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                    Target Company
                                </label>
                                <input type="text" id="targetCompany" placeholder="Company Name" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                ">
                            </div>
                            
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                    Deal Size
                                </label>
                                <input type="text" id="uploadDealSize" placeholder="z.B. 10-15M EUR" style="
                                    width: 100%;
                                    padding: 12px;
                                    border: 2px solid #e0e0e0;
                                    border-radius: 8px;
                                ">
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">
                                Dokumente hochladen
                            </label>
                            <div id="dropZone" style="
                                border: 2px dashed #cbd5e1;
                                border-radius: 12px;
                                padding: 40px;
                                text-align: center;
                                background: #f8fafc;
                                cursor: pointer;
                            " ondrop="handleDrop(event)" ondragover="handleDragOver(event)" onclick="document.getElementById('fileInput').click()">
                                <div style="font-size: 48px; margin-bottom: 15px;">📤</div>
                                <p style="margin: 0 0 10px 0; font-weight: 600;">
                                    Drag & Drop oder klicken zum Upload
                                </p>
                                <p style="margin: 0; color: #64748b; font-size: 14px;">
                                    PDF, Excel, Word, PowerPoint
                                </p>
                                <input type="file" id="fileInput" multiple accept=".pdf,.xlsx,.xls,.docx,.doc,.pptx,.ppt" style="display: none;" onchange="handleFileSelect(event)">
                            </div>
                        </div>
                        
                        <div id="uploadedFiles" style="margin-bottom: 25px;"></div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button onclick="document.getElementById('uploadModal').remove()" style="
                                flex: 1;
                                background: #e0e0e0;
                                border: none;
                                padding: 15px;
                                border-radius: 8px;
                                cursor: pointer;
                            ">Abbrechen</button>
                            
                            <button onclick="processUploadedDocuments()" style="
                                flex: 2;
                                background: linear-gradient(135deg, #10b981, #059669);
                                color: white;
                                border: none;
                                padding: 15px;
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                            ">Dokumente analysieren & M&A starten</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.style.borderColor = '#667eea';
            e.currentTarget.style.background = '#f8f7ff';
        }
        
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.style.borderColor = '#cbd5e1';
            e.currentTarget.style.background = '#f8fafc';
            
            const files = e.dataTransfer.files;
            displayUploadedFiles(files);
        }
        
        function handleFileSelect(e) {
            const files = e.target.files;
            displayUploadedFiles(files);
        }
        
        function displayUploadedFiles(files) {
            const container = document.getElementById('uploadedFiles');
            if (!container) return;
            
            let html = '<h4 style="margin: 0 0 10px 0;">Hochgeladene Dateien:</h4>';
            
            for (let file of files) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                const icon = file.name.endsWith('.pdf') ? '📄' : 
                             file.name.endsWith('.xlsx') || file.name.endsWith('.xls') ? '📊' : 
                             file.name.endsWith('.docx') || file.name.endsWith('.doc') ? '📝' : '📎';
                
                html += `
                    <div style="
                        padding: 10px;
                        background: #f0f9ff;
                        border-radius: 8px;
                        margin-bottom: 8px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    ">
                        <span>${icon} ${file.name}</span>
                        <span style="color: #64748b; font-size: 14px;">${fileSize} MB</span>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function processUploadedDocuments() {
            const caseDescription = document.getElementById('caseDescription').value;
            const targetCompany = document.getElementById('targetCompany').value;
            const dealSize = document.getElementById('uploadDealSize').value;
            
            if (!targetCompany) {
                alert('Bitte Target Company eingeben');
                return;
            }
            
            const uploadData = {
                caseDescription,
                targetCompany,
                dealSize,
                timestamp: new Date().toISOString()
            };
            
            showNotification('✅ Dokumente hochgeladen und werden analysiert', 'success');
            document.getElementById('uploadModal').remove();
            
            setTimeout(() => {
                executeMAPhase('strategic-fit');
            }, 1000);
        }
        
        function executeMAPhase(phase) {
            showNotification(`🚀 Starte M&A Phase: ${phase}`, 'success');
            // Hier würde die Integration mit deiner executeWithAI Funktion kommen
        }

        // ==========================
        // PROMPTS MANAGEMENT
        // ==========================
        function renderRoleTabs() {
            const container = document.getElementById('roleTabs');
            if (!container) return;
            
            Object.entries(FINANCE_PROMPTS).forEach(([key, role]) => {
                const tab = document.createElement('div');
                tab.className = 'role-tab';
                tab.onclick = () => selectRole(key);
                tab.innerHTML = `
                    <span>${role.icon}</span>
                    <span>${role.name}</span>
                `;
                container.appendChild(tab);
            });
        }

        function selectRole(roleKey) {
            currentRole = roleKey;
            
            document.querySelectorAll('.role-tab').forEach((tab, index) => {
                tab.classList.toggle('active', Object.keys(FINANCE_PROMPTS)[index] === roleKey);
            });
            
            const role = FINANCE_PROMPTS[roleKey];
            const descElement = document.getElementById('roleDescription');
            if (descElement) {
                descElement.innerHTML = `
                    <strong>${role.icon} ${role.name}</strong><br>
                    ${role.description}
                `;
            }
            
            renderCategories(roleKey);
        }

        function renderCategories(roleKey) {
            const container = document.getElementById('categoriesGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            const role = FINANCE_PROMPTS[roleKey];
            
            Object.entries(role.categories).forEach(([catKey, category]) => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.onclick = (e) => {
                    if (!e.target.classList.contains('execute-btn')) {
                        card.classList.toggle('expanded');
                    }
                };
                
                const promptsHtml = category.prompts.map(prompt => `
                    <div class="prompt-item">
                        <div class="prompt-title">
                            ${prompt.title}
                            <span class="complexity-badge complexity-${prompt.complexity}">
                                ${prompt.complexity === 'low' ? 'Einfach' : 
                                  prompt.complexity === 'medium' ? 'Mittel' : 'Komplex'}
                            </span>
                        </div>
                        <div class="prompt-description">${prompt.prompt}</div>
                        <div class="prompt-tags">
                            ${prompt.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                        <button class="execute-btn" onclick="openExecuteModal('${prompt.id}', '${roleKey}')">
                            🚀 Ausführen
                        </button>
                    </div>
                `).join('');
                
                card.innerHTML = `
                    <div class="category-header">
                        <div class="category-title">
                            <span class="category-icon">${category.icon}</span>
                            <span>${category.name}</span>
                        </div>
                        <span class="category-count">${category.prompts.length}</span>
                    </div>
                    <div class="prompt-list">
                        ${promptsHtml}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function openExecuteModal(promptId, roleKey) {
            const role = FINANCE_PROMPTS[roleKey];
            let foundPrompt = null;
            
            Object.values(role.categories).forEach(category => {
                const prompt = category.prompts.find(p => p.id === promptId);
                if (prompt) foundPrompt = prompt;
            });
            
            if (foundPrompt) {
                currentPrompt = foundPrompt;
                document.getElementById('modalTitle').textContent = foundPrompt.title;
                document.getElementById('modalPrompt').textContent = foundPrompt.prompt;
                document.getElementById('contextInput').value = '';
                document.getElementById('aiResponse').classList.remove('active');
                document.getElementById('executeModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('executeModal').classList.remove('active');
            currentPrompt = null;
        }

        function searchPrompts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (!query) {
                if (currentRole) {
                    renderCategories(currentRole);
                }
                return;
            }
            
            const container = document.getElementById('categoriesGrid');
            container.innerHTML = '';
            
            let results = [];
            
            Object.entries(FINANCE_PROMPTS).forEach(([roleKey, role]) => {
                Object.entries(role.categories).forEach(([catKey, category]) => {
                    category.prompts.forEach(prompt => {
                        const searchText = `${prompt.title} ${prompt.prompt} ${prompt.tags.join(' ')}`.toLowerCase();
                        if (searchText.includes(query)) {
                            results.push({
                                ...prompt,
                                roleKey,
                                roleName: role.name,
                                categoryName: category.name,
                                categoryIcon: category.icon
                            });
                        }
                    });
                });
            });
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; background: white; border-radius: 16px;">
                        <h3>Keine Ergebnisse gefunden</h3>
                    </div>
                `;
            } else {
                results.forEach(result => {
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    card.innerHTML = `
                        <div class="category-header">
                            <div class="category-title">
                                <span>${result.categoryIcon}</span>
                                <span>${result.roleName} - ${result.categoryName}</span>
                            </div>
                        </div>
                        <div class="prompt-item" style="display: block;">
                            <div class="prompt-title">
                                ${result.title}
                            </div>
                            <button class="execute-btn" onclick="openExecuteModal('${result.id}', '${result.roleKey}')">
                                🚀 Ausführen
                            </button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        function toggleComplexity(chip, level) {
            chip.classList.toggle('active');
            
            if (chip.classList.contains('active')) {
                selectedComplexity = level;
            } else {
                selectedComplexity = null;
            }
            
            if (currentRole) {
                renderCategories(currentRole);
            }
        }

        function updateStats() {
            let totalPrompts = 0;
            
            Object.values(FINANCE_PROMPTS).forEach(role => {
                Object.values(role.categories).forEach(category => {
                    totalPrompts += category.prompts.length;
                });
            });
            
            console.log(`Total prompts: ${totalPrompts}`);
        }

        // ==========================
        // NOTION INTEGRATION
        // ==========================
        async function loadNotionPrompts() {
            try {
                const response = await fetch('https://albo-saa-s-backend.vercel.app/api/notion-bundled');
                const data = await response.json();
                
                if (data.success && data.prompts.length > 0) {
                    console.log('✅ Notion Prompts geladen:', data.prompts);
                    notionPrompts = data.prompts;
                    displayNotionPrompts(data.prompts);
                }
            } catch (error) {
                console.error('Error loading Notion prompts:', error);
            }
        }

        function displayNotionPrompts(prompts) {
            const container = document.getElementById('notion-prompts-section');
            if (!container) return;
            
            container.style.display = 'block';
            container.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 32px;">📚</span>
                        <span>Meine Notion Prompts (${prompts.length})</span>
                    </h2>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px;">
                        ✅ Live synchronisiert
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                    ${prompts.map(prompt => `
                        <div style="
                            background: white;
                            color: #333;
                            padding: 20px;
                            border-radius: 12px;
                            cursor: pointer;
                            transition: transform 0.3s;
                        " onmouseover="this.style.transform='translateY(-5px)'" 
                           onmouseout="this.style.transform='translateY(0)'"
                           onclick="executeNotionPrompt('${prompt.id}')">
                            
                            <h3 style="margin: 0 0 10px 0; color: #667eea;">
                                ${prompt.title || 'Unbenannt'}
                            </h3>
                            
                            <p style="
                                color: #666;
                                font-size: 14px;
                                line-height: 1.4;
                                margin-bottom: 15px;
                            ">
                                ${prompt.promptText ? prompt.promptText.substring(0, 150) + '...' : 'Kein Text'}
                            </p>
                            
                            <button style="
                                background: linear-gradient(135deg, #667eea, #764ba2);
                                color: white;
                                border: none;
                                padding: 8px 16px;
                                border-radius: 6px;
                                cursor: pointer;
                                font-weight: 600;
                                width: 100%;
                            ">
                                🚀 Ausführen
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function executeNotionPrompt(promptId) {
            const prompt = notionPrompts.find(p => p.id === promptId);
            if (!prompt) return;
            
            currentPrompt = {
                id: promptId,
                title: prompt.title || 'Notion Prompt',
                prompt: prompt.promptText || ''
            };
            
            document.getElementById('modalTitle').textContent = prompt.title || 'Notion Prompt';
            document.getElementById('modalPrompt').textContent = prompt.promptText || '';
            document.getElementById('contextInput').value = '';
            document.getElementById('aiResponse').classList.remove('active');
            document.getElementById('executeModal').classList.add('active');
        }

        async function syncWithNotion() {
            showNotification('🔄 Notion Sync wird ausgeführt...', 'success');
            await loadNotionPrompts();
        }

        // ==========================
        // HELPER FUNCTIONS
        // ==========================
        function handleDecision(action) {
            if (action === 'approve') {
                showNotification('✅ Entscheidung freigegeben', 'success');
            } else {
                showNotification('📤 An Controller Agent delegiert', 'success');
            }
            event.target.closest('.decision-item').style.display = 'none';
        }

        function selectAgent(agentName) {
            showNotification(`Agent ${agentName} ausgewählt`, 'success');
        }

        function createWorkflow() {
            const workflowName = prompt('Name des neuen Workflows:');
            if (workflowName) {
                showNotification(`Workflow "${workflowName}" erstellt`, 'success');
            }
        }

        function startTemplate(template) {
            showNotification(`Template "${template}" gestartet`, 'success');
        }

        function quickAction() {
            const action = prompt('Quick Action:\n1. Neue Rechnung\n2. Report\n3. Chat\n\nWählen Sie (1-3):');
            if (action) {
                showNotification(`Quick Action ${action} wird ausgeführt`, 'success');
            }
        }

        function sendTeamMessage() {
            const input = document.getElementById('teamMessageInput');
            const message = input.value.trim();
            
            if (message) {
                const chatContainer = document.getElementById('chat-messages');
                const newMessage = document.createElement('div');
                newMessage.className = 'chat-message';
                newMessage.innerHTML = `
                    <div class="message-author">Human</div>
                    <div class="message-content">${message}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}</div>
                `;
                chatContainer.appendChild(newMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                input.value = '';
                
                // Simulate agent response
                setTimeout(() => {
                    const response = document.createElement('div');
                    response.className = 'chat-message';
                    response.innerHTML = `
                        <div class="message-author">Controller Agent</div>
                        <div class="message-content">Nachricht erhalten. Wird bearbeitet.</div>
                        <div class="message-time">${new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' })}</div>
                    `;
                    chatContainer.appendChild(response);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 1000);
            }
        }

        function showNotification(message, type = 'success') {
            const existing = document.querySelector('.notification-toast');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'notification-toast';
            notification.style.background = type === 'success' ? '#10b981' : '#ef4444';
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Simulate real-time updates
        setInterval(() => {
            if (currentMode === 'executive') {
                const kpis = document.querySelectorAll('.kpi-value');
                if (kpis.length > 0) {
                    const randomKpi = kpis[Math.floor(Math.random() * kpis.length)];
                    randomKpi.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        randomKpi.style.transform = 'scale(1)';
                    }, 300);
                }
            }
        }, 5000);

        // Handle Enter key in search
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Check for emails on load
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('session')) {
                const emailCountElement = document.getElementById('emailCountMA');
                const emailStatusElement = document.getElementById('emailStatus');
                
                if (emailCountElement) emailCountElement.textContent = '1';
                if (emailStatusElement) {
                    emailStatusElement.style.background = '#dcfce7';
                    emailStatusElement.style.color = '#166534';
                }
            }
        });
        // ==========================
        // SAP INTEGRATION FUNCTIONS
        // ==========================
        
        function connectToSAP() {
            const statusDiv = document.getElementById('sapStatus');
            statusDiv.innerHTML = '⏳ Verbinde mit SAP...';
            statusDiv.style.background = '#fff3cd';
            
            setTimeout(() => {
                statusDiv.innerHTML = '✅ Erfolgreich mit SAP verbunden!';
                statusDiv.style.background = '#d4edda';
                showNotification('✅ SAP Verbindung hergestellt!', 'success');
            }, 2000);
        }
        
        function loadSAPData() {
            const statusDiv = document.getElementById('sapStatus');
            const dataContainer = document.getElementById('sapDataContainer');
            const tableBody = document.getElementById('sapTableBody');
            
            statusDiv.innerHTML = '⏳ Lade Daten von SAP...';
            
            setTimeout(() => {
                // Test-Daten
                const testData = [
                    { doc: '5100000847', vendor: 'Microsoft GmbH', amount: '45.000 €', status: 'Offen' },
                    { doc: '5100000848', vendor: 'Amazon AWS', amount: '12.500 €', status: 'Bezahlt' },
                    { doc: '5100000849', vendor: 'SAP SE', amount: '78.000 €', status: 'Prüfung' }
                ];
                
                let html = '';
                testData.forEach(row => {
                    html += `
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #ddd;">${row.doc}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #ddd;">${row.vendor}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #ddd;">${row.amount}</td>
                            <td style="padding: 10px; border-bottom: 1px solid #ddd;">
                                <span style="background: ${row.status === 'Offen' ? '#ffc107' : row.status === 'Bezahlt' ? '#28a745' : '#17a2b8'}; 
                                             color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                                    ${row.status}
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                tableBody.innerHTML = html;
                dataContainer.style.display = 'block';
                statusDiv.innerHTML = '✅ SAP Daten erfolgreich geladen!';
                statusDiv.style.background = '#d4edda';
                
                showNotification('✅ 3 Rechnungen aus SAP geladen!', 'success');
            }, 2000);
        }
    </script>
</body>
</html>
