<!-- Header -->
<header class="header">
    <div class="header-content">
        <div class="logo">
            <span>üöÄ</span>
            <span>ALBO AI</span>
        </div>
        
        <div class="mode-switcher">
            <button class="mode-btn active" onclick="switchMode('executive')">
                <span>üìä</span>
                <span>Executive</span>
            </button>
            <button class="mode-btn" onclick="switchMode('team')">
                <span>üë•</span>
                <span>Team</span>
            </button>
            <button class="mode-btn" onclick="switchMode('workflow')">
                <span>‚ö°</span>
                <span>Workflows</span>
            </button>
            <button class="mode-btn" onclick="switchMode('legacy')">
                <span>üìö</span>
                <span>Prompts</span>
            </button>
        </div>
        
        <div class="header-actions">
            <div class="notification-badge">
                <span>üîî</span>
                <span class="badge-count">3</span>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>üë§</span>
                <span style="font-weight: 600;">CFO</span>
            </div>
        </div>
    </div>
</header>

<!-- Main Container -->
<div class="main-container">
    
    <!-- Executive View -->
    <div class="mode-content active" id="executive-view">
        <!-- Notion Prompts Section (wenn geladen) -->
        <div id="notion-prompts-section" style="display: none;"></div>
        
        <div class="executive-layout">
            <div class="main-section">
                <!-- KPI Cards -->
                <div class="executive-grid">
                    <div class="kpi-card">
                        <div class="kpi-label">Umsatz YTD</div>
                        <div class="kpi-value">‚Ç¨12.4M</div>
                        <div class="kpi-change positive">
                            <span>‚Üë</span>
                            <span>23% vs VJ</span>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">EBITDA</div>
                        <div class="kpi-value">‚Ç¨2.3M</div>
                        <div class="kpi-change positive">
                            <span>‚Üë</span>
                            <span>18% vs Plan</span>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">Cash Position</div>
                        <div class="kpi-value">‚Ç¨4.7M</div>
                        <div class="kpi-change negative">
                            <span>‚Üì</span>
                            <span>5% vs Vormonat</span>
                        </div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-label">Working Capital</div>
                        <div class="kpi-value">‚Ç¨1.2M</div>
                        <div class="kpi-change positive">
                            <span>‚Üë</span>
                            <span>Optimiert</span>
                        </div>
                    </div>
                </div>

                <!-- Agent Performance -->
                <div class="workflow-container">
                    <div class="workflow-header">
                        <div class="workflow-title">ü§ñ Agent Performance Today</div>
                    </div>
                    
                    <div class="executive-grid">
                        <div class="kpi-card">
                            <div class="kpi-label">Aktive Agenten</div>
                            <div class="kpi-value">11/11</div>
                            <div class="kpi-change positive">
                                <span>‚óè</span>
                                <span>Alle Online</span>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label">Tasks Completed</div>
                            <div class="kpi-value">1,247</div>
                            <div class="kpi-change positive">
                                <span>‚Üë</span>
                                <span>99.7% Success</span>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label">Zeit gespart</div>
                            <div class="kpi-value">147h</div>
                            <div class="kpi-change positive">
                                <span>‚ö°</span>
                                <span>Diese Woche</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="side-section">
                <!-- Critical Decisions -->
                <div class="decision-container">
                    <div class="decision-header">
                        <span>‚ö†Ô∏è</span>
                        <span>Kritische Entscheidungen</span>
                    </div>
                    
                    <div class="decision-item">
                        <div class="decision-content">
                            <div class="decision-title">Investment Freigabe</div>
                            <div class="decision-desc">‚Ç¨2M f√ºr neue Produktionslinie</div>
                        </div>
                        <div class="decision-actions">
                            <button class="btn btn-approve" onclick="handleDecision('approve')">Freigeben</button>
                            <button class="btn btn-delegate" onclick="handleDecision('delegate')">Delegieren</button>
                        </div>
                    </div>
                    
                    <div class="decision-item">
                        <div class="decision-content">
                            <div class="decision-title">Kreditlinie Erh√∂hung</div>
                            <div class="decision-desc">Treasury empfiehlt +‚Ç¨3M</div>
                        </div>
                        <div class="decision-actions">
                            <button class="btn btn-approve" onclick="handleDecision('approve')">Freigeben</button>
                            <button class="btn btn-delegate" onclick="handleDecision('delegate')">Analyse</button>
                        </div>
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="activity-feed">
                    <div class="activity-header">üìà Live Activity</div>
                    
                    <div class="activity-item">
                        <div class="activity-icon success">‚úì</div>
                        <div class="activity-content">
                            <div class="activity-title">Monatsabschluss Oktober</div>
                            <div class="activity-desc">Controller Agent: Abgeschlossen</div>
                            <div class="activity-time">vor 5 Minuten</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon warning">!</div>
                        <div class="activity-content">
                            <div class="activity-title">Liquidit√§tswarnung</div>
                            <div class="activity-desc">Treasury: Engpass in 30 Tagen m√∂glich</div>
                            <div class="activity-time">vor 12 Minuten</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon info">üìß</div>
                        <div class="activity-content">
                            <div class="activity-title">234 Rechnungen verarbeitet</div>
                            <div class="activity-desc">Kreditor Agent: Skonto ‚Ç¨4,500 realisiert</div>
                            <div class="activity-time">vor 23 Minuten</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team View -->
    <div class="mode-content" id="team-view">
        <h2 style="color: white; margin-bottom: 30px;">Mein Finance Team - 11 KI-Agenten</h2>
        
        <div class="team-grid">
            <div class="agent-card" onclick="selectAgent('CFO')">
                <div class="agent-avatar">üëî</div>
                <div class="agent-name">CFO</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">5 Entscheidungen</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Controller')">
                <div class="agent-avatar">üìä</div>
                <div class="agent-name">Controller</div>
                <div><span class="agent-status status-busy"></span>Working</div>
                <div class="agent-tasks">23 Reports</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Treasury')">
                <div class="agent-avatar">üè¶</div>
                <div class="agent-name">Treasury</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Cash Forecast</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Bilanzbuchhalter')">
                <div class="agent-avatar">üìö</div>
                <div class="agent-name">Bilanz</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Monatsabschluss</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Kreditor')">
                <div class="agent-avatar">üí≥</div>
                <div class="agent-name">Kreditor</div>
                <div><span class="agent-status status-busy"></span>Busy</div>
                <div class="agent-tasks">47 Rechnungen</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Debitor')">
                <div class="agent-avatar">üí∞</div>
                <div class="agent-name">Debitor</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Mahnlauf</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Anlagen')">
                <div class="agent-avatar">üè≠</div>
                <div class="agent-name">Anlagen</div>
                <div><span class="agent-status status-offline"></span>Idle</div>
                <div class="agent-tasks">AfA berechnet</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Business Dev')">
                <div class="agent-avatar">üöÄ</div>
                <div class="agent-name">Business Dev</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">M&A Analyse</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('M&A')">
                <div class="agent-avatar">ü§ù</div>
                <div class="agent-name">M&A Berater</div>
                <div><span class="agent-status status-busy"></span>Analyzing</div>
                <div class="agent-tasks">Due Diligence</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Anwalt')">
                <div class="agent-avatar">‚öñÔ∏è</div>
                <div class="agent-name">Anwalt</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Vertragsreview</div>
            </div>
            
            <div class="agent-card" onclick="selectAgent('Steuerberater')">
                <div class="agent-avatar">üìã</div>
                <div class="agent-name">Steuerberater</div>
                <div><span class="agent-status status-online"></span>Online</div>
                <div class="agent-tasks">Tax Compliance</div>
            </div>
        </div>

        <!-- Team Chat -->
        <div class="team-chat">
            <div class="chat-header">üí¨ Team Communication</div>
            <div class="chat-messages" id="chat-messages">
                <div class="chat-message">
                    <div class="message-author">CFO Agent</div>
                    <div class="message-content">Team, bitte Monatsabschluss Oktober priorisieren.</div>
                    <div class="message-time">10:23</div>
                </div>
                
                <div class="chat-message">
                    <div class="message-author">Controller Agent</div>
                    <div class="message-content">Verstanden. Koordiniere mit Buchhaltung. ETA: 4 Stunden.</div>
                    <div class="message-time">10:24</div>
                </div>
                
                <div class="chat-message">
                    <div class="message-author">Kreditor Agent</div>
                    <div class="message-content">47 offene Rechnungen. Ben√∂tige Freigabe f√ºr 3 √ºber ‚Ç¨10k.</div>
                    <div class="message-time">10:25</div>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" placeholder="Nachricht an Team..." style="flex: 1; padding: 10px; border: 1px solid var(--light); border-radius: 8px;">
                <button class="btn btn-delegate">Senden</button>
            </div>
        </div>
    </div>

    <!-- Workflow View -->
    <div class="mode-content" id="workflow-view">
        <div class="workflow-container">
            <div class="workflow-header">
                <div class="workflow-title">‚ö° Aktive Workflows</div>
                <button class="btn btn-delegate" onclick="createWorkflow()">+ Neuer Workflow</button>
            </div>
            
            <div class="workflow-item">
                <div class="workflow-name">üìä Monatsabschluss Oktober 2024</div>
                <div class="workflow-progress">
                    <div class="workflow-progress-bar" style="width: 78%"></div>
                </div>
                <div class="workflow-stats">
                    <span>Step 7/9 - Konsolidierung l√§uft...</span>
                    <span>ETA: 45 Minuten</span>
                </div>
            </div>
            
            <div class="workflow-item">
                <div class="workflow-name">üí≥ Rechnungsverarbeitung Batch #4521</div>
                <div class="workflow-progress">
                    <div class="workflow-progress-bar" style="width: 100%"></div>
                </div>
                <div class="workflow-stats">
                    <span>‚úÖ Abgeschlossen - 234 Rechnungen verarbeitet</span>
                    <span>Zeit: 23 Minuten</span>
                </div>
            </div>
            
            <div class="workflow-item">
                <div class="workflow-name">ü§ù M&A Due Diligence - TechStartup GmbH</div>
                <div class="workflow-progress">
                    <div class="workflow-progress-bar" style="width: 45%"></div>
                </div>
                <div class="workflow-stats">
                    <span>Step 4/9 - Financial Analysis</span>
                    <span>3 Agenten aktiv</span>
                </div>
            </div>
        </div>

        <!-- Workflow Templates -->
        <div class="workflow-container">
            <div class="workflow-header">
                <div class="workflow-title">üìã Quick Start Templates</div>
            </div>
            
            <div class="executive-grid">
                <div class="kpi-card" style="cursor: pointer;" onclick="startTemplate('monthly-close')">
                    <div class="kpi-label">Standard Process</div>
                    <div style="font-size: 24px; margin: 10px 0;">üìä</div>
                    <div style="font-weight: bold; color: var(--dark);">Monatsabschluss</div>
                    <div style="color: var(--gray); font-size: 14px; margin-top: 8px;">9 Steps ‚Ä¢ 4-6 Stunden ‚Ä¢ 5 Agenten</div>
                </div>
                
                <div class="kpi-card" style="cursor: pointer;" onclick="startTemplate('invoice-processing')">
                    <div class="kpi-label">Automation</div>
                    <div style="font-size: 24px; margin: 10px 0;">üí≥</div>
                    <div style="font-weight: bold; color: var(--dark);">Rechnungsverarbeitung</div>
                    <div style="color: var(--gray); font-size: 14px; margin-top: 8px;">5 Steps ‚Ä¢ 30 Min ‚Ä¢ 3 Agenten</div>
                </div>
                
                <div class="kpi-card" style="cursor: pointer;" onclick="startTemplate('ma-evaluation')">
                    <div class="kpi-label">Complex Analysis</div>
                    <div style="font-size: 24px; margin: 10px 0;">ü§ù</div>
                    <div style="font-weight: bold; color: var(--dark);">M&A Evaluation</div>
                    <div style="color: var(--gray); font-size: 14px; margin-top: 8px;">12 Steps ‚Ä¢ 2-3 Tage ‚Ä¢ 7 Agenten</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Legacy View (Original Prompts) -->
    <div class="mode-content" id="legacy-view">
        <!-- Diese Sektion wird von deinen bestehenden Funktionen gef√ºllt -->
        <div id="legacy-dashboard-content"></div>
    </div>
</div>

<!-- Quick Actions FAB -->
<div class="quick-actions">
    <button class="fab" onclick="quickAction()">+</button>
</div>

<!-- Notion Sync Button -->
<button onclick="syncWithNotion()" style="
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 30px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
">
    üîÑ Notion Sync
</button>

<script>
    // Global variables
    let currentMode = 'executive';
    let notionPrompts = [];

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
        console.log('üéØ ALBO AI Dashboard geladen');
        
        // Hide loading screen
        setTimeout(() => {
            document.getElementById('loadingScreen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 500);
        }, 1000);

        // Load Notion prompts
        loadNotionPrompts();
        
        // Initialize legacy content if needed
        initializeLegacyDashboard();
    });

    // Mode Switching
    function switchMode(mode) {
        currentMode = mode;
        
        // Update buttons
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.closest('.mode-btn').classList.add('active');
        
        // Update content
        document.querySelectorAll('.mode-content').forEach(content => {
            content.classList.remove('active');
        });
        document.getElementById(mode + '-view').classList.add('active');
        
        // Animate transition
        document.getElementById(mode + '-view').style.animation = 'fadeIn 0.5s ease';
    }

    // Handle Decision
    function handleDecision(action) {
        if (action === 'approve') {
            alert('‚úÖ Entscheidung freigegeben und an relevante Agenten weitergeleitet.');
        } else {
            alert('üì§ An Controller Agent zur detaillierten Analyse delegiert.');
        }
        // Remove the decision item
        event.target.closest('.decision-item').style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => {
            event.target.closest('.decision-item').remove();
        }, 300);
    }

    // Select Agent
    function selectAgent(agentName) {
        alert(`Agent ${agentName} ausgew√§hlt. Detailansicht w√ºrde hier √∂ffnen.`);
    }

    // Create Workflow
    function createWorkflow() {
        const workflowName = prompt('Name des neuen Workflows:');
        if (workflowName) {
            alert(`Workflow "${workflowName}" wird erstellt. Workflow-Builder w√ºrde hier √∂ffnen.`);
        }
    }

    // Start Template
    function startTemplate(template) {
        const templates = {
            'monthly-close': 'Monatsabschluss Workflow',
            'invoice-processing': 'Rechnungsverarbeitung Workflow',
            'ma-evaluation': 'M&A Evaluation Workflow'
        };
        alert(`Template "${templates[template]}" wird gestartet. Agenten werden aktiviert...`);
    }

    // Quick Action
    function quickAction() {
        const action = prompt('Quick Action:\n1. Neue Rechnung\n2. Report erstellen\n3. Agent Chat\n\nW√§hlen Sie (1-3):');
        if (action) {
            alert(`Quick Action ${action} wird ausgef√ºhrt...`);
        }
    }

    // Notion Integration
    async function loadNotionPrompts() {
        try {
            const response = await fetch('https://albo-saa-s-backend.vercel.app/api/notion-bundled');
            const data = await response.json();
            
            if (data.success && data.prompts.length > 0) {
                console.log('‚úÖ Notion Prompts geladen:', data.prompts);
                notionPrompts = data.prompts;
                displayNotionPrompts(data.prompts);
            }
        } catch (error) {
            console.error('Error loading Notion prompts:', error);
        }
    }

    function displayNotionPrompts(prompts) {
        const container = document.getElementById('notion-prompts-section');
        if (!container) return;
        
        container.style.display = 'block';
        container.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 32px;">üìö</span>
                    <span>Meine Notion Prompts (${prompts.length})</span>
                </h2>
                <div style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px;">
                    ‚úÖ Live synchronisiert
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                ${prompts.map(prompt => `
                    <div style="
                        background: white;
                        color: #333;
                        padding: 20px;
                        border-radius: 12px;
                        cursor: pointer;
                        transition: transform 0.3s;
                    " onmouseover="this.style.transform='translateY(-5px)'" 
                       onmouseout="this.style.transform='translateY(0)'"
                       onclick="executeNotionPrompt('${prompt.id}')">
                        
                        <h3 style="margin: 0 0 10px 0; color: #667eea;">
                            ${prompt.title || 'Unbenannt'}
                        </h3>
                        
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <span style="
                                background: #e3f2fd;
                                color: #1976d2;
                                padding: 4px 8px;
                                border-radius: 4px;
                                font-size: 12px;
                            ">${prompt.category || 'Allgemein'}</span>
                            
                            <span style="
                                background: #fce4ec;
                                color: #c2185b;
                                padding: 4px 8px;
                                border-radius: 4px;
                                font-size: 12px;
                            ">${prompt.role || 'Controller'}</span>
                        </div>
                        
                        <p style="
                            color: #666;
                            font-size: 14px;
                            line-height: 1.4;
                            margin-bottom: 15px;
                        ">
                            ${prompt.promptText ? prompt.promptText.substring(0, 150) + '...' : 'Kein Text'}
                        </p>
                        
                        <button style="
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: 600;
                            width: 100%;
                        ">
                            üöÄ Ausf√ºhren
                        </button>
                    </div>
                `).join('')}
            </div>
        `;
    }

    function executeNotionPrompt(promptId) {
        const prompt = notionPrompts.find(p => p.id === promptId);
        if (!prompt) return;
        
        alert(`Prompt "${prompt.title}" wird ausgef√ºhrt...`);
        // Hier w√ºrde die Modal-Logik kommen
    }

    async function syncWithNotion() {
        alert('Notion Sync wird ausgef√ºhrt...');
        await loadNotionPrompts();
    }

    // Initialize Legacy Dashboard
    function initializeLegacyDashboard() {
        const legacyContainer = document.getElementById('legacy-dashboard-content');
        if (legacyContainer) {
            legacyContainer.innerHTML = `
                <div style="padding: 20px; background: white; border-radius: 16px;">
                    <h2>Finance Prompts Library</h2>
                    <p>Hier werden deine Original-Prompts angezeigt...</p>
                </div>
            `;
        }
    }

    // Simulate real-time updates
    setInterval(() => {
        // Update random KPI
        const kpis = document.querySelectorAll('.kpi-value');
        if (kpis.length > 0 && currentMode === 'executive') {
            const randomKpi = kpis[Math.floor(Math.random() * kpis.length)];
            randomKpi.style.transform = 'scale(1.05)';
            setTimeout(() => {
                randomKpi.style.transform = 'scale(1)';
            }, 300);
        }
    }, 5000);

    // Simulate chat messages
    const chatMessages = [
        { author: 'Bilanz Agent', content: 'Konsolidierung abgeschlossen. Zahlen sehen gut aus.' },
        { author: 'CFO Agent', content: 'Excellent! Bitte Report an Board vorbereiten.' },
        { author: 'Steuerberater Agent', content: 'Steuerliche Optimierung: ‚Ç¨45k Ersparnis identifiziert.' },
        { author: 'Anwalt Agent', content: 'Alle Compliance-Checks bestanden ‚úì' },
        { author: 'Debitor Agent', content: '‚Ç¨234k Zahlungseing√§nge heute verbucht.' }
    ];

    let messageIndex = 0;
    setInterval(() => {
        const chatContainer = document.getElementById('chat-messages');
        if (chatContainer && currentMode === 'team') {
            const message = chatMessages[messageIndex % chatMessages.length];
            const time = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
            
            const newMessage = document.createElement('div');
            newMessage.className = 'chat-message';
            newMessage.innerHTML = `
                <div class="message-author">${message.author}</div>
                <div class="message-content">${message.content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatContainer.appendChild(newMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            messageIndex++;
        }
    }, 15000);
</script>
