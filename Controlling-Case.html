<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFO Dashboard - Business Case WCAR Schaltschrankkomponenten</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --gray: #6b7280;
            --gray-light: #f8fafc;
            --border: #e5e7eb;
            --text: #1f2937;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-light);
            color: var(--text);
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 16px 24px;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 20px;
            font-weight: 600;
        }

        .subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .header-stats {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.8;
            text-transform: uppercase;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .dashboard-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar {
            width: 300px;
            background: var(--white);
            border-right: 1px solid var(--border);
            overflow-y: auto;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            display: flex;
            padding: 0 24px;
        }

        .tab-btn {
            padding: 16px 24px;
            border: none;
            background: none;
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--primary);
            background: var(--gray-light);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--gray-light);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Dashboard Tab Styles */
        .quick-controls {
            background: var(--white);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 24px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 150px;
        }

        .control-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
        }

        .control-slider {
            appearance: none;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            outline: none;
        }

        .control-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .control-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            text-align: center;
        }

        .artikel-toggle {
            display: flex;
            gap: 8px;
        }

        .artikel-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .artikel-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Charts Area */
        .charts-area {
            flex: 1;
            padding: 24px;
            overflow: auto;
        }

        .charts-grid-three {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            height: 100%;
        }

        /* Dashboard Grid - Original Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            height: calc(100vh - 200px);
            padding: 24px;
        }

        /* New Dashboard Layout - 6 Charts wie Excel */
        .dashboard-main {
            padding: 24px;
            overflow-y: auto;
            height: calc(100vh - 150px);
        }

        .charts-row-top,
        .charts-row-middle,
        .charts-row-bottom {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .charts-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .kpi-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .chart-panel {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            min-height: 300px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .chart-info {
            font-size: 11px;
            color: var(--gray);
            background: var(--gray-light);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .chart-container {
            position: relative;
            height: 220px;
            flex: 1;
        }

        /* Special Containers */
        .chart-container-special {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .kumuliert-display {
            text-align: center;
            background: var(--gray-light);
            padding: 40px;
            border-radius: 8px;
            border: 2px solid var(--primary);
        }

        .kumuliert-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .kumuliert-label {
            font-size: 14px;
            color: var(--gray);
            font-weight: 600;
        }

        /* Projekte Mini Table */
        .projekte-panel {
            min-height: 300px;
        }

        .projekte-mini-table {
            flex: 1;
            font-size: 11px;
        }

        .projekt-row {
            display: grid;
            grid-template-columns: auto auto;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .projekt-row:last-child {
            border-bottom: none;
        }

        .projekt-col {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .projekt-label {
            font-weight: 600;
            color: var(--gray);
            padding: 4px 0;
        }

        .projekt-name {
            font-weight: 600;
            color: var(--text);
            font-size: 10px;
        }

        .projekt-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .projekt-value {
            padding: 4px 0;
            color: var(--text);
        }

        .projekt-value div {
            margin-bottom: 2px;
        }

        /* Amortisation Display */
        .amortisation-display {
            text-align: center;
            background: var(--gray-light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .amortisation-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 4px;
        }

        .amortisation-label {
            font-size: 12px;
            color: var(--gray);
            font-weight: 600;
        }

        /* Szenarien Box */
        .szenarien-box {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
        }

        .szenarien-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .szenarien-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .szenario-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            font-size: 10px;
            padding: 2px 0;
        }

        .szenario-row span:first-child {
            color: var(--gray);
        }

        .szenario-row span:last-child {
            color: var(--text);
            font-weight: 600;
            background: var(--gray-light);
            padding: 2px 6px;
            border-radius: 3px;
            text-align: center;
        }

        /* Executive Summary */
        .executive-summary {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .summary-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }

        .summary-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .summary-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }

        .summary-item.positive {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .summary-label {
            font-size: 11px;
            opacity: 0.8;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .summary-value {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .summary-detail {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Key Metrics */
        .key-metrics {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .metrics-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .metric-item {
            padding: 16px;
            background: var(--gray-light);
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--primary);
        }

        .metric-value.positive {
            color: var(--success);
        }

        .metric-value.warning {
            color: var(--warning);
        }

        .metric-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .metric-trend {
            font-size: 10px;
            color: var(--gray);
        }

        /* Risk Matrix */
        .risk-matrix {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .risk-grid {
            display: grid;
            grid-template-columns: auto repeat(3, 1fr);
            grid-template-rows: repeat(4, 40px);
            gap: 1px;
            background: var(--border);
            margin-top: 12px;
        }

        .risk-cell {
            background: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 500;
        }

        .risk-label {
            background: var(--gray-light);
            color: var(--gray);
            font-weight: 600;
        }

        .risk-item {
            background: #fee2e2;
            color: var(--danger);
            font-size: 10px;
            padding: 4px;
            text-align: center;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .risk-medium {
            background: #fef3c7;
            color: var(--warning);
        }

        .risk-low {
            background: #dcfce7;
            color: var(--success);
        }

        /* Assumptions Tab */
        .assumptions-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .assumptions-section {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .artikel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .artikel-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .artikel-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.15);
            transform: translateY(-2px);
        }

        .artikel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .artikel-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .artikel-effect {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .neu-produkt {
            background: #dbeafe;
            color: var(--primary);
        }

        .cross-selling {
            background: #dcfce7;
            color: var(--success);
        }

        .artikel-details {
            margin-bottom: 16px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 13px;
        }

        .detail-label {
            color: var(--gray);
            font-weight: 500;
        }

        .detail-value {
            color: var(--text);
            font-weight: 600;
        }

        .detail-value.success {
            color: var(--success);
        }

        .artikel-assumptions {
            background: var(--gray-light);
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--gray);
            border-left: 3px solid var(--primary);
        }

        .add-artikel-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-artikel-btn:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        /* Projekt-Kosten-Tabelle */
        .projekt-kosten-table {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            background: var(--white);
        }

        .kosten-header {
            display: grid;
            grid-template-columns: 300px repeat(7, 1fr) 120px;
            background: var(--primary);
            color: white;
        }

        .kosten-header-cell {
            padding: 12px 8px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .kosten-header-cell:last-child {
            border-right: none;
        }

        .category-header {
            text-align: left;
            padding-left: 16px;
        }

        .kosten-row {
            display: grid;
            grid-template-columns: 300px repeat(7, 1fr) 120px;
            border-bottom: 1px solid var(--border);
        }

        .kosten-row:last-child {
            border-bottom: none;
        }

        .kosten-row.capex-row {
            background: #fef3c7;
        }

        .kosten-row.gesamt-row {
            background: var(--primary-light);
            color: white;
            font-weight: 600;
        }

        .kosten-cell {
            padding: 12px 8px;
            border-right: 1px solid var(--border);
            display: flex;
            align-items: center;
            font-size: 13px;
        }

        .kosten-cell:last-child {
            border-right: none;
        }

        .category-cell {
            padding-left: 16px;
            font-weight: 500;
            color: var(--text);
        }

        .input-cell {
            padding: 4px;
            justify-content: center;
        }

        .total-cell {
            background: var(--gray-light);
            justify-content: center;
            font-weight: 600;
            color: var(--primary);
        }

        .capex-cell {
            background: #fbbf24;
        }

        .capex-total {
            background: #f59e0b;
            color: white;
        }

        .grand-total {
            background: var(--primary);
            color: white;
        }

        .total-label {
            background: var(--primary-light);
            color: white;
            font-weight: 600;
        }

        .kosten-input {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
            transition: all 0.2s;
        }

        .kosten-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.1);
        }

        .capex-input {
            background: #fbbf24;
            color: white;
            font-weight: 600;
        }

        .capex-input::placeholder {
            color: rgba(255,255,255,0.8);
        }

        .add-kategorie-btn {
            background: var(--gray-light);
            color: var(--gray);
            border: 1px dashed var(--border);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-kategorie-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Responsive f√ºr Projekt-Tabelle */
        @media (max-width: 1400px) {
            .kosten-header,
            .kosten-row {
                grid-template-columns: 250px repeat(4, 1fr) 100px;
            }
            
            /* Hide years 2028-2030 on smaller screens */
            .kosten-header-cell:nth-child(6),
            .kosten-header-cell:nth-child(7),
            .kosten-header-cell:nth-child(8),
            .kosten-cell:nth-child(6),
            .kosten-cell:nth-child(7),
            .kosten-cell:nth-child(8) {
                display: none;
            }
        }

        @media (max-width: 1000px) {
            .kosten-header,
            .kosten-row {
                grid-template-columns: 200px repeat(3, 1fr) 80px;
            }
            
            /* Hide even more years on mobile */
            .kosten-header-cell:nth-child(5),
            .kosten-cell:nth-child(5) {
                display: none;
            }
        }

        /* Wirtschaftlichkeits-Tabelle */
        .wirtschaftlichkeit-table {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            background: var(--white);
            margin-bottom: 24px;
        }

        .db-header {
            display: grid;
            grid-template-columns: 300px repeat(7, 1fr) 120px;
            background: var(--primary);
            color: white;
        }

        .db-header-cell {
            padding: 12px 8px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .db-header-cell:last-child {
            border-right: none;
        }

        .metric-header {
            text-align: left;
            padding-left: 16px;
        }

        .db-row {
            display: grid;
            grid-template-columns: 300px repeat(7, 1fr) 120px;
            border-bottom: 1px solid var(--border);
        }

        .db-row:last-child {
            border-bottom: none;
        }

        .db-row.umsatz-row {
            background: #dbeafe;
        }

        .db-row.db1-row,
        .db-row.db2-row {
            background: #f0f9ff;
            font-weight: 600;
        }

        .db-row.db3-row {
            background: var(--primary-light);
            color: white;
            font-weight: 700;
        }

        .db-row.projekt-row {
            background: #fef3c7;
        }

        .db-row.margin-row {
            background: var(--gray-light);
            font-style: italic;
        }

        .db-cell {
            padding: 12px 8px;
            border-right: 1px solid var(--border);
            display: flex;
            align-items: center;
            font-size: 13px;
        }

        .db-cell:last-child {
            border-right: none;
        }

        .metric-cell {
            padding-left: 16px;
            font-weight: 500;
            color: var(--text);
        }

        .metric-cell.bold {
            font-weight: 700;
        }

        .metric-cell.final {
            color: white;
            font-weight: 700;
        }

        .value-cell {
            justify-content: center;
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        .value-cell.final {
            color: white;
            font-weight: 700;
        }

        .value-cell.negative {
            color: var(--danger);
        }

        .value-cell.positive {
            color: var(--success);
        }

        .total-cell {
            background: var(--gray-light);
            justify-content: center;
            font-weight: 700;
            color: var(--primary);
        }

        .total-cell.negative {
            color: var(--danger);
        }

        .total-cell.positive {
            color: var(--success);
        }

        .total-cell.final {
            background: var(--primary);
            color: white;
        }

        /* Amortisations-Analyse */
        .amortisation-panel {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
        }

        .amortisation-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .cashflow-table {
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
        }

        .cashflow-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            border-bottom: 1px solid var(--border);
        }

        .cashflow-row:last-child {
            border-bottom: none;
        }

        .cashflow-row.header {
            background: var(--gray-light);
            font-weight: 600;
        }

        .cashflow-row.breakeven {
            background: #dcfce7;
            font-weight: 600;
        }

        .cashflow-cell {
            padding: 8px 12px;
            font-size: 12px;
            text-align: center;
            border-right: 1px solid var(--border);
        }

        .cashflow-cell:last-child {
            border-right: none;
        }

        .cashflow-cell.negative {
            color: var(--danger);
        }

        .cashflow-cell.positive {
            color: var(--success);
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .kpi-item {
            background: var(--gray-light);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }

        .kpi-item.success {
            background: #dcfce7;
            border: 1px solid var(--success);
        }

        .kpi-item.warning {
            background: #fef3c7;
            border: 1px solid var(--warning);
        }

        .kpi-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .kpi-item.success .kpi-value {
            color: var(--success);
        }

        .kpi-item.warning .kpi-value {
            color: var(--warning);
        }

        .kpi-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .kpi-detail {
            font-size: 10px;
            color: var(--gray);
        }

        .bewertung-box {
            background: #f0f9ff;
            border: 1px solid var(--success);
            border-radius: 6px;
            padding: 16px;
            text-align: center;
        }

        .bewertung-status {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .bewertung-status.success {
            color: var(--success);
        }

        .bewertung-text {
            font-size: 12px;
            line-height: 1.4;
            color: var(--text);
        }

        /* Responsive f√ºr Wirtschaftlichkeits-Tabelle */
        @media (max-width: 1400px) {
            .db-header,
            .db-row {
                grid-template-columns: 250px repeat(4, 1fr) 100px;
            }
            
            /* Hide years 2028-2030 on smaller screens */
            .db-header-cell:nth-child(6),
            .db-header-cell:nth-child(7),
            .db-header-cell:nth-child(8),
            .db-cell:nth-child(6),
            .db-cell:nth-child(7),
            .db-cell:nth-child(8) {
                display: none;
            }
        }

        /* Artikel Detail View */
        .artikel-detail-view {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--primary);
        }

        .detail-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }

        .back-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Sub-Tab Navigation */
        .sub-tab-navigation {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 4px;
            display: flex;
            margin-bottom: 24px;
        }

        .sub-tab-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: none;
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .sub-tab-btn:hover {
            color: var(--primary);
        }

        .sub-tab-btn.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Sub-Tab Content */
        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* Form Styles */
        .editor-form {
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-section-inline {
            margin-bottom: 32px;
        }

        .section-title-inline {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .form-grid-inline {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .form-grid-inline-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .form-group-inline {
            display: flex;
            flex-direction: column;
        }

        .form-label-inline {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input-inline, .form-select-inline {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.2s;
        }

        .form-input-inline:focus, .form-select-inline:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.1);
        }

        .form-textarea-inline {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            resize: vertical;
            min-height: 60px;
            transition: all 0.2s;
        }

        .form-textarea-inline:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.1);
        }

        .calc-display {
            background: var(--gray-light);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .calc-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .calc-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
        }

        /* Years Grid */
        .years-grid-inline {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
        }

        .year-column-inline {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid var(--border);
        }

        .year-header-inline {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            text-align: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .year-input-inline {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .year-input-inline:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.1);
        }

        .year-input-inline:last-child {
            margin-bottom: 0;
        }

        /* Editor Actions */
        .editor-actions-inline {
            padding: 20px 0;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-secondary-inline {
            padding: 10px 20px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary-inline:hover {
            border-color: var(--gray);
            color: var(--text);
        }

        .btn-primary-inline {
            padding: 10px 20px;
            border: 1px solid var(--primary);
            background: var(--primary);
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary-inline:hover {
            background: var(--primary-light);
            border-color: var(--primary-light);
            transform: translateY(-1px);
        }

        /* Sidebar */
        .ai-feed {
            padding: 20px;
        }

        .ai-feed-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
        }

        .ai-message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            background: var(--gray-light);
        }

        .ai-message.success {
            border-left-color: var(--success);
        }

        .ai-message.warning {
            border-left-color: var(--warning);
        }

        .message-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .message-text {
            font-size: 11px;
            line-height: 1.4;
            color: var(--gray);
        }

        .message-timestamp {
            font-size: 10px;
            color: var(--gray);
            margin-top: 4px;
        }

        .ai-actions {
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        .ai-action-btn {
            width: 100%;
            padding: 8px 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .ai-action-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--gray-light);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-grid-three {
                grid-template-columns: 1fr;
            }
            
            .form-grid-inline,
            .form-grid-inline-3 {
                grid-template-columns: 1fr;
            }
            
            .years-grid-inline {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
            }
            
            .years-grid-inline {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <div class="title">Business Case: WCAR Schaltschrankkomponenten</div>
                    <div class="subtitle">Erweiterte Artikel-Management mit Preis-Entwicklung √ºber Jahre</div>
                </div>
                <div class="header-stats">
                    <div class="stat">
                        <div class="stat-value">+44,7M‚Ç¨</div>
                        <div class="stat-label">NPV (9 Jahre)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">3,4J</div>
                        <div class="stat-label">Payback</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">117,8M‚Ç¨</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">34%</div>
                        <div class="stat-label">√ò DB2-Marge</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            
            <!-- Dashboard Content -->
            <div class="dashboard-content">
                
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="switchTab('dashboard')">
                        üìä Dashboard
                    </button>
                    <button class="tab-btn" onclick="switchTab('assumptions')">
                        ‚öôÔ∏è Annahmen bearbeiten
                    </button>
                    <button class="tab-btn" onclick="switchTab('analysis')">
                        üìà Analyse
                    </button>
                </div>
                
                <!-- Tab Content: Dashboard -->
                <div class="tab-content active" id="tab-dashboard">
                    <!-- Quick Controls -->
                    <div class="quick-controls">
                        <div class="control-section">
                            <span class="control-label">Marktvolumen</span>
                            <input type="range" class="control-slider" id="market-volume" 
                                   min="50" max="150" value="100" 
                                   onchange="adjustAssumption('market', this.value)">
                            <span class="control-value" id="market-value">100%</span>
                        </div>
                        
                        <div class="control-section">
                            <span class="control-label">Preis-Premium</span>
                            <input type="range" class="control-slider" id="price-premium" 
                                   min="80" max="120" value="100" 
                                   onchange="adjustAssumption('price', this.value)">
                            <span class="control-value" id="price-value">+0%</span>
                        </div>
                        
                        <div class="control-section">
                            <span class="control-label">CAPEX-Risiko</span>
                            <input type="range" class="control-slider" id="capex-risk" 
                                   min="80" max="130" value="100" 
                                   onchange="adjustAssumption('capex', this.value)">
                            <span class="control-value" id="capex-value">Plan</span>
                        </div>
                        
                        <div class="artikel-toggle">
                            <button class="artikel-btn active" onclick="toggleArtikel('all')">Alle</button>
                            <button class="artikel-btn" onclick="toggleArtikel('crimp')">Crimp</button>
                            <button class="artikel-btn" onclick="toggleArtikel('komax')">Komax</button>
                            <button class="artikel-btn" onclick="toggleArtikel('digital')">Digital</button>
                        </div>
                    </div>
                    
                    <!-- Main Dashboard - 6 Charts Layout wie Excel -->
                    <div class="dashboard-main">
                        
                        <!-- Top Row: 3 Charts -->
                        <div class="charts-row-top">
                            <!-- Umsatz Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Umsatz</div>
                                    <div class="chart-info">in Mio. ‚Ç¨</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="umsatz-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Absatz Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Absatz</div>
                                    <div class="chart-info">in T St√ºck</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="absatz-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- DB2 Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">DB 2*</div>
                                    <div class="chart-info">in Mio. ‚Ç¨ ‚Ä¢ *nach variablen Kosten</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="db2-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Middle Row: Projektkosten -->
                        <div class="charts-row-middle">
                            <!-- Projektkosten Jahres-Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Projektkosten</div>
                                    <div class="chart-info">in Mio. ‚Ç¨</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="projektkosten-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Projektkosten Kumuliert -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Projektkosten</div>
                                    <div class="chart-info">in Mio. ‚Ç¨</div>
                                </div>
                                <div class="chart-container-special">
                                    <div class="kumuliert-display">
                                        <div class="kumuliert-value">18,8</div>
                                        <div class="kumuliert-label">kumuliert</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Projekte Table -->
                            <div class="chart-panel projekte-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Projekte</div>
                                </div>
                                <div class="projekte-mini-table">
                                    <div class="projekt-row">
                                        <div class="projekt-col">
                                            <div class="projekt-label">Projektstart</div>
                                            <div class="projekt-label">Projektende</div>
                                            <div class="projekt-label">Kosten [T‚Ç¨]</div>
                                        </div>
                                    </div>
                                    <div class="projekt-row">
                                        <div class="projekt-name">WCAR_V_BM | WCAR | Verdrahtung Best Match</div>
                                        <div class="projekt-details">
                                            <div class="projekt-value">Dez 24</div>
                                            <div class="projekt-value">-</div>
                                            <div class="projekt-value">
                                                <div>10.317</div>
                                                <div>785</div>
                                                <div>5.900</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="projekt-row">
                                        <div class="projekt-name">WCAR_V_Z | WCAR | Verdrahtung Zielzustand</div>
                                        <div class="projekt-details">
                                            <div class="projekt-value">-</div>
                                            <div class="projekt-value">-</div>
                                            <div class="projekt-value">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bottom Row: Wirtschaftlichkeit -->
                        <div class="charts-row-bottom">
                            <!-- DB3 pro Jahr -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">DB 3 pro Jahr**</div>
                                    <div class="chart-info">in Mio. ‚Ç¨</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="db3-jahr-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- DB3 kumuliert -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">DB 3 kumuliert**</div>
                                    <div class="chart-info">in Mio. ‚Ç¨</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="db3-kumuliert-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Amortisation & Szenarien -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Amortisation***</div>
                                    <div class="chart-info">in Jahren</div>
                                </div>
                                <div class="amortisation-display">
                                    <div class="amortisation-value">3,4</div>
                                    <div class="amortisation-label">Jahre</div>
                                </div>
                                
                                <div class="szenarien-box">
                                    <div class="szenarien-title">Szenarien****</div>
                                    <div class="szenarien-grid">
                                        <div class="szenario-row">
                                            <span>Preise</span>
                                            <span>+/-0%</span>
                                        </div>
                                        <div class="szenario-row">
                                            <span>Mengen</span>
                                            <span>+/-0%</span>
                                        </div>
                                        <div class="szenario-row">
                                            <span>HK</span>
                                            <span>+/-0%</span>
                                        </div>
                                        <div class="szenario-row">
                                            <span>Projektkosten</span>
                                            <span>+/-0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Annahmen -->
                <div class="tab-content" id="tab-assumptions">
                    <div class="assumptions-container">
                        
                        <!-- Artikel Portfolio Overview (Hauptebene) -->
                        <div class="assumptions-section" id="artikel-overview">
                            <div class="section-title">üì¶ Artikel Portfolio - Erweiterte Ansicht</div>
                            
                            <div class="artikel-grid">
                                <!-- Crimpautomat -->
                                <div class="artikel-card" onclick="openArtikelDetail('crimp')">
                                    <div class="artikel-header">
                                        <div class="artikel-name">Crimpautomat</div>
                                        <div class="artikel-effect neu-produkt">Neu-Produkt</div>
                                    </div>
                                    <div class="artikel-details">
                                        <div class="detail-row">
                                            <span class="detail-label">Release:</span>
                                            <span class="detail-value">Dez 2024</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Peak Menge:</span>
                                            <span class="detail-value">5.000</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Start-Preis:</span>
                                            <span class="detail-value">5,00‚Ç¨</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Preis-Steigerung:</span>
                                            <span class="detail-value">+3% p.a.</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">DB2 (√ò):</span>
                                            <span class="detail-value success">37%</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Total Revenue:</span>
                                            <span class="detail-value success">87,2M‚Ç¨</span>
                                        </div>
                                    </div>
                                    <div class="artikel-assumptions">
                                        <strong>Annahmen:</strong> Innovation durch neue Linie
                                    </div>
                                </div>
                                
                                <!-- Mini-Komax -->
                                <div class="artikel-card" onclick="openArtikelDetail('komax')">
                                    <div class="artikel-header">
                                        <div class="artikel-name">Mini-Komax ohne CORE</div>
                                        <div class="artikel-effect neu-produkt">Neu-Produkt</div>
                                    </div>
                                    <div class="artikel-details">
                                        <div class="detail-row">
                                            <span class="detail-label">Release:</span>
                                            <span class="detail-value">Dez 2024</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Peak Menge:</span>
                                            <span class="detail-value">115</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Start-Preis:</span>
                                            <span class="detail-value">1.000,00‚Ç¨</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Preis-Steigerung:</span>
                                            <span class="detail-value">+2% p.a.</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">DB2 (√ò):</span>
                                            <span class="detail-value success">31%</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Total Revenue:</span>
                                            <span class="detail-value success">24,8M‚Ç¨</span>
                                        </div>
                                    </div>
                                    <div class="artikel-assumptions">
                                        <strong>Annahmen:</strong> Premium-Segment erschlie√üen
                                    </div>
                                </div>
                                
                                <!-- Digital Shopfloor -->
                                <div class="artikel-card" onclick="openArtikelDetail('digital')">
                                    <div class="artikel-header">
                                        <div class="artikel-name">Digital Shopfloor Backend</div>
                                        <div class="artikel-effect cross-selling">Cross-Selling</div>
                                    </div>
                                    <div class="artikel-details">
                                        <div class="detail-row">
                                            <span class="detail-label">Release:</span>
                                            <span class="detail-value">Jun 2025</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Peak Menge:</span>
                                            <span class="detail-value">250</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Start-Preis:</span>
                                            <span class="detail-value">480,00‚Ç¨</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Preis-Steigerung:</span>
                                            <span class="detail-value">Fixpreis</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">DB2 (√ò):</span>
                                            <span class="detail-value success">58%</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Total Revenue:</span>
                                            <span class="detail-value success">5,8M‚Ç¨</span>
                                        </div>
                                    </div>
                                    <div class="artikel-assumptions">
                                        <strong>Annahmen:</strong> 40% Aufteilung mit Best√ºckung
                                    </div>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 20px;">
                                <button class="add-artikel-btn" onclick="addNewArtikel()">
                                    ‚ûï Neuer Artikel hinzuf√ºgen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Artikel Detail View mit Sub-Tabs (initially hidden) -->
                        <div class="artikel-detail-view" id="artikel-detail-view" style="display: none;">
                            
                            <!-- Detail Header mit Zur√ºck-Button -->
                            <div class="detail-header">
                                <div class="detail-title">
                                    <span id="current-artikel-name">Artikel bearbeiten</span>
                                </div>
                                <button class="back-btn" onclick="backToArtikelOverview()">
                                    ‚Üê Zur√ºck zur Artikel-√úbersicht
                                </button>
                            </div>
                            
                            <!-- Sub-Tab Navigation -->
                            <div class="sub-tab-navigation">
                                <button class="sub-tab-btn active" onclick="switchSubTab('artikel')">
                                    üì¶ Artikel
                                </button>
                                <button class="sub-tab-btn" onclick="switchSubTab('projekte')">
                                    üèóÔ∏è Projekte
                                </button>
                                <button class="sub-tab-btn" onclick="switchSubTab('wirtschaftlichkeit')">
                                    üí∞ Wirtschaftlichkeit
                                </button>
                            </div>
                            
                            <!-- Sub-Tab Content: Artikel -->
                            <div class="sub-tab-content active" id="subtab-artikel">
                                <div class="editor-form">
                                    <!-- Basis-Informationen -->
                                    <div class="form-section-inline">
                                        <div class="section-title-inline">üìã Basis-Informationen</div>
                                        
                                        <div class="form-grid-inline">
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Artikel-Bezeichnung</label>
                                                <input type="text" class="form-input-inline" id="edit-artikel-name" 
                                                       onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Effekt-Typ</label>
                                                <select class="form-select-inline" id="edit-artikel-effekt" onchange="updateArtikelData()">
                                                    <option value="neu">Neu-Produkt</option>
                                                    <option value="cross">Cross-Selling</option>
                                                    <option value="kannibalisierung">Kannibalisierung</option>
                                                </select>
                                            </div>
                                            
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Release-Datum</label>
                                                <input type="month" class="form-input-inline" id="edit-release-datum" 
                                                       onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Umsatzerhaltung</label>
                                                <select class="form-select-inline" id="edit-umsatz-erhaltung" onchange="updateArtikelData()">
                                                    <option value="ja">Ja</option>
                                                    <option value="nein">Nein</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group-inline" style="margin-top: 20px;">
                                            <label class="form-label-inline">Annahmen & Basis f√ºr Absch√§tzung</label>
                                            <textarea class="form-textarea-inline" id="edit-artikel-annahmen" 
                                                      onchange="updateArtikelData()" rows="3"></textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- Finanz-Parameter -->
                                    <div class="form-section-inline">
                                        <div class="section-title-inline">üí∞ Finanz-Parameter</div>
                                        
                                        <div class="form-grid-inline-3">
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Peak Menge (St√ºck)</label>
                                                <input type="number" class="form-input-inline" id="edit-peak-menge" 
                                                       onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Start-Preis (‚Ç¨/St√ºck)</label>
                                                <input type="number" class="form-input-inline" id="edit-artikel-preis" 
                                                       step="0.01" onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">HK pro St√ºck (‚Ç¨)</label>
                                                <input type="number" class="form-input-inline" id="edit-artikel-hk" 
                                                       step="0.01" onchange="updateArtikelData()">
                                            </div>
                                        </div>
                                        
                                        <div class="form-grid-inline-3" style="margin-top: 16px;">
                                            <div class="form-group-inline">
                                                <label class="form-label-inline">Preis-Strategie</label>
                                                <select class="form-select-inline" id="edit-price-strategy" onchange="updateArtikelData()">
                                                    <option value="inflation">Inflation (+3% p.a.)</option>
                                                    <option value="conservative">Konservativ (+2% p.a.)</option>
                                                    <option value="aggressive">Aggressiv (+5% p.a.)</option>
                                                    <option value="value-based">Value-based (+4% p.a.)</option>
                                                    <option value="fixed">Fixpreis (0%)</option>
                                                    <option value="custom">Custom</option>
                                                </select>
                                            </div>
                                            
                                            <div class="calc-display">
                                                <div class="calc-value" id="edit-db2-percent">40%</div>
                                                <div class="calc-label">DB2 Marge</div>
                                            </div>
                                            
                                            <div class="calc-display">
                                                <div class="calc-value" id="edit-total-revenue">87M‚Ç¨</div>
                                                <div class="calc-label">Total Revenue</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Jahres-Entwicklung -->
                                    <div class="form-section-inline">
                                        <div class="section-title-inline">üìà Jahres-Entwicklung</div>
                                        
                                        <div class="years-grid-inline">
                                            <div class="year-column-inline">
                                                <div class="year-header-inline">2025</div>
                                                <input type="number" class="year-input-inline" id="edit-year-2025-volume" 
                                                       placeholder="Menge" onchange="updateArtikelData()">
                                                <input type="number" class="year-input-inline" id="edit-year-2025-price" 
                                                       placeholder="Preis" step="0.01" onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="year-column-inline">
                                                <div class="year-header-inline">2026</div>
                                                <input type="number" class="year-input-inline" id="edit-year-2026-volume" 
                                                       placeholder="Menge" onchange="updateArtikelData()">
                                                <input type="number" class="year-input-inline" id="edit-year-2026-price" 
                                                       placeholder="Preis" step="0.01" onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="year-column-inline">
                                                <div class="year-header-inline">2027</div>
                                                <input type="number" class="year-input-inline" id="edit-year-2027-volume" 
                                                       placeholder="Menge" onchange="updateArtikelData()">
                                                <input type="number" class="year-input-inline" id="edit-year-2027-price" 
                                                       placeholder="Preis" step="0.01" onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="year-column-inline">
                                                <div class="year-header-inline">2028</div>
                                                <input type="number" class="year-input-inline" id="edit-year-2028-volume" 
                                                       placeholder="Menge" onchange="updateArtikelData()">
                                                <input type="number" class="year-input-inline" id="edit-year-2028-price" 
                                                       placeholder="Preis" step="0.01" onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="year-column-inline">
                                                <div class="year-header-inline">2029</div>
                                                <input type="number" class="year-input-inline" id="edit-year-2029-volume" 
                                                       placeholder="Menge" onchange="updateArtikelData()">
                                                <input type="number" class="year-input-inline" id="edit-year-2029-price" 
                                                       placeholder="Preis" step="0.01" onchange="updateArtikelData()">
                                            </div>
                                            
                                            <div class="year-column-inline">
                                                <div class="year-header-inline">2030</div>
                                                <input type="number" class="year-input-inline" id="edit-year-2030-volume" 
                                                       placeholder="Menge" onchange="updateArtikelData()">
                                                <input type="number" class="year-input-inline" id="edit-year-2030-price" 
                                                       placeholder="Preis" step="0.01" onchange="updateArtikelData()">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sub-Tab Content: Projekte -->
                            <div class="sub-tab-content" id="subtab-projekte">
                                <div class="editor-form">
                                    <div class="form-section-inline">
                                        <div class="section-title-inline">üèóÔ∏è Projekt-Kosten Planung</div>
                                        <p style="color: #6b7280; margin-bottom: 20px;">
                                            Kosten-Eingabe nach Kategorien und Jahren. Eingaben werden automatisch summiert.
                                        </p>
                                        
                                        <!-- Projekt-Header Info -->
                                        <div style="background: var(--gray-light); padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                                <div>
                                                    <div style="font-size: 12px; color: var(--gray); margin-bottom: 4px;">PROJEKT-NR.</div>
                                                    <div style="font-weight: 600;" id="projekt-nr">WCAR_V_BM</div>
                                                </div>
                                                <div>
                                                    <div style="font-size: 12px; color: var(--gray); margin-bottom: 4px;">BEZEICHNUNG</div>
                                                    <div style="font-weight: 600;" id="projekt-bezeichnung">WCAR | Verdrahtung Best Match</div>
                                                </div>
                                                <div>
                                                    <div style="font-size: 12px; color: var(--gray); margin-bottom: 4px;">STATUS</div>
                                                    <div style="background: var(--success); color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; display: inline-block;">Dez 24 ‚Üí Laufend</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Kosten-Tabelle -->
                                        <div class="projekt-kosten-table">
                                            
                                            <!-- Table Header -->
                                            <div class="kosten-header">
                                                <div class="kosten-header-cell category-header">Kategorie</div>
                                                <div class="kosten-header-cell year-header">2024</div>
                                                <div class="kosten-header-cell year-header">2025</div>
                                                <div class="kosten-header-cell year-header">2026</div>
                                                <div class="kosten-header-cell year-header">2027</div>
                                                <div class="kosten-header-cell year-header">2028</div>
                                                <div class="kosten-header-cell year-header">2029</div>
                                                <div class="kosten-header-cell year-header">2030</div>
                                                <div class="kosten-header-cell total-header">Gesamt</div>
                                            </div>
                                            
                                            <!-- Personal Row -->
                                            <div class="kosten-row">
                                                <div class="kosten-cell category-cell">Personal</div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2024" 
                                                           placeholder="0" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2025" 
                                                           placeholder="981" value="981" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2026" 
                                                           placeholder="1485" value="1485" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2027" 
                                                           placeholder="1727" value="1727" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2028" 
                                                           placeholder="1881" value="1881" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2029" 
                                                           placeholder="2040" value="2040" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="personal-2030" 
                                                           placeholder="2203" value="2203" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell total-cell" id="personal-total">10.317 T‚Ç¨</div>
                                            </div>
                                            
                                            <!-- Material Row -->
                                            <div class="kosten-row">
                                                <div class="kosten-cell category-cell">Material</div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2024" 
                                                           placeholder="0" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2025" 
                                                           placeholder="83" value="83" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2026" 
                                                           placeholder="105" value="105" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2027" 
                                                           placeholder="128" value="128" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2028" 
                                                           placeholder="142" value="142" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2029" 
                                                           placeholder="156" value="156" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="material-2030" 
                                                           placeholder="171" value="171" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell total-cell" id="material-total">785 T‚Ç¨</div>
                                            </div>
                                            
                                            <!-- CAPEX Row -->
                                            <div class="kosten-row capex-row">
                                                <div class="kosten-cell category-cell">CAPEX (Initialaufwand lt. Planung)</div>
                                                <div class="kosten-cell input-cell capex-cell">
                                                    <input type="number" class="kosten-input capex-input" id="capex-2024" 
                                                           placeholder="1250" value="1250" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="capex-2025" 
                                                           placeholder="1000" value="1000" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="capex-2026" 
                                                           placeholder="1250" value="1250" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="capex-2027" 
                                                           placeholder="800" value="800" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="capex-2028" 
                                                           placeholder="800" value="800" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="capex-2029" 
                                                           placeholder="800" value="800" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="capex-2030" 
                                                           placeholder="800" value="800" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell total-cell capex-total" id="capex-total">6.700 T‚Ç¨</div>
                                            </div>
                                            
                                            <!-- Digital Shopfloor Backend Row -->
                                            <div class="kosten-row">
                                                <div class="kosten-cell category-cell">Digital Shopfloor Backend 40% (Aufteilung mit Best√ºckung)</div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2024" 
                                                           placeholder="320" value="320" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2025" 
                                                           placeholder="480" value="480" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2026" 
                                                           placeholder="360" value="360" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2027" 
                                                           placeholder="240" value="240" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2028" 
                                                           placeholder="120" value="120" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2029" 
                                                           placeholder="120" value="120" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell input-cell">
                                                    <input type="number" class="kosten-input" id="digital-2030" 
                                                           placeholder="120" value="120" onchange="updateProjektKosten()">
                                                </div>
                                                <div class="kosten-cell total-cell" id="digital-total">1.760 T‚Ç¨</div>
                                            </div>
                                            
                                            <!-- Gesamt Row -->
                                            <div class="kosten-row gesamt-row">
                                                <div class="kosten-cell category-cell total-label">Gesamt</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2024">1.570 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2025">2.544 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2026">3.200 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2027">2.895 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2028">2.943 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2029">3.116 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell" id="gesamt-2030">3.294 T‚Ç¨</div>
                                                <div class="kosten-cell total-cell grand-total" id="projekt-grand-total">19.562 T‚Ç¨</div>
                                            </div>
                                        </div>
                                        
                                        <!-- Zus√§tzliche Kostenzeilen hinzuf√ºgen -->
                                        <div style="text-align: center; margin-top: 16px;">
                                            <button class="add-kategorie-btn" onclick="addKostenKategorie()">
                                                ‚ûï Neue Kosten-Kategorie hinzuf√ºgen
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sub-Tab Content: Wirtschaftlichkeit -->
                            <div class="sub-tab-content" id="subtab-wirtschaftlichkeit">
                                <div class="editor-form">
                                    <div class="form-section-inline">
                                        <div class="section-title-inline">üí∞ Wirtschaftlichkeitsberechnung & Amortisation</div>
                                        <p style="color: #6b7280; margin-bottom: 20px;">
                                            Automatische Berechnung basierend auf Artikel-Revenue und Projekt-Kosten. DB3-Analyse mit Payback-Berechnung.
                                        </p>
                                        
                                        <!-- DB-Rechnung Tabelle -->
                                        <div class="wirtschaftlichkeit-table">
                                            
                                            <!-- Table Header -->
                                            <div class="db-header">
                                                <div class="db-header-cell metric-header">Kennzahl</div>
                                                <div class="db-header-cell year-header">2024</div>
                                                <div class="db-header-cell year-header">2025</div>
                                                <div class="db-header-cell year-header">2026</div>
                                                <div class="db-header-cell year-header">2027</div>
                                                <div class="db-header-cell year-header">2028</div>
                                                <div class="db-header-cell year-header">2029</div>
                                                <div class="db-header-cell year-header">2030</div>
                                                <div class="db-header-cell total-header">Gesamt</div>
                                            </div>
                                            
                                            <!-- Umsatz Row -->
                                            <div class="db-row umsatz-row">
                                                <div class="db-cell metric-cell">üìà Umsatz (in T‚Ç¨)</div>
                                                <div class="db-cell value-cell" id="umsatz-2024">0</div>
                                                <div class="db-cell value-cell" id="umsatz-2025">2.900</div>
                                                <div class="db-cell value-cell" id="umsatz-2026">10.800</div>
                                                <div class="db-cell value-cell" id="umsatz-2027">24.200</div>
                                                <div class="db-cell value-cell" id="umsatz-2028">42.300</div>
                                                <div class="db-cell value-cell" id="umsatz-2029">47.000</div>
                                                <div class="db-cell value-cell" id="umsatz-2030">48.800</div>
                                                <div class="db-cell total-cell" id="umsatz-total">176.000</div>
                                            </div>
                                            
                                            <!-- Herstellkosten Row -->
                                            <div class="db-row">
                                                <div class="db-cell metric-cell">‚öôÔ∏è Herstellkosten (HK)</div>
                                                <div class="db-cell value-cell" id="hk-2024">0</div>
                                                <div class="db-cell value-cell" id="hk-2025">-1.900</div>
                                                <div class="db-cell value-cell" id="hk-2026">-7.200</div>
                                                <div class="db-cell value-cell" id="hk-2027">-15.800</div>
                                                <div class="db-cell value-cell" id="hk-2028">-27.500</div>
                                                <div class="db-cell value-cell" id="hk-2029">-30.600</div>
                                                <div class="db-cell value-cell" id="hk-2030">-31.800</div>
                                                <div class="db-cell total-cell negative" id="hk-total">-114.800</div>
                                            </div>
                                            
                                            <!-- DB1 Row -->
                                            <div class="db-row db1-row">
                                                <div class="db-cell metric-cell bold">= DB1 (Deckungsbeitrag 1)</div>
                                                <div class="db-cell value-cell" id="db1-2024">0</div>
                                                <div class="db-cell value-cell" id="db1-2025">1.000</div>
                                                <div class="db-cell value-cell" id="db1-2026">3.600</div>
                                                <div class="db-cell value-cell" id="db1-2027">8.400</div>
                                                <div class="db-cell value-cell" id="db1-2028">14.800</div>
                                                <div class="db-cell value-cell" id="db1-2029">16.400</div>
                                                <div class="db-cell value-cell" id="db1-2030">17.000</div>
                                                <div class="db-cell total-cell positive" id="db1-total">61.200</div>
                                            </div>
                                            
                                            <!-- Variable Kosten Row -->
                                            <div class="db-row">
                                                <div class="db-cell metric-cell">üì¶ Variable Kosten (Vertrieb, etc.)</div>
                                                <div class="db-cell value-cell" id="var-2024">0</div>
                                                <div class="db-cell value-cell" id="var-2025">-145</div>
                                                <div class="db-cell value-cell" id="var-2026">-540</div>
                                                <div class="db-cell value-cell" id="var-2027">-1.210</div>
                                                <div class="db-cell value-cell" id="var-2028">-2.115</div>
                                                <div class="db-cell value-cell" id="var-2029">-2.350</div>
                                                <div class="db-cell value-cell" id="var-2030">-2.440</div>
                                                <div class="db-cell total-cell negative" id="var-total">-8.800</div>
                                            </div>
                                            
                                            <!-- DB2 Row -->
                                            <div class="db-row db2-row">
                                                <div class="db-cell metric-cell bold">= DB2 (nach variablen Kosten)</div>
                                                <div class="db-cell value-cell" id="db2-2024">0</div>
                                                <div class="db-cell value-cell" id="db2-2025">855</div>
                                                <div class="db-cell value-cell" id="db2-2026">3.060</div>
                                                <div class="db-cell value-cell" id="db2-2027">7.190</div>
                                                <div class="db-cell value-cell" id="db2-2028">12.685</div>
                                                <div class="db-cell value-cell" id="db2-2029">14.050</div>
                                                <div class="db-cell value-cell" id="db2-2030">14.560</div>
                                                <div class="db-cell total-cell positive" id="db2-total">52.400</div>
                                            </div>
                                            
                                            <!-- Projektkosten Row -->
                                            <div class="db-row projekt-row">
                                                <div class="db-cell metric-cell">üèóÔ∏è Projektkosten (Personal, CAPEX, etc.)</div>
                                                <div class="db-cell value-cell negative" id="projekt-2024">-1.570</div>
                                                <div class="db-cell value-cell negative" id="projekt-2025">-2.544</div>
                                                <div class="db-cell value-cell negative" id="projekt-2026">-3.200</div>
                                                <div class="db-cell value-cell negative" id="projekt-2027">-2.895</div>
                                                <div class="db-cell value-cell negative" id="projekt-2028">-2.943</div>
                                                <div class="db-cell value-cell negative" id="projekt-2029">-3.116</div>
                                                <div class="db-cell value-cell negative" id="projekt-2030">-3.294</div>
                                                <div class="db-cell total-cell negative" id="projekt-total">-19.562</div>
                                            </div>
                                            
                                            <!-- DB3 Row -->
                                            <div class="db-row db3-row">
                                                <div class="db-cell metric-cell bold final">= DB3 (nach Projektkosten)</div>
                                                <div class="db-cell value-cell final" id="db3-2024">-1.570</div>
                                                <div class="db-cell value-cell final" id="db3-2025">-1.689</div>
                                                <div class="db-cell value-cell final" id="db3-2026">-140</div>
                                                <div class="db-cell value-cell final positive" id="db3-2027">4.295</div>
                                                <div class="db-cell value-cell final positive" id="db3-2028">9.742</div>
                                                <div class="db-cell value-cell final positive" id="db3-2029">10.934</div>
                                                <div class="db-cell value-cell final positive" id="db3-2030">11.266</div>
                                                <div class="db-cell total-cell final positive" id="db3-total">32.838</div>
                                            </div>
                                            
                                            <!-- DB3 Margin Row -->
                                            <div class="db-row margin-row">
                                                <div class="db-cell metric-cell">üìä DB3-Marge (%)</div>
                                                <div class="db-cell value-cell" id="margin-2024">-</div>
                                                <div class="db-cell value-cell negative" id="margin-2025">-58%</div>
                                                <div class="db-cell value-cell negative" id="margin-2026">-1%</div>
                                                <div class="db-cell value-cell positive" id="margin-2027">18%</div>
                                                <div class="db-cell value-cell positive" id="margin-2028">23%</div>
                                                <div class="db-cell value-cell positive" id="margin-2029">23%</div>
                                                <div class="db-cell value-cell positive" id="margin-2030">23%</div>
                                                <div class="db-cell total-cell positive" id="margin-total">19%</div>
                                            </div>
                                        </div>
                                        
                                        <!-- Amortisations-Analyse -->
                                        <div style="margin-top: 32px;">
                                            <div class="section-title-inline">‚è±Ô∏è Amortisations-Analyse</div>
                                            
                                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-top: 16px;">
                                                
                                                <!-- Kumulierte Cashflows -->
                                                <div class="amortisation-panel">
                                                    <div class="amortisation-title">üìà Kumulierte DB3-Entwicklung</div>
                                                    <div class="cashflow-table">
                                                        <div class="cashflow-row header">
                                                            <div class="cashflow-cell">Jahr</div>
                                                            <div class="cashflow-cell">DB3 Jahr</div>
                                                            <div class="cashflow-cell">DB3 kumuliert</div>
                                                        </div>
                                                        <div class="cashflow-row">
                                                            <div class="cashflow-cell">2024</div>
                                                            <div class="cashflow-cell negative">-1.570 T‚Ç¨</div>
                                                            <div class="cashflow-cell negative">-1.570 T‚Ç¨</div>
                                                        </div>
                                                        <div class="cashflow-row">
                                                            <div class="cashflow-cell">2025</div>
                                                            <div class="cashflow-cell negative">-1.689 T‚Ç¨</div>
                                                            <div class="cashflow-cell negative">-3.259 T‚Ç¨</div>
                                                        </div>
                                                        <div class="cashflow-row">
                                                            <div class="cashflow-cell">2026</div>
                                                            <div class="cashflow-cell negative">-140 T‚Ç¨</div>
                                                            <div class="cashflow-cell negative">-3.399 T‚Ç¨</div>
                                                        </div>
                                                        <div class="cashflow-row breakeven">
                                                            <div class="cashflow-cell">2027</div>
                                                            <div class="cashflow-cell positive">+4.295 T‚Ç¨</div>
                                                            <div class="cashflow-cell positive">+896 T‚Ç¨</div>
                                                        </div>
                                                        <div class="cashflow-row">
                                                            <div class="cashflow-cell">2028</div>
                                                            <div class="cashflow-cell positive">+9.742 T‚Ç¨</div>
                                                            <div class="cashflow-cell positive">+10.638 T‚Ç¨</div>
                                                        </div>
                                                        <div class="cashflow-row">
                                                            <div class="cashflow-cell">2029</div>
                                                            <div class="cashflow-cell positive">+10.934 T‚Ç¨</div>
                                                            <div class="cashflow-cell positive">+21.572 T‚Ç¨</div>
                                                        </div>
                                                        <div class="cashflow-row">
                                                            <div class="cashflow-cell">2030</div>
                                                            <div class="cashflow-cell positive">+11.266 T‚Ç¨</div>
                                                            <div class="cashflow-cell positive">+32.838 T‚Ç¨</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Payback KPIs -->
                                                <div class="amortisation-panel">
                                                    <div class="amortisation-title">üéØ Payback-Kennzahlen</div>
                                                    <div class="kpi-grid">
                                                        <div class="kpi-item success">
                                                            <div class="kpi-value">3,2 Jahre</div>
                                                            <div class="kpi-label">Payback-Zeit</div>
                                                            <div class="kpi-detail">Break-Even in Q2/2027</div>
                                                        </div>
                                                        
                                                        <div class="kpi-item">
                                                            <div class="kpi-value">32,8M‚Ç¨</div>
                                                            <div class="kpi-label">NPV (7 Jahre)</div>
                                                            <div class="kpi-detail">ohne Diskontierung</div>
                                                        </div>
                                                        
                                                        <div class="kpi-item">
                                                            <div class="kpi-value">168%</div>
                                                            <div class="kpi-label">ROI</div>
                                                            <div class="kpi-detail">32,8M‚Ç¨ / 19,6M‚Ç¨ Investment</div>
                                                        </div>
                                                        
                                                        <div class="kpi-item warning">
                                                            <div class="kpi-value">3,4M‚Ç¨</div>
                                                            <div class="kpi-label">Max. Negativer CF</div>
                                                            <div class="kpi-detail">Peak-Investment 2026</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <!-- Bewertung -->
                                                    <div class="bewertung-box">
                                                        <div class="bewertung-status success">‚úÖ BUSINESS CASE POSITIV</div>
                                                        <div class="bewertung-text">
                                                            <strong>Empfehlung:</strong> Freigabe empfohlen.<br>
                                                            <strong>Kritisch:</strong> 3,4M‚Ç¨ Vorfinanzierung bis Break-Even.<br>
                                                            <strong>Risiko:</strong> Marktpenetration muss planm√§√üig erfolgen.
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="editor-actions-inline">
                                <button class="btn-secondary-inline" onclick="backToArtikelOverview()">
                                    Abbrechen
                                </button>
                                <button class="btn-primary-inline" onclick="saveArtikelChanges()">
                                    üíæ Alle √Ñnderungen speichern
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Analyse -->
                <div class="tab-content" id="tab-analysis">
                    <div class="analysis-container">
                        <div class="section-title">üìà Detaillierte Business Case Analyse</div>
                        <p style="padding: 40px; text-align: center; color: #6b7280;">
                            Erweiterte Analyse-Features werden hier implementiert:<br>
                            ‚Ä¢ Sensitivit√§tsanalyse<br>
                            ‚Ä¢ Monte-Carlo-Simulation<br>
                            ‚Ä¢ Benchmark-Vergleiche<br>
                            ‚Ä¢ Risk Assessment
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="ai-feed" id="ai-feed">
                    <div class="ai-feed-title">ü§ñ KI-Assistent</div>
                    
                    <div class="ai-message">
                        <div class="message-title">System-Start</div>
                        <div class="message-text">Dashboard initialisiert. <strong>Business Case WCAR:</strong> 3 Artikel, 18,8M‚Ç¨ Investition, 3,4J Payback.</div>
                        <div class="message-timestamp">vor wenigen Sekunden</div>
                    </div>
                </div>
                
                <div class="ai-actions">
                    <button class="ai-action-btn" onclick="aiAction('stress-test')">üîç Stress-Test Worst-Case</button>
                    <button class="ai-action-btn" onclick="aiAction('sensitivity')">üìä Sensitivit√§ts-Analyse</button>
                    <button class="ai-action-btn" onclick="aiAction('benchmark')">‚öñÔ∏è Industrie-Benchmark</button>
                    <button class="ai-action-btn" onclick="aiAction('export')">üìÑ Board-Export generieren</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global dashboard data
        let cfoDashboard = {
            currentArtikel: null,
            aiController: {
                addAIMessage: function(container, message) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `ai-message ${message.type}`;
                    messageDiv.innerHTML = `
                        <div class="message-title">${message.title}</div>
                        <div class="message-text">${message.text}</div>
                        <div class="message-timestamp">${message.timestamp}</div>
                    `;
                    container.appendChild(messageDiv);
                    container.scrollTop = container.scrollHeight;
                }
            }
        };

        // Tab switching functionality
        function switchTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activate selected tab
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Add KI message about tab switch
            const feedContainer = document.getElementById('ai-feed');
            let message = null;
            
            switch(tabName) {
                case 'dashboard':
                    message = {
                        type: '',
                        title: 'Dashboard-Ansicht',
                        text: '<strong>Executive View aktiviert:</strong> Live-Charts und KPIs f√ºr schnelle Business Case Bewertung im Fokus.',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'assumptions':
                    message = {
                        type: 'success',
                        title: 'Annahmen-Modus',
                        text: '<strong>Artikel-Portfolio bereit:</strong> Hierarchische Bearbeitung verf√ºgbar. Artikel ausw√§hlen f√ºr Detail-Editing.',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'analysis':
                    message = {
                        type: '',
                        title: 'Analyse-Modus',
                        text: '<strong>Deep-Analytics bereit:</strong> Erweiterte Analyse-Tools f√ºr Sensitivit√§t, Risiko-Assessment und Benchmark-Vergleiche.',
                        timestamp: 'jetzt'
                    };
                    break;
            }
            
            if (message) {
                cfoDashboard.aiController.addAIMessage(feedContainer, message);
            }
        }

        // Sub-Tab switching functionality
        function switchSubTab(subTabName) {
            // Remove active class from all sub-tabs and content
            document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.sub-tab-content').forEach(content => content.classList.remove('active'));
            
            // Activate selected sub-tab
            document.querySelector(`[onclick="switchSubTab('${subTabName}')"]`).classList.add('active');
            document.getElementById(`subtab-${subTabName}`).classList.add('active');
            
            // Load content based on sub-tab
            if (subTabName === 'projekte') {
                loadArtikelProjekte();
            }
            // Wirtschaftlichkeit ist jetzt statisch - keine loadWirtschaftlichkeit() mehr
            
            // Add KI message about sub-tab switch
            const feedContainer = document.getElementById('ai-feed');
            let message = null;
            
            switch(subTabName) {
                case 'artikel':
                    message = {
                        type: '',
                        title: 'Artikel-Details',
                        text: '<strong>Produkt-Parameter aktiviert:</strong> Preise, Mengen, Margen und Jahres-Entwicklung direkt editierbar.',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'projekte':
                    message = {
                        type: 'success',
                        title: 'Projekt-Zuordnung',
                        text: '<strong>CAPEX/OPEX-Sicht aktiviert:</strong> Zugeordnete Projekte und Investitions-Kosten √ºber Jahre bearbeitbar.',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'wirtschaftlichkeit':
                    message = {
                        type: '',
                        title: 'Wirtschaftlichkeits-Analyse',
                        text: '<strong>Business Case View:</strong> NPV, Payback, DB3-Entwicklung und Break-Even-Analyse f√ºr diesen Artikel.',
                        timestamp: 'jetzt'
                    };
                    break;
            }
            
            if (message) {
                cfoDashboard.aiController.addAIMessage(feedContainer, message);
            }
        }

        // Artikel detail navigation
        function openArtikelDetail(artikelId) {
            console.log('Opening detail for artikel:', artikelId);
            
            cfoDashboard.currentArtikel = artikelId;
            
            // Hide overview and show detail view
            document.getElementById('artikel-overview').style.display = 'none';
            document.getElementById('artikel-detail-view').style.display = 'block';
            
            // Load artikel data
            loadArtikelIntoEditor(artikelId);
            
            // Add KI message
            const feedContainer = document.getElementById('ai-feed');
            const artikelNames = {
                'crimp': 'Crimpautomat',
                'komax': 'Mini-Komax ohne CORE',
                'digital': 'Digital Shopfloor Backend'
            };
            
            const message = {
                type: 'success',
                title: 'Artikel-Detail ge√∂ffnet',
                text: `<strong>${artikelNames[artikelId]} Detailbearbeitung:</strong> 3 Bereiche verf√ºgbar - Artikel, Projekte, Wirtschaftlichkeit. Hierarchische Annahmen-Pflege aktiviert.`,
                timestamp: 'jetzt'
            };
            
            cfoDashboard.aiController.addAIMessage(feedContainer, message);
        }

        function backToArtikelOverview() {
            // Show overview and hide detail view
            document.getElementById('artikel-overview').style.display = 'block';
            document.getElementById('artikel-detail-view').style.display = 'none';
            
            // Reset to first sub-tab
            document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.sub-tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`[onclick="switchSubTab('artikel')"]`).classList.add('active');
            document.getElementById('subtab-artikel').classList.add('active');
            
            // Add KI message
            const feedContainer = document.getElementById('ai-feed');
            const message = {
                type: '',
                title: 'Zur√ºck zur √úbersicht',
                text: '<strong>Portfolio-Ansicht:</strong> Alle Artikel-√Ñnderungen gespeichert. Zur√ºck zur Haupt√ºbersicht.',
                timestamp: 'jetzt'
            };
            
            cfoDashboard.aiController.addAIMessage(feedContainer, message);
        }

        function loadArtikelIntoEditor(artikelId) {
            // Sample data for different articles
            const artikelData = {
                'crimp': {
                    name: 'Crimpautomat',
                    effekt: 'neu',
                    release: '2024-12',
                    umsatzErhaltung: 'nein',
                    annahmen: 'Innovation durch neue Linie',
                    peakMenge: 5000,
                    startPreis: 5.00,
                    hk: 3.00,
                    priceStrategy: 'inflation',
                    years: {
                        2025: { volume: 200, price: 5.00 },
                        2026: { volume: 1000, price: 5.15 },
                        2027: { volume: 2500, price: 5.30 },
                        2028: { volume: 5000, price: 5.46 },
                        2029: { volume: 5000, price: 5.62 },
                        2030: { volume: 5000, price: 5.79 }
                    }
                },
                'komax': {
                    name: 'Mini-Komax ohne CORE',
                    effekt: 'neu',
                    release: '2024-12',
                    umsatzErhaltung: 'nein',
                    annahmen: 'Premium-Segment erschlie√üen',
                    peakMenge: 115,
                    startPreis: 1000.00,
                    hk: 670.00,
                    priceStrategy: 'conservative',
                    years: {
                        2025: { volume: 6, price: 1000.00 },
                        2026: { volume: 14, price: 1020.00 },
                        2027: { volume: 27, price: 1040.40 },
                        2028: { volume: 42, price: 1061.21 },
                        2029: { volume: 53, price: 1082.43 },
                        2030: { volume: 53, price: 1104.08 }
                    }
                },
                'digital': {
                    name: 'Digital Shopfloor Backend',
                    effekt: 'cross',
                    release: '2025-06',
                    umsatzErhaltung: 'ja',
                    annahmen: '40% Aufteilung mit Best√ºckung',
                    peakMenge: 250,
                    startPreis: 480.00,
                    hk: 192.00,
                    priceStrategy: 'fixed',
                    years: {
                        2025: { volume: 50, price: 480.00 },
                        2026: { volume: 150, price: 480.00 },
                        2027: { volume: 200, price: 480.00 },
                        2028: { volume: 250, price: 480.00 },
                        2029: { volume: 250, price: 480.00 },
                        2030: { volume: 200, price: 480.00 }
                    }
                }
            };
            
            const data = artikelData[artikelId];
            if (!data) return;
            
            // Update detail title
            document.getElementById('current-artikel-name').textContent = `Artikel bearbeiten: ${data.name}`;
            
            // Load basic data
            document.getElementById('edit-artikel-name').value = data.name;
            document.getElementById('edit-artikel-effekt').value = data.effekt;
            document.getElementById('edit-release-datum').value = data.release;
            document.getElementById('edit-umsatz-erhaltung').value = data.umsatzErhaltung;
            document.getElementById('edit-artikel-annahmen').value = data.annahmen;
            document.getElementById('edit-peak-menge').value = data.peakMenge;
            document.getElementById('edit-artikel-preis').value = data.startPreis;
            document.getElementById('edit-artikel-hk').value = data.hk;
            document.getElementById('edit-price-strategy').value = data.priceStrategy;
            
            // Load years data
            for (let year = 2025; year <= 2030; year++) {
                const volumeInput = document.getElementById(`edit-year-${year}-volume`);
                const priceInput = document.getElementById(`edit-year-${year}-price`);
                
                if (volumeInput && data.years[year]) {
                    volumeInput.value = data.years[year].volume;
                }
                if (priceInput && data.years[year]) {
                    priceInput.value = data.years[year].price.toFixed(2);
                }
            }
            
            // Update calculations
            updateArtikelData();
        }

        function loadArtikelProjekte() {
            const projektContent = document.getElementById('artikel-projekte-content');
            
            if (!cfoDashboard.currentArtikel) return;
            
            // Sample projekt data based on current artikel
            const projektZuordnung = {
                'crimp': {
                    projekt: 'WCAR | Verdrahtung Best Match',
                    anteil: '80%',
                    kosten: '15,0 T‚Ç¨',
                    beschreibung: 'Hauptprojekt f√ºr Crimpautomat-Implementierung'
                },
                'komax': {
                    projekt: 'WCAR | Verdrahtung Best Match',
                    anteil: '20%',
                    kosten: '3,8 T‚Ç¨',
                    beschreibung: 'Anteil Mini-Komax Integration'
                },
                'digital': {
                    projekt: 'Digital Shopfloor Backend',
                    anteil: '100%',
                    kosten: '1,8 T‚Ç¨',
                    beschreibung: 'Dediziertes Digital-Projekt'
                }
            };
            
            const zuordnung = projektZuordnung[cfoDashboard.currentArtikel];
            
            projektContent.innerHTML = `
                <div style="background: var(--gray-light); padding: 20px; border-radius: 8px; border: 1px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div style="font-weight: 600; color: var(--text);">${zuordnung.projekt}</div>
                        <div style="background: var(--primary); color: white; padding: 4px 12px; border-radius: 16px; font-size: 11px;">${zuordnung.anteil}</div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <span style="color: var(--gray); font-size: 12px;">Zugeordnete Kosten:</span>
                        <span style="color: var(--success); font-weight: 600; margin-left: 8px;">${zuordnung.kosten}</span>
                    </div>
                    <div style="color: var(--gray); font-size: 13px; line-height: 1.4;">
                        ${zuordnung.beschreibung}
                    </div>
                    <div style="margin-top: 16px; text-align: center;">
                        <button style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">
                            üèóÔ∏è Projekt-Details bearbeiten
                        </button>
                    </div>
                </div>
            `;
        }

        function loadWirtschaftlichkeit() {
            const wirtschaftlichkeitContent = document.getElementById('wirtschaftlichkeit-content');
            
            if (!cfoDashboard.currentArtikel) return;
            
            // Sample wirtschaftlichkeit data
            const wirtschaftlichkeitData = {
                'crimp': {
                    totalRevenue: '87,2M‚Ç¨',
                    totalKosten: '15,0M‚Ç¨',
                    nettoErtrag: '72,2M‚Ç¨',
                    db3Marge: '83%',
                    payback: '2,8J',
                    npv: '38,4M‚Ç¨'
                },
                'komax': {
                    totalRevenue: '24,8M‚Ç¨',
                    totalKosten: '3,8M‚Ç¨',
                    nettoErtrag: '21,0M‚Ç¨',
                    db3Marge: '85%',
                    payback: '1,9J',
                    npv: '15,8M‚Ç¨'
                },
                'digital': {
                    totalRevenue: '5,8M‚Ç¨',
                    totalKosten: '1,8M‚Ç¨',
                    nettoErtrag: '4,0M‚Ç¨',
                    db3Marge: '69%',
                    payback: '3,2J',
                    npv: '2,1M‚Ç¨'
                }
            };
            
            const data = wirtschaftlichkeitData[cfoDashboard.currentArtikel];
            
            wirtschaftlichkeitContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px;">
                    <div class="calc-display">
                        <div class="calc-value" style="color: var(--success);">${data.totalRevenue}</div>
                        <div class="calc-label">Total Revenue</div>
                    </div>
                    <div class="calc-display">
                        <div class="calc-value" style="color: var(--warning);">${data.totalKosten}</div>
                        <div class="calc-label">Projekt-Kosten</div>
                    </div>
                    <div class="calc-display">
                        <div class="calc-value" style="color: var(--primary);">${data.nettoErtrag}</div>
                        <div class="calc-label">Netto-Ertrag</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <div class="calc-display">
                        <div class="calc-value">${data.db3Marge}</div>
                        <div class="calc-label">DB3-Marge</div>
                    </div>
                    <div class="calc-display">
                        <div class="calc-value">${data.payback}</div>
                        <div class="calc-label">Payback-Zeit</div>
                    </div>
                    <div class="calc-display">
                        <div class="calc-value">${data.npv}</div>
                        <div class="calc-label">NPV (9 Jahre)</div>
                    </div>
                </div>
                
                <div style="margin-top: 24px; padding: 16px; background: var(--gray-light); border-radius: 8px; border-left: 3px solid var(--success);">
                    <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">‚úÖ Bewertung: Positiv</div>
                    <div style="color: var(--gray); font-size: 13px; line-height: 1.4;">
                        Starke Wirtschaftlichkeit mit hoher DB3-Marge und schneller Amortisation. 
                        Artikel tr√§gt signifikant zum Gesamt-Business Case bei.
                    </div>
                </div>
            `;
        }

        function updateArtikelData() {
            // Get current values
            const startPreis = parseFloat(document.getElementById('edit-artikel-preis').value) || 0;
            const hk = parseFloat(document.getElementById('edit-artikel-hk').value) || 0;
            
            // Calculate DB2 margin
            const db2Margin = startPreis > 0 ? ((startPreis - hk) / startPreis * 100) : 0;
            
            // Calculate total revenue over 6 years
            let totalRevenue = 0;
            for (let year = 2025; year <= 2030; year++) {
                const volumeInput = document.getElementById(`edit-year-${year}-volume`);
                const priceInput = document.getElementById(`edit-year-${year}-price`);
                
                if (volumeInput && priceInput) {
                    const yearVolume = parseInt(volumeInput.value) || 0;
                    const yearPrice = parseFloat(priceInput.value) || 0;
                    totalRevenue += yearVolume * yearPrice;
                }
            }
            
            // Update display
            document.getElementById('edit-db2-percent').textContent = db2Margin.toFixed(0) + '%';
            document.getElementById('edit-total-revenue').textContent = formatMoney(totalRevenue);
            
            // Color coding for DB2 margin
            const db2Element = document.getElementById('edit-db2-percent');
            if (db2Margin >= 40) {
                db2Element.style.color = '#059669'; // Success
            } else if (db2Margin >= 25) {
                db2Element.style.color = '#1e40af'; // Primary
            } else {
                db2Element.style.color = '#d97706'; // Warning
            }
        }

        function updateProjektKosten() {
            console.log('Updating projekt kosten...');
            
            // Kategorien definieren
            const kategorien = ['personal', 'material', 'capex', 'digital'];
            const jahre = [2024, 2025, 2026, 2027, 2028, 2029, 2030];
            
            let gesamtKosten = {};
            let kategorieGesamt = {};
            
            // Initialize
            jahre.forEach(jahr => gesamtKosten[jahr] = 0);
            kategorien.forEach(kat => kategorieGesamt[kat] = 0);
            
            // Berechne Summen pro Kategorie und Jahr
            kategorien.forEach(kategorie => {
                jahre.forEach(jahr => {
                    const input = document.getElementById(`${kategorie}-${jahr}`);
                    if (input) {
                        const wert = parseInt(input.value) || 0;
                        kategorieGesamt[kategorie] += wert;
                        gesamtKosten[jahr] += wert;
                    }
                });
                
                // Update Kategorie-Gesamt
                const totalElement = document.getElementById(`${kategorie}-total`);
                if (totalElement) {
                    totalElement.textContent = formatThousands(kategorieGesamt[kategorie]) + ' T‚Ç¨';
                }
            });
            
            // Update Jahres-Gesamt
            jahre.forEach(jahr => {
                const gesamtElement = document.getElementById(`gesamt-${jahr}`);
                if (gesamtElement) {
                    gesamtElement.textContent = formatThousands(gesamtKosten[jahr]) + ' T‚Ç¨';
                }
            });
            
            // Update Grand Total
            const grandTotal = Object.values(kategorieGesamt).reduce((sum, val) => sum + val, 0);
            const grandTotalElement = document.getElementById('projekt-grand-total');
            if (grandTotalElement) {
                grandTotalElement.textContent = formatThousands(grandTotal) + ' T‚Ç¨';
            }
            
            // Add KI message about cost changes
            const feedContainer = document.getElementById('ai-feed');
            const message = {
                type: '',
                title: 'Projekt-Kosten aktualisiert',
                text: `<strong>Kostenberechnung:</strong> Gesamt ${formatThousands(grandTotal)} T‚Ç¨. CAPEX: ${formatThousands(kategorieGesamt.capex)} T‚Ç¨, Personal: ${formatThousands(kategorieGesamt.personal)} T‚Ç¨. Wirtschaftlichkeit wird neu berechnet.`,
                timestamp: 'jetzt'
            };
            
            // Only add if significant change
            const lastMessage = feedContainer.lastElementChild;
            if (!lastMessage || !lastMessage.textContent.includes('Projekt-Kosten aktualisiert')) {
                cfoDashboard.aiController.addAIMessage(feedContainer, message);
            }
        }

        function formatThousands(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function addKostenKategorie() {
            const feedContainer = document.getElementById('ai-feed');
            const message = {
                type: 'success',
                title: 'Neue Kosten-Kategorie',
                text: '<strong>Kategorie hinzuf√ºgen:</strong> Neue Kostenart wird zur Projekt-Tabelle hinzugef√ºgt. Eingaben √ºber alle Jahre m√∂glich.',
                timestamp: 'jetzt'
            };
            
            cfoDashboard.aiController.addAIMessage(feedContainer, message);
            
            // Here you would add a new row to the table
            console.log('Add new cost category');
        }

        function saveArtikelChanges() {
            // Add success message
            const feedContainer = document.getElementById('ai-feed');
            const message = {
                type: 'success',
                title: '√Ñnderungen gespeichert',
                text: '<strong>Artikel erfolgreich aktualisiert:</strong> Alle Annahmen, Projekte und Wirtschaftlichkeits-Parameter gespeichert. Dashboard wird automatisch aktualisiert.',
                timestamp: 'jetzt'
            };
            
            cfoDashboard.aiController.addAIMessage(feedContainer, message);
            
            console.log('All artikel changes saved');
        }

        function addNewArtikel() {
            const feedContainer = document.getElementById('ai-feed');
            const message = {
                type: 'success',
                title: 'Neuer Artikel',
                text: '<strong>Artikel-Creation gestartet:</strong> Neues Produkt wird zum Portfolio hinzugef√ºgt. Business Case wird automatisch um neue Revenue-Streams erweitert.',
                timestamp: 'jetzt'
            };
            
            cfoDashboard.aiController.addAIMessage(feedContainer, message);
            
            console.log('Add new artikel');
        }

        function formatMoney(amount) {
            if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + 'M‚Ç¨';
            } else if (amount >= 1000) {
                return (amount / 1000).toFixed(1) + 'k‚Ç¨';
            }
            return amount.toFixed(0) + '‚Ç¨';
        }

        // Dashboard control functions
        function adjustAssumption(type, value) {
            const feedContainer = document.getElementById('ai-feed');
            let message = null;
            
            switch(type) {
                case 'market':
                    document.getElementById('market-value').textContent = value + '%';
                    message = {
                        type: value > 110 ? 'success' : (value < 90 ? 'warning' : ''),
                        title: 'Marktvolumen angepasst',
                        text: `<strong>Markt-Szenario ${value}%:</strong> ${value > 110 ? 'Optimistisches' : value < 90 ? 'Pessimistisches' : 'Realistisches'} Marktumfeld. Charts werden automatisch aktualisiert.`,
                        timestamp: 'jetzt'
                    };
                    break;
                case 'price':
                    const priceDiff = value - 100;
                    document.getElementById('price-value').textContent = (priceDiff >= 0 ? '+' : '') + priceDiff + '%';
                    message = {
                        type: priceDiff > 5 ? 'success' : (priceDiff < -5 ? 'warning' : ''),
                        title: 'Preis-Premium ge√§ndert',
                        text: `<strong>Preis-Strategie ${priceDiff >= 0 ? '+' : ''}${priceDiff}%:</strong> Auswirkung auf DB2-Marge und Wettbewerbsf√§higkeit wird neu berechnet.`,
                        timestamp: 'jetzt'
                    };
                    break;
                case 'capex':
                    const capexText = value > 110 ? '√úberschreitung' : value < 90 ? 'Einsparung' : 'Plan';
                    document.getElementById('capex-value').textContent = capexText;
                    message = {
                        type: value > 110 ? 'warning' : (value < 90 ? 'success' : ''),
                        title: 'CAPEX-Szenario',
                        text: `<strong>CAPEX ${capexText}:</strong> Investitionsrisiko ${value > 110 ? 'erh√∂ht' : value < 90 ? 'reduziert' : 'nominal'}. Payback-Zeit wird angepasst.`,
                        timestamp: 'jetzt'
                    };
                    break;
            }
            
            if (message) {
                cfoDashboard.aiController.addAIMessage(feedContainer, message);
            }
        }

        function toggleArtikel(type) {
            // Remove active from all buttons
            document.querySelectorAll('.artikel-btn').forEach(btn => btn.classList.remove('active'));
            // Add active to clicked button
            event.target.classList.add('active');
            
            const feedContainer = document.getElementById('ai-feed');
            const message = {
                type: '',
                title: 'Artikel-Filter',
                text: `<strong>Fokus auf ${type === 'all' ? 'alle Artikel' : type.charAt(0).toUpperCase() + type.slice(1)}:</strong> Charts zeigen ${type === 'all' ? 'Portfolio-Gesamtsicht' : 'artikel-spezifische Daten'}.`,
                timestamp: 'jetzt'
            };
            
            cfoDashboard.aiController.addAIMessage(feedContainer, message);
        }

        function aiAction(action) {
            console.log('AI Action triggered:', action);
            
            const feedContainer = document.getElementById('ai-feed');
            let message = null;
            
            switch(action) {
                case 'stress-test':
                    message = {
                        type: 'warning',
                        title: 'Stress-Test Results',
                        text: '<strong>Worst-Case-Szenario:</strong> -30% Markt, +25% CAPEX ‚Üí NPV: +2.1M‚Ç¨, Payback: 6.2J. Projekt bleibt positiv aber kritisch.',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'sensitivity':
                    message = {
                        type: '',
                        title: 'Sensitivit√§ts-Ranking',
                        text: '<strong>Wichtigste Hebel:</strong> 1) Absatzvolumen (¬±15M‚Ç¨ NPV), 2) Preis-Premium (¬±12M‚Ç¨), 3) CAPEX-Kontrolle (¬±4M‚Ç¨).',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'benchmark':
                    message = {
                        type: 'success',
                        title: 'Benchmark-Vergleich',
                        text: '<strong>vs. Industrie:</strong> DB2-Marge 37% vs. 32% Branche = +5pp Vorteil. Payback 3.4J vs. 4.1J Industrie = √ºberdurchschnittlich.',
                        timestamp: 'jetzt'
                    };
                    break;
                case 'export':
                    message = {
                        type: '',
                        title: 'Board-Export generiert',
                        text: '<strong>Executive Summary erstellt:</strong> 2-Seiten Board-Vorlage mit KPIs, Risiken und Freigabe-Empfehlung ready f√ºr Management-Pr√§sentation.',
                        timestamp: 'jetzt'
                    };
                    break;
            }
            
            if (message) {
                cfoDashboard.aiController.addAIMessage(feedContainer, message);
            }
        }

        // Initialize charts on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
        });

        function initializeCharts() {
            // Initialize all 6 charts matching Excel layout
            initUmsatzChart();
            initAbsatzChart();
            initDB2Chart();
            initProjektkostenChart();
            initDB3JahrChart();
            initDB3KumuliertChart();
        }

        function initUmsatzChart() {
            const ctx = document.getElementById('umsatz-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'],
                    datasets: [{
                        label: 'Umsatz',
                        data: [0.0, 2.9, 10.8, 24.2, 42.3, 47.0, 48.8, 0.0, 0.0],
                        backgroundColor: '#9ca3af',
                        borderColor: '#6b7280',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '';
                                }
                            }
                        }
                    }
                }
            });
        }

        function initAbsatzChart() {
            const ctx = document.getElementById('absatz-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'],
                    datasets: [{
                        label: 'Absatz',
                        data: [0.0, 0.2, 1.1, 2.8, 5.5, 5.6, 5.6, 0.0, 0.0],
                        backgroundColor: '#9ca3af',
                        borderColor: '#6b7280',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function initDB2Chart() {
            const ctx = document.getElementById('db2-chart').getContext('2d');
            
            // Create combined chart with bars and line
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'],
                    datasets: [{
                        label: 'DB2',
                        data: [0.0, 1.0, 3.7, 8.5, 15.4, 17.1, 17.8, 0.0, 0.0],
                        backgroundColor: '#9ca3af',
                        borderColor: '#6b7280',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'DB2 %',
                        data: [0, 33, 34, 35, 36, 36, 36, 0, 0],
                        type: 'line',
                        borderColor: '#6b7280',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        yAxisID: 'y1',
                        pointStyle: 'circle',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 40,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        function initProjektkostenChart() {
            const ctx = document.getElementById('projektkosten-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'],
                    datasets: [{
                        label: 'Projektkosten',
                        data: [1.6, 2.5, 3.2, 2.9, 2.9, 3.1, 2.5, 0.0, 0.0],
                        backgroundColor: '#9ca3af',
                        borderColor: '#6b7280',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function initDB3JahrChart() {
            const ctx = document.getElementById('db3-jahr-chart').getContext('2d');
            
            // Create chart with percentage line
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'],
                    datasets: [{
                        label: 'DB3',
                        data: [-1.6, -1.6, 0.5, 5.6, 12.4, 14.0, 15.3, 0.0, 0.0],
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            return value < 0 ? '#ef4444' : '#9ca3af';
                        },
                        borderColor: '#6b7280',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'DB3 %',
                        data: [-54, -5, 23, 29, 30, 31, 0, 0, 0],
                        type: 'line',
                        borderColor: '#6b7280',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        yAxisID: 'y1',
                        pointStyle: 'circle',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left'
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        function initDB3KumuliertChart() {
            const ctx = document.getElementById('db3-kumuliert-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030', '2031', '2032'],
                    datasets: [{
                        label: 'DB3 kumuliert',
                        data: [-1.6, -3.1, -2.6, 3.0, 15.5, 29.4, 44.7, 44.7, 44.7],
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            return value < 0 ? '#ef4444' : '#9ca3af';
                        },
                        borderColor: '#6b7280',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>