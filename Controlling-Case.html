<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALBO Solutions - CFO Dashboard | Business Case Analyse</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #64748b;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --gray: #6b7280;
            --gray-light: #f8fafc;
            --border: #e5e7eb;
            --text: #1f2937;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-light);
            color: var(--text);
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 16px 24px;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 20px;
            font-weight: 600;
        }

        .subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 2px;
        }

        .header-stats {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 11px;
            opacity: 0.8;
            text-transform: uppercase;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .dashboard-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar {
            width: 400px;
            background: var(--white);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .ai-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-status-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .ai-metrics-panel {
            background: var(--white);
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .ai-metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 12px;
        }
        
        .ai-metric-label {
            color: var(--gray);
            font-weight: 500;
        }
        
        .ai-metric-value {
            font-weight: 600;
            color: var(--text);
        }
        
        .ai-metric-value.good {
            color: var(--success);
        }
        
        .ai-metric-value.warning {
            color: var(--warning);
        }
        
        .ai-metric-value.critical {
            color: var(--danger);
        }

        .tab-navigation {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            display: flex;
            padding: 0 24px;
        }

        .tab-btn {
            padding: 16px 24px;
            border: none;
            background: none;
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--primary);
            background: var(--gray-light);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--gray-light);
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .quick-controls {
            background: var(--white);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 24px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 150px;
        }

        .control-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray);
            text-transform: uppercase;
        }

        .control-slider {
            appearance: none;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            outline: none;
        }

        .control-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .control-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
            text-align: center;
        }

        .artikel-toggle {
            display: flex;
            gap: 8px;
        }

        .artikel-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .artikel-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .dashboard-main {
            padding: 24px;
            overflow-y: auto;
            height: calc(100vh - 150px);
        }

        .charts-row-top,
        .charts-row-middle,
        .charts-row-bottom {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-panel {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            min-height: 300px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .chart-info {
            font-size: 11px;
            color: var(--gray);
            background: var(--gray-light);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .chart-container {
            position: relative;
            height: 220px;
            flex: 1;
        }

        .chart-container-special {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .kumuliert-display {
            text-align: center;
            background: var(--gray-light);
            padding: 40px;
            border-radius: 8px;
            border: 2px solid var(--primary);
        }

        .kumuliert-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .kumuliert-label {
            font-size: 14px;
            color: var(--gray);
            font-weight: 600;
        }

        .projekte-panel {
            min-height: 300px;
        }

        .projekte-mini-table {
            flex: 1;
            font-size: 11px;
        }

        .projekt-row {
            display: grid;
            grid-template-columns: auto auto;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .projekt-row:last-child {
            border-bottom: none;
        }

        .projekt-col {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .projekt-label {
            font-weight: 600;
            color: var(--gray);
            padding: 4px 0;
        }

        .projekt-name {
            font-weight: 600;
            color: var(--text);
            font-size: 10px;
        }

        .projekt-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .projekt-value {
            padding: 4px 0;
            color: var(--text);
        }

        .projekt-value div {
            margin-bottom: 2px;
        }

        .amortisation-display {
            text-align: center;
            background: var(--gray-light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .amortisation-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 4px;
        }

        .amortisation-label {
            font-size: 12px;
            color: var(--gray);
            font-weight: 600;
        }

        .szenarien-box {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
        }

        .szenarien-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .szenarien-grid {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .szenario-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            font-size: 10px;
            padding: 2px 0;
        }

        .szenario-row span:first-child {
            color: var(--gray);
        }

        .szenario-row span:last-child {
            color: var(--text);
            font-weight: 600;
            background: var(--gray-light);
            padding: 2px 6px;
            border-radius: 3px;
            text-align: center;
        }

        .assumptions-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .assumptions-section {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .analysis-container {
            padding: 40px;
            text-align: center;
            color: var(--gray);
        }
        
        .artikel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .artikel-card {
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .artikel-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.15);
            transform: translateY(-2px);
        }

        .artikel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .artikel-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

        .artikel-effect {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .neu-produkt {
            background: #dbeafe;
            color: var(--primary);
        }

        .cross-selling {
            background: #dcfce7;
            color: var(--success);
        }

        .artikel-details {
            margin-bottom: 16px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 13px;
        }

        .detail-label {
            color: var(--gray);
            font-weight: 500;
        }

        .detail-value {
            color: var(--text);
            font-weight: 600;
        }

        .detail-value.success {
            color: var(--success);
        }

        .artikel-assumptions {
            background: var(--gray-light);
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            color: var(--gray);
            border-left: 3px solid var(--primary);
        }

        .add-artikel-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-artikel-btn:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }
        
        .artikel-detail-view {
            background: var(--white);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--primary);
        }

        .detail-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }

        .back-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .back-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .sub-tab-navigation {
            background: var(--gray-light);
            border-radius: 8px;
            padding: 4px;
            display: flex;
            margin-bottom: 24px;
        }

        .sub-tab-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: none;
            color: var(--gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .sub-tab-btn:hover {
            color: var(--primary);
        }

        .sub-tab-btn.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .ai-feed {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(to bottom, #f8fafc, #ffffff);
        }

        .ai-feed-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
            background: var(--white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .ai-message.success {
            border-left-color: var(--success);
            background: #f0fdf4;
        }

        .ai-message.warning {
            border-left-color: var(--warning);
            background: #fffbeb;
        }

        .ai-message.critical {
            border-left-color: var(--danger);
            background: #fef2f2;
        }

        .message-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text);
        }

        .message-text {
            font-size: 12px;
            line-height: 1.5;
            color: var(--gray);
        }

        .message-text strong {
            color: var(--text);
        }

        .message-actions {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .message-actions ul {
            margin: 4px 0 0 16px;
            font-size: 11px;
        }

        .message-timestamp {
            font-size: 10px;
            color: var(--gray);
            margin-top: 6px;
            opacity: 0.8;
        }

        .ai-actions {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: var(--gray-light);
        }

        .ai-action-btn {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 8px;
            border: 1px solid var(--border);
            background: var(--white);
            color: var(--gray);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-action-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--gray-light);
            transform: translateX(4px);
        }

        .ai-action-btn.primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        @media (max-width: 1400px) {
            .sidebar {
                width: 350px;
            }
        }

        @media (max-width: 1200px) {
            .charts-row-top,
            .charts-row-middle,
            .charts-row-bottom {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
            }
        }

        /* List View Styles */
.artikel-list-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow);
    margin-top: 20px;
}

.artikel-list-table {
    width: 100%;
    border-collapse: collapse;
}

.artikel-list-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
}

.artikel-list-header th {
    padding: 14px 16px;
    text-align: left;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-right: 1px solid rgba(255,255,255,0.1);
}

.artikel-list-header th:last-child {
    border-right: none;
}

.artikel-list-row {
    border-bottom: 1px solid var(--border);
    transition: all 0.2s;
    cursor: pointer;
}

.artikel-list-row:hover {
    background: #f8fafc;
    transform: translateX(2px);
}

.artikel-list-row td {
    padding: 16px;
    font-size: 13px;
    border-right: 1px solid #f1f3f5;
}

.artikel-list-row td:last-child {
    border-right: none;
}

.artikel-name-cell {
    font-weight: 600;
    color: var(--text);
}

.type-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.type-badge.neu {
    background: #dbeafe;
    color: #1e40af;
}

.type-badge.cross {
    background: #dcfce7;
    color: #059669;
}
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <div class="title">ALBO Solutions - Business Case Management</div>
                    <div class="subtitle">KI-gestützte Echtzeit-Analyse mit intelligenten Handlungsempfehlungen</div>
                </div>
                <div class="header-stats">
                    <div class="stat">
                        <div class="stat-value" id="npv-value">+44,7M€</div>
                        <div class="stat-label">NPV (9 Jahre)</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="payback-value">3,4J</div>
                        <div class="stat-label">Payback</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="revenue-value">117,8M€</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="margin-value">34%</div>
                        <div class="stat-label">Ø DB2-Marge</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            
            <!-- Dashboard Content -->
            <div class="dashboard-content">
                
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="switchTab('dashboard')">
                        📊 Dashboard
                    </button>
                    <button class="tab-btn" onclick="switchTab('assumptions')">
                        ⚙️ Annahmen bearbeiten
                    </button>
                    <button class="tab-btn" onclick="switchTab('analysis')">
                        📈 Analyse
                    </button>
                    <button class="tab-btn" onclick="switchTab('ai-agents')">
                        🤖 KI Agenten
                    </button>
                </div>
                
                <!-- Tab Content: Dashboard -->
                <div class="tab-content active" id="tab-dashboard">
                    <!-- Quick Controls -->
                    <div class="quick-controls">
                        <div class="control-section">
                            <span class="control-label">Marktvolumen</span>
                            <input type="range" class="control-slider" id="market-volume" 
                                   min="50" max="150" value="100" 
                                   onchange="adjustAssumption('market', this.value)">
                            <span class="control-value" id="market-value">100%</span>
                        </div>
                        
                        <div class="control-section">
                            <span class="control-label">Preis-Premium</span>
                            <input type="range" class="control-slider" id="price-premium" 
                                   min="80" max="120" value="100" 
                                   onchange="adjustAssumption('price', this.value)">
                            <span class="control-value" id="price-value">+0%</span>
                        </div>
                        
                        <div class="control-section">
                            <span class="control-label">CAPEX-Risiko</span>
                            <input type="range" class="control-slider" id="capex-risk" 
                                   min="80" max="130" value="100" 
                                   onchange="adjustAssumption('capex', this.value)">
                            <span class="control-value" id="capex-value">Plan</span>
                        </div>
                        
                        <div class="artikel-toggle">
                            <button class="artikel-btn active" onclick="toggleArtikel('all')">Alle</button>
                            <button class="artikel-btn" onclick="toggleArtikel('crimp')">Crimp</button>
                            <button class="artikel-btn" onclick="toggleArtikel('komax')">Komax</button>
                            <button class="artikel-btn" onclick="toggleArtikel('digital')">Digital</button>
                        </div>
                    </div>
                    
                    <!-- Main Dashboard - 6 Charts Layout -->
                    <div class="dashboard-main">
                        
                        <!-- Top Row: 3 Charts -->
                        <div class="charts-row-top">
                            <!-- Umsatz Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Umsatz</div>
                                    <div class="chart-info">in Mio. €</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="umsatz-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Absatz Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Absatz</div>
                                    <div class="chart-info">in T Stück</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="absatz-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- DB2 Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">DB 2*</div>
                                    <div class="chart-info">in Mio. € • *nach variablen Kosten</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="db2-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Middle Row: Projektkosten -->
                        <div class="charts-row-middle">
                            <!-- Projektkosten Jahres-Chart -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Projektkosten</div>
                                    <div class="chart-info">in Mio. €</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="projektkosten-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Projektkosten Kumuliert -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Projektkosten</div>
                                    <div class="chart-info">in Mio. €</div>
                                </div>
                                <div class="chart-container-special">
                                    <div class="kumuliert-display">
                                        <div class="kumuliert-value" id="kumuliert-value">18,8</div>
                                        <div class="kumuliert-label">kumuliert</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Projekte Table -->
                            <div class="chart-panel projekte-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Projekte</div>
                                </div>
                                <div class="projekte-mini-table">
                                    <div class="projekt-row">
                                        <div class="projekt-col">
                                            <div class="projekt-label">Projektstart</div>
                                            <div class="projekt-label">Projektende</div>
                                            <div class="projekt-label">Kosten [T€]</div>
                                        </div>
                                    </div>
                                    <div class="projekt-row">
                                        <div class="projekt-name">WCAR_V_BM | WCAR | Verdrahtung Best Match</div>
                                        <div class="projekt-details">
                                            <div class="projekt-value">Dez 24</div>
                                            <div class="projekt-value">-</div>
                                            <div class="projekt-value">
                                                <div>10.317</div>
                                                <div>785</div>
                                                <div>5.900</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="projekt-row">
                                        <div class="projekt-name">WCAR_V_Z | WCAR | Verdrahtung Zielzustand</div>
                                        <div class="projekt-details">
                                            <div class="projekt-value">-</div>
                                            <div class="projekt-value">-</div>
                                            <div class="projekt-value">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bottom Row: Wirtschaftlichkeit -->
                        <div class="charts-row-bottom">
                            <!-- DB3 pro Jahr -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">DB 3 pro Jahr**</div>
                                    <div class="chart-info">in Mio. €</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="db3-jahr-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- DB3 kumuliert -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">DB 3 kumuliert**</div>
                                    <div class="chart-info">in Mio. €</div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="db3-kumuliert-chart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Amortisation & Szenarien -->
                            <div class="chart-panel">
                                <div class="chart-header">
                                    <div class="chart-title">Amortisation***</div>
                                    <div class="chart-info">in Jahren</div>
                                </div>
                                <div class="amortisation-display">
                                    <div class="amortisation-value" id="amortisation-value">3,4</div>
                                    <div class="amortisation-label">Jahre</div>
                                </div>
                                
                                <div class="szenarien-box">
                                    <div class="szenarien-title">Szenarien****</div>
                                    <div class="szenarien-grid">
                                        <div class="szenario-row">
                                            <span>Preise</span>
                                            <span id="sz-price">+/-0%</span>
                                        </div>
                                        <div class="szenario-row">
                                            <span>Mengen</span>
                                            <span id="sz-volume">+/-0%</span>
                                        </div>
                                        <div class="szenario-row">
                                            <span>HK</span>
                                            <span id="sz-costs">+/-0%</span>
                                        </div>
                                        <div class="szenario-row">
                                            <span>Projektkosten</span>
                                            <span id="sz-capex">+/-0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Annahmen -->
                <div class="tab-content" id="tab-assumptions">
                    <div class="assumptions-container">
                        
                        <!-- Artikel Portfolio Overview (Hauptebene) -->
                        <div class="assumptions-section" id="artikel-overview">
                            <div class="section-title">📦 Artikel Portfolio - Erweiterte Ansicht</div>
                            
                        <div id="artikel-container-wrapper"></div>
                            <div class="artikel-grid" id="artikel-grid-container">
                                <!-- Crimpautomat -->
                                <div class="artikel-card" onclick="openArtikelDetail('crimp')">
                                    <div class="artikel-header">
                                        <div class="artikel-name">Crimpautomat</div>
                                        <div class="artikel-effect neu-produkt">Neu-Produkt</div>
                                    </div>
                                    <div class="artikel-details">
                                        <div class="detail-row">
                                            <span class="detail-label">Release:</span>
                                            <span class="detail-value">Dez 2024</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Peak Menge:</span>
                                            <span class="detail-value">5.000</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Start-Preis:</span>
                                            <span class="detail-value">5,00€</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Preis-Steigerung:</span>
                                            <span class="detail-value">+3% p.a.</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">DB2 (Ø):</span>
                                            <span class="detail-value success">37%</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Total Revenue:</span>
                                            <span class="detail-value success">87,2M€</span>
                                        </div>
                                    </div>
                                    <div class="artikel-assumptions">
                                        <strong>Annahmen:</strong> Innovation durch neue Linie
                                    </div>
                                </div>
                                
                                <!-- Mini-Komax -->
                                <div class="artikel-card" onclick="openArtikelDetail('komax')">
                                    <div class="artikel-header">
                                        <div class="artikel-name">Mini-Komax ohne CORE</div>
                                        <div class="artikel-effect neu-produkt">Neu-Produkt</div>
                                    </div>
                                    <div class="artikel-details">
                                        <div class="detail-row">
                                            <span class="detail-label">Release:</span>
                                            <span class="detail-value">Dez 2024</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Peak Menge:</span>
                                            <span class="detail-value">115</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Start-Preis:</span>
                                            <span class="detail-value">1.000,00€</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Preis-Steigerung:</span>
                                            <span class="detail-value">+2% p.a.</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">DB2 (Ø):</span>
                                            <span class="detail-value success">31%</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Total Revenue:</span>
                                            <span class="detail-value success">24,8M€</span>
                                        </div>
                                    </div>
                                    <div class="artikel-assumptions">
                                        <strong>Annahmen:</strong> Premium-Segment erschließen
                                    </div>
                                </div>
                                
                                <!-- Digital Shopfloor -->
                                <div class="artikel-card" onclick="openArtikelDetail('digital')">
                                    <div class="artikel-header">
                                        <div class="artikel-name">Digital Shopfloor Backend</div>
                                        <div class="artikel-effect cross-selling">Cross-Selling</div>
                                    </div>
                                    <div class="artikel-details">
                                        <div class="detail-row">
                                            <span class="detail-label">Release:</span>
                                            <span class="detail-value">Jun 2025</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Peak Menge:</span>
                                            <span class="detail-value">250</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Start-Preis:</span>
                                            <span class="detail-value">480,00€</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Preis-Steigerung:</span>
                                            <span class="detail-value">Fixpreis</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">DB2 (Ø):</span>
                                            <span class="detail-value success">58%</span>
                                        </div>
                                        <div class="detail-row">
                                            <span class="detail-label">Total Revenue:</span>
                                            <span class="detail-value success">5,8M€</span>
                                        </div>
                                    </div>
                                    <div class="artikel-assumptions">
                                        <strong>Annahmen:</strong> 40% Aufteilung mit Bestückung
                                    </div>
                                </div>
                            </div>
                            <!-- View Toggle Buttons -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 0 20px;">
                                <div style="display: flex; gap: 0; border: 1px solid var(--border); border-radius: 6px; overflow: hidden;">
                                    <button id="view-grid-btn" class="view-toggle active" onclick="setArtikelView('grid')" 
                                        style="padding: 8px 16px; border: none; background: var(--primary); color: white; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                                        ⊞ Karten
                                    </button>
                                    <button id="view-list-btn" class="view-toggle" onclick="setArtikelView('list')"
                                        style="padding: 8px 16px; border: none; border-left: 1px solid var(--border); background: white; color: var(--gray); font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                                    ☰ Liste
                                </button>
                            </div>
                            <span style="font-size: 13px; color: var(--gray);">
                                <span id="artikel-count">3</span> Artikel im Portfolio
                                </span>
                            </div>

                            <div style="text-align: center; margin-top: 20px;">
                                <button class="add-artikel-btn" onclick="addNewArtikel()">
                                    ➕ Neuer Artikel hinzufügen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Artikel Detail View mit Sub-Tabs (initially hidden) -->
                        <div class="artikel-detail-view" id="artikel-detail-view" style="display: none;">
                            
                            <!-- Detail Header mit Zurück-Button -->
                            <div class="detail-header">
                                <div class="detail-title">
                                    <span id="current-artikel-name">Artikel bearbeiten</span>
                                </div>
                                <button class="back-btn" onclick="backToArtikelOverview()">
                                    ← Zurück zur Artikel-Übersicht
                                </button>
                            </div>
                            
                            <!-- Sub-Tab Navigation -->
                            <div class="sub-tab-navigation">
                                <button class="sub-tab-btn active" onclick="switchSubTab('artikel')">
                                    📦 Artikel
                                </button>
                                <button class="sub-tab-btn" onclick="switchSubTab('projekte')">
                                    🏗️ Projekte
                                </button>
                                <button class="sub-tab-btn" onclick="switchSubTab('wirtschaftlichkeit')">
                                    💰 Wirtschaftlichkeit
                                </button>
                            </div>
                            
                            <!-- Sub-Tab Content Container -->
                            <div id="sub-tab-content-container"></div>
                            
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Analyse -->
                <div class="tab-content" id="tab-analysis">
                    <div class="analysis-container">
                        <div class="section-title">📈 Detaillierte Business Case Analyse</div>
                        <p>
                            Erweiterte Analyse-Features werden hier implementiert:<br>
                            • Sensitivitätsanalyse<br>
                            • Monte-Carlo-Simulation<br>
                            • Benchmark-Vergleiche<br>
                            • Risk Assessment
                        </p>
                    </div>
                </div>
                
                <!-- Tab Content: KI Agenten -->
                <div class="tab-content" id="tab-ai-agents">
                    <div style="padding: 30px; background: var(--white); border-radius: 12px; margin: 20px;">
                        <div class="section-title">🤖 KI Agenten Konfiguration</div>
                        <p>KI-Agenten Training und Konfiguration für automatisierte Analysen</p>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced KI Sidebar -->
            <div class="sidebar">
                <!-- KI Status Header -->
                <div class="ai-header">
                    <div class="ai-status">
                        <div class="ai-status-indicator"></div>
                        <span style="font-size: 14px; font-weight: 600;">KI-Controller aktiv</span>
                    </div>
                    <div style="font-size: 11px; opacity: 0.9; margin-top: 4px;">
                        Echtzeit-Analyse • 1.400+ Finance-Patterns • Industrie-Benchmarks
                    </div>
                </div>
                
                <!-- KI Metrics Panel -->
                <div class="ai-metrics-panel">
                    <div class="ai-metric-row">
                        <span class="ai-metric-label">Business Case Status:</span>
                        <span class="ai-metric-value good" id="bc-status">✓ Positiv</span>
                    </div>
                    <div class="ai-metric-row">
                        <span class="ai-metric-label">Risiko-Level:</span>
                        <span class="ai-metric-value warning" id="risk-level">Medium (68%)</span>
                    </div>
                    <div class="ai-metric-row">
                        <span class="ai-metric-label">Konfidenz-Score:</span>
                        <span class="ai-metric-value" id="confidence">78%</span>
                    </div>
                    <div class="ai-metric-row">
                        <span class="ai-metric-label">vs. Industrie-Benchmark:</span>
                        <span class="ai-metric-value good" id="benchmark">+12% besser</span>
                    </div>
                </div>
                
                <!-- KI Feed -->
                <div class="ai-feed" id="ai-feed">
                    <div class="ai-feed-title">
                        🤖 KI-Analyse & Empfehlungen
                    </div>
                </div>
                
                <!-- KI Actions -->
                <div class="ai-actions">
                    <button class="ai-action-btn primary" onclick="aiAction('deep-analysis')">
                        🔍 Deep Dive Analyse starten
                    </button>
                    <button class="ai-action-btn" onclick="aiAction('stress-test')">
                        🔬 Stress-Test Worst-Case
                    </button>
                    <button class="ai-action-btn" onclick="aiAction('sensitivity')">
                        📊 Sensitivitäts-Analyse
                    </button>
                    <button class="ai-action-btn" onclick="aiAction('benchmark')">
                        ⚖️ Industrie-Benchmark
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
// Enhanced Global dashboard data with KI intelligence
let cfoDashboard = {
    currentArtikel: null,
    artikelData: {},  // Store for all artikel data
    currentValues: {
        marketVolume: 100,
        pricePremium: 100,
        capexRisk: 100,
        npv: 44.7,
        payback: 3.4,
        revenue: 117.8,
        db2Margin: 34,
        capexTotal: 18.8
    },
    benchmarks: {
        db2Margin: { min: 25, target: 35, max: 45, industry: 32 },
        payback: { excellent: 2, good: 3, acceptable: 4, critical: 5, industry: 4.1 },
        capexVariance: { green: 10, yellow: 20, red: 30 },
        marketGrowth: { conservative: 5, moderate: 10, aggressive: 15 },
        npvROI: { min: 50, target: 150, excellent: 200 }
    },
    historicalData: {
        lastMarketVolume: 100,
        lastPricePremium: 100,
        lastCapexRisk: 100
    },
    aiController: {
        messageHistory: [],
        
        addAIMessage: function(message) {
            const container = document.getElementById('ai-feed');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${message.level || ''}`;
            
            // Create HTML for actions if present
            let actionsHTML = '';
            if (message.actions && message.actions.length > 0) {
                actionsHTML = '<div class="message-actions"><strong style="font-size: 11px;">Empfohlene Maßnahmen:</strong><ul>';
                message.actions.forEach(action => {
                    actionsHTML += `<li>${action}</li>`;
                });
                actionsHTML += '</ul></div>';
            }
            
            messageDiv.innerHTML = `
                <div class="message-title">${message.title || 'KI-Analyse'}</div>
                <div class="message-text">
                    ${message.text}
                    ${message.recommendation ? `<br><strong>Empfehlung:</strong> ${message.recommendation}` : ''}
                    ${message.impact ? `<br><strong>Impact:</strong> ${message.impact}` : ''}
                    ${actionsHTML}
                </div>
                <div class="message-timestamp">${message.timestamp || 'gerade eben'}</div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            // Store in history
            this.messageHistory.push({
                timestamp: new Date(),
                message: message
            });
        }
    }
};

// Tab switching functionality
function switchTab(tabName) {
    // Remove active class from all tabs and content
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    // Activate selected tab
    document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
    document.getElementById(`tab-${tabName}`).classList.add('active');
    
    // Add KI message about tab switch
    const aiMessages = {
        'dashboard': {
            title: '📊 Dashboard-Ansicht',
            text: 'Executive View aktiviert. Live-Charts und KPIs für schnelle Business Case Bewertung.',
            level: 'info'
        },
       'assumptions': {
    title: '⚙️ Annahmen-Modus',
    text: 'Artikel-Portfolio bereit zur Bearbeitung. Parameter-Anpassungen werden in Echtzeit berechnet.',
    level: 'success'
},
        'analysis': {
            title: '📈 Analyse-Modus',
            text: 'Deep-Analytics verfügbar. Sensitivität, Monte-Carlo und Benchmarks abrufbar.',
            level: 'info'
        }
    };
    
    if (aiMessages[tabName]) {
        cfoDashboard.aiController.addAIMessage({
            ...aiMessages[tabName],
            timestamp: 'Navigation'
        });
    }
}

// Bei assumptions Tab automatisch zur Listenansicht
if (tabName === 'assumptions') {
    setTimeout(() => {
        if (typeof setArtikelView === 'function') {
            setArtikelView('list');
        }
    }, 100);
}

// New Article Creation Functions
function addNewArtikel() {
    // Create new artikel dialog/modal
    const modalHTML = `
        <div id="new-artikel-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);">
                <h2 style="margin: 0 0 24px 0; color: var(--primary); font-size: 24px; font-weight: 600;">
                    ➕ Neuen Artikel anlegen
                </h2>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                        Artikel-Bezeichnung <span style="color: var(--danger);">*</span>
                    </label>
                    <input type="text" id="new-artikel-name" placeholder="z.B. Smart Sensor System" 
                           style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                            Effekt-Typ <span style="color: var(--danger);">*</span>
                        </label>
                        <select id="new-artikel-type" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                            <option value="neu">Neu-Produkt</option>
                            <option value="cross">Cross-Selling</option>
                            <option value="kannibalisierung">Kannibalisierung</option>
                            <option value="substitution">Substitution</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                            Release-Datum <span style="color: var(--danger);">*</span>
                        </label>
                        <input type="month" id="new-artikel-release" value="2025-01"
                               style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                            Start-Preis (€) <span style="color: var(--danger);">*</span>
                        </label>
                        <input type="text" id="new-artikel-price" placeholder="100,00" 
                               style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;"
                               onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                            Start-Menge <span style="color: var(--danger);">*</span>
                        </label>
                        <input type="text" id="new-artikel-volume" placeholder="1.000"
                               style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;"
                               onblur="formatNumberInput(this)">
                    </div>
                    
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                            HK/Stück (€) <span style="color: var(--danger);">*</span>
                        </label>
                        <input type="text" id="new-artikel-hk" placeholder="60,00"
                               style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;"
                               onblur="formatDecimalInput(this)">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                        Wachstumsstrategie
                    </label>
                    <select id="new-artikel-growth" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                        <option value="linear">Linear (konstantes Wachstum)</option>
                        <option value="s-curve" selected>S-Kurve (Marktdurchdringung)</option>
                        <option value="exponential">Exponentiell (virales Wachstum)</option>
                        <option value="plateau">Plateau (schnelle Sättigung)</option>
                        <option value="hockey-stick">Hockey-Stick (später Breakout)</option>
                        <option value="custom">Manuell definieren</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                        Preisstrategie
                    </label>
                    <select id="new-artikel-pricing" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                        <option value="fixed">Fixpreis</option>
                        <option value="inflation" selected>Inflationsanpassung (+2-3% p.a.)</option>
                        <option value="premium">Premium-Strategie (+5% p.a.)</option>
                        <option value="penetration">Penetration (sinkend)</option>
                        <option value="custom">Manuell definieren</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text);">
                        Annahmen & Begründung
                    </label>
                    <textarea id="new-artikel-assumptions" rows="3" placeholder="z.B. Innovation durch KI-Integration, Marktnische identifiziert..."
                              style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
                </div>
                
                <!-- Preview Section -->
                <div id="new-artikel-preview" style="padding: 16px; background: var(--gray-light); border-radius: 8px; margin-bottom: 20px; display: none;">
                    <h4 style="margin: 0 0 12px 0; color: var(--primary); font-size: 14px;">
                        📊 Vorschau Kennzahlen
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: bold; color: var(--success);" id="preview-db2">-</div>
                            <div style="font-size: 11px; color: var(--gray);">DB2-Marge</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: bold; color: var(--primary);" id="preview-revenue">-</div>
                            <div style="font-size: 11px; color: var(--gray);">Jahres-Umsatz</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 20px; font-weight: bold; color: var(--warning);" id="preview-contribution">-</div>
                            <div style="font-size: 11px; color: var(--gray);">DB2 absolut</div>
                        </div>
                    </div>
                </div>
                
                <div style="padding: 16px; background: #fef3c7; border-left: 4px solid var(--warning); border-radius: 4px; margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #92400e; margin-bottom: 4px;">
                        💡 KI-Empfehlung
                    </div>
                    <div style="font-size: 13px; color: #78716c;" id="ai-recommendation">
                        Neue Artikel sollten mindestens 30% DB2-Marge erreichen und zum strategischen Portfolio-Ausbau beitragen.
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeNewArtikelModal()" 
                            style="padding: 10px 20px; border: 1px solid var(--border); background: white; color: var(--gray); border-radius: 6px; cursor: pointer;">
                        Abbrechen
                    </button>
                    <button onclick="validateAndSaveNewArtikel()" 
                            style="padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
                        💾 Artikel anlegen
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // Insert modal into page
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Auto-calculate preview on input change
    const inputs = ['new-artikel-price', 'new-artikel-volume', 'new-artikel-hk'];
    inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', updateNewArtikelPreview);
    });
    
    // Focus first input
    document.getElementById('new-artikel-name').focus();
    
    // KI message
    cfoDashboard.aiController.addAIMessage({
        level: 'info',
        title: '➕ Artikel-Wizard geöffnet',
        text: 'Definieren Sie die Basis-Parameter für den neuen Artikel. Die KI unterstützt bei der Validierung.',
        recommendation: 'Starten Sie mit realistischen Annahmen - Optimierungen können später erfolgen.',
        timestamp: 'Artikel-Creation'
    });
}

function updateNewArtikelPreview() {
    const price = parseFormattedNumber(document.getElementById('new-artikel-price').value) || 0;
    const volume = parseFormattedNumber(document.getElementById('new-artikel-volume').value) || 0;
    const hk = parseFormattedNumber(document.getElementById('new-artikel-hk').value) || 0;
    
    if (price > 0 && volume > 0) {
        const revenue = price * volume;
        const costs = hk * volume;
        const db2Absolute = revenue - costs;
        const db2Margin = revenue > 0 ? (db2Absolute / revenue * 100) : 0;
        
        document.getElementById('new-artikel-preview').style.display = 'block';
        document.getElementById('preview-db2').textContent = db2Margin.toFixed(1) + '%';
        document.getElementById('preview-revenue').textContent = 
            revenue >= 1000000 ? (revenue/1000000).toFixed(1) + 'M€' :
            revenue >= 1000 ? (revenue/1000).toFixed(0) + 'k€' :
            revenue.toFixed(0) + '€';
        document.getElementById('preview-contribution').textContent = 
            db2Absolute >= 1000000 ? (db2Absolute/1000000).toFixed(1) + 'M€' :
            db2Absolute >= 1000 ? (db2Absolute/1000).toFixed(0) + 'k€' :
            db2Absolute.toFixed(0) + '€';
        
        // Update AI recommendation based on margin
        const aiRec = document.getElementById('ai-recommendation');
        if (db2Margin < 20) {
            aiRec.innerHTML = `<span style="color: var(--danger);">⚠️ Kritisch:</span> DB2-Marge ${db2Margin.toFixed(1)}% zu niedrig! Mindestens 25% erforderlich. Preis erhöhen oder HK senken.`;
        } else if (db2Margin < 30) {
            aiRec.innerHTML = `<span style="color: var(--warning);">⚡ Grenzwertig:</span> DB2-Marge ${db2Margin.toFixed(1)}% akzeptabel, aber Optimierung empfohlen für nachhaltigen Business Case.`;
        } else if (db2Margin > 50) {
            aiRec.innerHTML = `<span style="color: var(--success);">✅ Exzellent:</span> DB2-Marge ${db2Margin.toFixed(1)}% sehr stark! Premium-Positionierung möglich.`;
        } else {
            aiRec.innerHTML = `<span style="color: var(--success);">✅ Gut:</span> DB2-Marge ${db2Margin.toFixed(1)}% im Zielbereich. Solide Basis für profitables Wachstum.`;
        }
        
        // Color coding for DB2 display
        document.getElementById('preview-db2').style.color = 
            db2Margin >= 35 ? 'var(--success)' :
            db2Margin >= 25 ? 'var(--primary)' :
            'var(--danger)';
    }
}

function closeNewArtikelModal() {
    const modal = document.getElementById('new-artikel-modal');
    if (modal) {
        modal.remove();
    }
}

function validateAndSaveNewArtikel() {
    // Get all input values
    const name = document.getElementById('new-artikel-name').value.trim();
    const type = document.getElementById('new-artikel-type').value;
    const release = document.getElementById('new-artikel-release').value;
    const price = parseFormattedNumber(document.getElementById('new-artikel-price').value);
    const volume = parseFormattedNumber(document.getElementById('new-artikel-volume').value);
    const hk = parseFormattedNumber(document.getElementById('new-artikel-hk').value);
    const growth = document.getElementById('new-artikel-growth').value;
    const pricing = document.getElementById('new-artikel-pricing').value;
    const assumptions = document.getElementById('new-artikel-assumptions').value.trim();
    
    // Validation
    const errors = [];
    if (!name) errors.push('Artikel-Bezeichnung fehlt');
    if (!price || price <= 0) errors.push('Gültiger Preis erforderlich');
    if (!volume || volume <= 0) errors.push('Gültige Startmenge erforderlich');
    if (!hk || hk < 0) errors.push('Herstellkosten erforderlich');
    if (!release) errors.push('Release-Datum erforderlich');
    
    if (errors.length > 0) {
        alert('Bitte korrigieren Sie folgende Fehler:\n\n• ' + errors.join('\n• '));
        return;
    }
    
    // Calculate DB2 for validation
    const revenue = price * volume;
    const costs = hk * volume;
    const db2Margin = revenue > 0 ? ((revenue - costs) / revenue * 100) : 0;
    
    // Warning for low margin
    if (db2Margin < 25) {
        if (!confirm(`⚠️ Warnung: DB2-Marge nur ${db2Margin.toFixed(1)}%!\n\nArtikel mit Margen unter 25% gefährden den Business Case.\n\nTrotzdem fortfahren?`)) {
            return;
        }
    }
    
    // Generate unique artikel ID
    const artikelId = 'artikel-' + Date.now();
    
    // Create artikel data structure
    const newArtikelData = {
        id: artikelId,
        name: name,
        type: type,
        release: release,
        umsatzerhaltung: 'nein',
        assumptions: assumptions || `${type === 'neu' ? 'Neues Produkt' : 'Cross-Selling'} - ${growth} Wachstum`,
        strategy: pricing,
        hkProStueck: hk,
        startPrice: price,
        startVolume: volume,
        growthModel: growth,
        years: generateYearData(volume, price, growth, pricing, release)
    };
    
    // Store in dashboard data
    cfoDashboard.artikelData[artikelId] = newArtikelData;
    
    // Store in dashboard data
cfoDashboard.artikelData[artikelId] = newArtikelData;

// Close modal FIRST
closeNewArtikelModal();

// THEN add artikel card to overview (with small delay)
setTimeout(() => {
    addArtikelCardToOverview(newArtikelData);
    
    // Update dashboard metrics
    updateDashboardTotals();
}, 100);
    
    // Success message
    cfoDashboard.aiController.addAIMessage({
        level: 'success',
        title: '✅ Artikel erfolgreich angelegt',
        text: `"${name}" wurde mit DB2-Marge ${db2Margin.toFixed(1)}% zum Portfolio hinzugefügt.`,
        recommendation: db2Margin < 30 
            ? 'Marge optimieren für besseren Business Case Impact.' 
            : 'Artikel trägt positiv zum Gesamt-NPV bei.',
        actions: [
            'Dashboard-Charts aktualisieren',
            'Amortisation neu berechnen',
            'Portfolio-Mix validieren'
        ],
        timestamp: 'Artikel erstellt'
    });
}

function generateYearData(startVolume, startPrice, growthModel, pricingStrategy, releaseDate) {
    const years = {};
    const releaseYear = parseInt(releaseDate.split('-')[0]);
    const releaseMonth = parseInt(releaseDate.split('-')[1]);
    
    // Generate 6 years of data
    for (let i = 0; i < 6; i++) {
        const year = 2025 + i;
        let volume = 0;
        let price = startPrice;
        
        // Volume based on growth model
        if (year >= releaseYear) {
            const yearsSinceRelease = year - releaseYear;
            
            switch(growthModel) {
                case 'linear':
                    volume = startVolume * (1 + yearsSinceRelease * 0.2);
                    break;
                case 's-curve':
                    const t = yearsSinceRelease / 5;
                    const sigmoid = 1 / (1 + Math.exp(-10 * (t - 0.5)));
                    volume = startVolume * (1 + sigmoid * 4); // up to 5x growth
                    break;
                case 'exponential':
                    volume = startVolume * Math.pow(1.5, yearsSinceRelease);
                    break;
                case 'plateau':
                    volume = yearsSinceRelease < 2 ? startVolume * (1 + yearsSinceRelease) : startVolume * 3;
                    break;
                case 'hockey-stick':
                    volume = yearsSinceRelease < 2 ? startVolume : startVolume * Math.pow(2, yearsSinceRelease - 1);
                    break;
                default:
                    volume = startVolume;
            }
            
            // Adjust for partial first year
            if (year === releaseYear && releaseMonth > 1) {
                volume = volume * (13 - releaseMonth) / 12;
            }
            
            // Price based on pricing strategy
            switch(pricingStrategy) {
                case 'inflation':
                    price = startPrice * Math.pow(1.025, yearsSinceRelease);
                    break;
                case 'premium':
                    price = startPrice * Math.pow(1.05, yearsSinceRelease);
                    break;
                case 'penetration':
                    price = startPrice * Math.pow(0.95, yearsSinceRelease);
                    break;
                case 'fixed':
                default:
                    price = startPrice;
            }
        }
        
        years[year] = {
            volume: Math.round(volume),
            price: Math.round(price * 100) / 100
        };
    }
    
    return years;
}

function addArtikelCardToOverview(artikelData) {
    // Calculate total revenue and avg margin
    let totalRevenue = 0;
    let totalDB2 = 0;
    let yearsWithData = 0;
    let peakVolume = 0;
    
    Object.values(artikelData.years).forEach(year => {
        if (year.volume > 0) {
            const revenue = year.volume * year.price;
            const costs = year.volume * artikelData.hkProStueck;
            totalRevenue += revenue;
            totalDB2 += ((revenue - costs) / revenue * 100);
            yearsWithData++;
            if (year.volume > peakVolume) peakVolume = year.volume;
        }
    });
    
    const avgDB2 = yearsWithData > 0 ? (totalDB2 / yearsWithData) : 0;
    
    // Format release date
    const releaseDate = new Date(artikelData.release);
    const releaseFormatted = releaseDate.toLocaleDateString('de-DE', { month: 'short', year: 'numeric' });
    
    // Create card HTML
    const cardHTML = `
        <div class="artikel-card" onclick="openArtikelDetail('${artikelData.id}')">
            <div class="artikel-header">
                <div class="artikel-name">${artikelData.name}</div>
                <div class="artikel-effect ${artikelData.type === 'neu' ? 'neu-produkt' : 'cross-selling'}">
                    ${artikelData.type === 'neu' ? 'Neu-Produkt' : 
                      artikelData.type === 'cross' ? 'Cross-Selling' :
                      artikelData.type === 'kannibalisierung' ? 'Kannibalisierung' : 
                      'Substitution'}
                </div>
            </div>
            <div class="artikel-details">
                <div class="detail-row">
                    <span class="detail-label">Release:</span>
                    <span class="detail-value">${releaseFormatted}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Peak Menge:</span>
                    <span class="detail-value">${formatThousands(peakVolume)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Start-Preis:</span>
                    <span class="detail-value">${formatDecimal(artikelData.startPrice)}€</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Preis-Strategie:</span>
                    <span class="detail-value">${artikelData.strategy}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">DB2 (Ø):</span>
                    <span class="detail-value ${avgDB2 > 30 ? 'success' : ''}">${avgDB2.toFixed(1)}%</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Total Revenue:</span>
                    <span class="detail-value success">${
                        totalRevenue >= 1000000 ? (totalRevenue/1000000).toFixed(1) + 'M€' :
                        totalRevenue >= 1000 ? (totalRevenue/1000).toFixed(0) + 'k€' :
                        totalRevenue.toFixed(0) + '€'
                    }</span>
                </div>
            </div>
            <div class="artikel-assumptions">
                <strong>Annahmen:</strong> ${artikelData.assumptions}
            </div>
        </div>
    `;
    
    // Insert before "Add new" button
    const gridContainer = document.getElementById('artikel-grid-container');
    if (gridContainer) {
        gridContainer.insertAdjacentHTML('beforeend', cardHTML);
    }
}

function updateDashboardTotals() {
    // Recalculate all dashboard totals based on all articles
    let totalRevenue = 0;
    let totalNPV = 0;
    let avgMargin = 0;
    let artikelCount = 0;
    
    // Include existing articles
    const existingArticles = ['crimp', 'komax', 'digital'];
    // Plus new articles from artikelData
    
    // Update header metrics
    // This would normally recalculate based on all articles
    // For now, just add a small increment to show impact
    const currentNPV = parseFloat(document.getElementById('npv-value').textContent);
    const newNPV = currentNPV + 2.3; // Example increment
    document.getElementById('npv-value').textContent = '+' + newNPV.toFixed(1) + 'M€';
    
    // Re-run charts if needed
    if (typeof initializeCharts === 'function') {
        // Update chart data
    }
}

// View Management
let currentView = 'grid';

function setArtikelView(view) {
    currentView = view;
    
    // Update button states
    if (view === 'grid') {
        document.getElementById('view-grid-btn').style.background = 'var(--primary)';
        document.getElementById('view-grid-btn').style.color = 'white';
        document.getElementById('view-list-btn').style.background = 'white';
        document.getElementById('view-list-btn').style.color = 'var(--gray)';
        showGridView();
    } else {
        document.getElementById('view-list-btn').style.background = 'var(--primary)';
        document.getElementById('view-list-btn').style.color = 'white';
        document.getElementById('view-grid-btn').style.background = 'white';
        document.getElementById('view-grid-btn').style.color = 'var(--gray)';
        showListView();
    }
    
    // Save preference
    localStorage.setItem('artikelViewPreference', view);
}

function showGridView() {
    const wrapper = document.getElementById('artikel-container-wrapper');
    // For now, just reload to show grid
    location.reload();
}

function showListView() {
    const wrapper = document.getElementById('artikel-container-wrapper');
    
    // Collect all artikel data
    const artikels = [
        {
            name: 'Crimpautomat',
            type: 'NEU-PRODUKT',
            release: 'Dez 2024',
            startMenge: '200',
            startPreis: '5,00€',
            db2: '37%',
            revenue: '87,2M€'
        },
        {
            name: 'Mini-Komax ohne CORE',
            type: 'NEU-PRODUKT',
            release: 'Dez 2024',
            startMenge: '6',
            startPreis: '1.000,00€',
            db2: '31%',
            revenue: '24,8M€'
        },
        {
            name: 'Digital Shopfloor Backend',
            type: 'CROSS-SELLING',
            release: 'Jun 2025',
            startMenge: '50',
            startPreis: '480,00€',
            db2: '58%',
            revenue: '5,8M€'
        }
    ];
    
    // Add custom artikels from cfoDashboard
    Object.values(cfoDashboard.artikelData || {}).forEach(artikel => {
        artikels.push({
            name: artikel.name,
            type: artikel.type === 'neu' ? 'NEU-PRODUKT' : 'CROSS-SELLING',
            release: formatDateShort(artikel.release),
            startMenge: formatThousands(artikel.startVolume),
            startPreis: formatDecimal(artikel.startPrice) + '€',
            db2: '35%',
            revenue: calculateTotalRevenue(artikel)
        });
    });
    
    // Build list HTML
    let html = `
        <div class="artikel-list-container">
            <table class="artikel-list-table">
                <thead class="artikel-list-header">
                    <tr>
                        <th style="width: 25%;">Artikel</th>
                        <th style="width: 15%;">Typ</th>
                        <th style="width: 12%;">Release</th>
                        <th style="width: 12%; text-align: right;">Start-Menge</th>
                        <th style="width: 12%; text-align: right;">Start-Preis</th>
                        <th style="width: 10%; text-align: center;">DB2 (Ø)</th>
                        <th style="width: 14%; text-align: right;">Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    artikels.forEach((artikel, index) => {
        const typeClass = artikel.type.includes('NEU') ? 'neu' : 'cross';
        const db2Value = parseFloat(artikel.db2);
        const db2Color = db2Value >= 40 ? 'var(--success)' : db2Value >= 30 ? 'var(--primary)' : 'var(--warning)';
        
        html += `
            <tr class="artikel-list-row" onclick="openArtikelEditMode('${artikel.name.toLowerCase().replace(/ /g, '-')}')">
                <td class="artikel-name-cell">${artikel.name}</td>
                <td><span class="type-badge ${typeClass}">${artikel.type}</span></td>
                <td>${artikel.release}</td>
                <td style="text-align: right; font-family: monospace;">${artikel.startMenge}</td>
                <td style="text-align: right; font-family: monospace;">${artikel.startPreis}</td>
                <td style="text-align: center; font-weight: 600; color: ${db2Color};">${artikel.db2}</td>
                <td style="text-align: right; font-weight: 600; color: var(--success);">${artikel.revenue}</td>
            </tr>
        `;
    });
    
    html += `
                </tbody>
            </table>
        </div>
    `;
    
    wrapper.innerHTML = html;
    
    // Update count
    document.getElementById('artikel-count').textContent = artikels.length;
}

function formatDateShort(dateStr) {
    if (!dateStr) return '';
    const date = new Date(dateStr);
    const months = ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'];
    return months[date.getMonth()] + ' ' + date.getFullYear();
}

function calculateTotalRevenue(artikel) {
    let total = 0;
    if (artikel.years) {
        Object.values(artikel.years).forEach(year => {
            total += (year.volume * year.price);
        });
    }
    
    if (total >= 1000000) {
        return (total / 1000000).toFixed(1) + 'M€';
    } else if (total >= 1000) {
        return (total / 1000).toFixed(0) + 'k€';
    }
    return total.toFixed(0) + '€';
}
// Number formatting functions
function formatThousands(num) {
    if (!num && num !== 0) return '';
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function formatDecimal(num) {
    if (!num && num !== 0) return '';
    return num.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function parseFormattedNumber(str) {
    if (!str) return 0;
    return parseFloat(str.toString().replace(/\./g, '').replace(',', '.')) || 0;
}

function formatNumberInput(input) {
    const value = parseFormattedNumber(input.value);
    if (!isNaN(value)) {
        input.value = formatThousands(Math.round(value));
    }
}

function formatDecimalInput(input) {
    const value = parseFormattedNumber(input.value);
    if (!isNaN(value)) {
        input.value = formatDecimal(value);
    }
}

// Dashboard control functions
function adjustAssumption(type, value) {
    // Update display values
    switch(type) {
        case 'market':
            cfoDashboard.currentValues.marketVolume = parseInt(value);
            document.getElementById('market-value').textContent = value + '%';
            break;
        case 'price':
            cfoDashboard.currentValues.pricePremium = parseInt(value);
            const priceDiff = value - 100;
            document.getElementById('price-value').textContent = (priceDiff >= 0 ? '+' : '') + priceDiff + '%';
            break;
        case 'capex':
            cfoDashboard.currentValues.capexRisk = parseInt(value);
            const capexText = value > 110 ? 'Überschreitung' : value < 90 ? 'Einsparung' : 'Plan';
            document.getElementById('capex-value').textContent = capexText;
            break;
    }
}

function toggleArtikel(filter) {
    // Toggle artikel filter buttons
    document.querySelectorAll('.artikel-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Filter logic would go here
    console.log('Filter articles by:', filter);
}

function openArtikelDetail(artikelId) {
    console.log('Opening detail for artikel:', artikelId);
    
    cfoDashboard.currentArtikel = artikelId;
    
    // Hide overview and show detail view
    document.getElementById('artikel-overview').style.display = 'none';
    document.getElementById('artikel-detail-view').style.display = 'block';
    
    // Update title
    const artikelData = cfoDashboard.artikelData[artikelId];
    if (artikelData) {
        document.getElementById('current-artikel-name').textContent = artikelData.name;
    }
}

function backToArtikelOverview() {
    // Show overview and hide detail view
    document.getElementById('artikel-overview').style.display = 'block';
    document.getElementById('artikel-detail-view').style.display = 'none';
    
    // Automatisch zur Listenansicht wechseln
    setTimeout(() => setArtikelView('list'), 50);
    
    cfoDashboard.aiController.addAIMessage({
        level: 'info',
        title: '📋 Zurück zur Übersicht',
        text: 'Portfolio-Ansicht aktiviert. Alle Änderungen wurden gespeichert.',
        timestamp: 'Navigation'
    });
}

function openArtikelEditMode(artikelId) {
    // Mapping für Standard-Artikel
    const artikelMapping = {
        'crimpautomat': 'crimp',
        'mini-komax-ohne-core': 'komax',
        'digital-shopfloor-backend': 'digital'
    };
    
    const mappedId = artikelMapping[artikelId] || artikelId;
    
    // Öffne Detail-View
    cfoDashboard.currentArtikel = mappedId;
    
    // Verstecke Übersicht, zeige Detail
    document.getElementById('artikel-overview').style.display = 'none';
    document.getElementById('artikel-detail-view').style.display = 'block';
    
    // Update Titel
    const artikelName = artikelId.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    document.getElementById('current-artikel-name').textContent = artikelName;
    
    // Direkt zum Artikel-Tab (mit Mengen/Jahren)
    switchSubTab('artikel');
    
    // Lade Artikel-Daten
    loadArtikelData();
}

function switchSubTab(subTabName) {
    // Update button states
    document.querySelectorAll('.sub-tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[onclick="switchSubTab('${subTabName}')"]`).classList.add('active');
    
    // Load content based on sub-tab
    const container = document.getElementById('sub-tab-content-container');
    
    switch(subTabName) {
        case 'artikel':
            container.innerHTML = getArtikelTabContent();
            loadArtikelData();
            break;
        case 'projekte':
            container.innerHTML = getProjekteTabContent();
            break;
        case 'wirtschaftlichkeit':
            container.innerHTML = getWirtschaftlichkeitTabContent();
            break;
    }
    
    // KI Commentary
    const messages = {
        'artikel': {
            title: '📦 Artikel-Parameter',
            text: 'Preise, Mengen und Margen editierbar. Änderungen wirken sich direkt auf NPV aus.',
            recommendation: 'DB2-Marge sollte zwischen 25-45% liegen für nachhaltigen Business Case.'
        },
        'projekte': {
            title: '🏗️ Projekt-Kosten',
            text: 'CAPEX und OPEX über Jahre verteilt. Kritisch für Payback-Berechnung.',
            recommendation: 'CAPEX-Variance unter 20% halten für stabilen Business Case.'
        },
        'wirtschaftlichkeit': {
            title: '💰 Wirtschaftlichkeits-Analyse',
            text: 'Automatische DB3-Berechnung und Amortisations-Analyse basierend auf Artikel-Revenue und Projekt-Kosten.',
            recommendation: 'Payback sollte unter 4 Jahren liegen für Investment-Freigabe.'
        }
    };
    
    if (messages[subTabName]) {
        cfoDashboard.aiController.addAIMessage({
            level: 'info',
            ...messages[subTabName],
            timestamp: 'Sub-Tab'
        });
    }
}

function getArtikelTabContent() {
    return `
        <div style="padding: 20px;">
            <!-- Basis-Informationen Section -->
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 16px; font-weight: 600; color: var(--text); margin-bottom: 20px; padding-bottom: 8px; border-bottom: 1px solid var(--border);">
                    📋 Basis-Informationen
                </h3>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Artikel-Bezeichnung
                        </label>
                        <input type="text" id="edit-name" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Effekt-Typ
                        </label>
                        <select id="edit-type" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                            <option value="neu">Neu-Produkt</option>
                            <option value="cross">Cross-Selling</option>
                            <option value="kannibalisierung">Kannibalisierung</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Release-Datum
                        </label>
                        <input type="month" id="edit-release" value="2024-12" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Umsatzerhaltung
                        </label>
                        <select id="edit-umsatzerhaltung" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                            <option value="nein">Nein</option>
                            <option value="ja">Ja</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                        Annahmen & Basis für Abschätzung
                    </label>
                    <textarea id="edit-assumptions" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; min-height: 60px; resize: vertical;">Innovation durch neue Linie</textarea>
                </div>
            </div>
            
            <!-- Finanz-Parameter Section -->
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 16px; font-weight: 600; color: var(--text); margin-bottom: 20px; padding-bottom: 8px; border-bottom: 1px solid var(--border);">
                    💰 Finanz-Parameter
                </h3>
                
                <!-- Aktuelles Jahr Auswahl -->
                <div style="margin-bottom: 20px;">
                    <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                        Jahr auswählen
                    </label>
                    <select id="year-selector" style="width: 200px; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;" 
                            onchange="loadYearData(this.value)">
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027" selected>2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                    </select>
                </div>
                
                <!-- Parameter Grid für ausgewähltes Jahr -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 16px;">
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Menge (Stück)
                        </label>
                        <input type="text" id="param-menge" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; text-align: center;" 
                               onchange="formatNumberInput(this); calculateFinancials();" onblur="formatNumberInput(this)">
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Preis (€/Stück)
                        </label>
                        <input type="text" id="param-preis" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; text-align: center;" 
                               onchange="formatDecimalInput(this); calculateFinancials();" onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            HK pro Stück (€)
                        </label>
                        <input type="text" id="param-hk-stueck" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; text-align: center;" 
                               onchange="formatDecimalInput(this); updateHKProStueck(); calculateFinancials();" onblur="formatDecimalInput(this)">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            Umsatz (€)
                        </label>
                        <div id="param-umsatz" style="padding: 10px; background: var(--gray-light); border-radius: 6px; font-size: 13px; text-align: center; font-weight: 600; color: var(--primary); min-height: 38px; display: flex; align-items: center; justify-content: center;">
                            0€
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            HK gesamt (€)
                        </label>
                        <div id="param-hk-gesamt" style="padding: 10px; background: var(--gray-light); border-radius: 6px; font-size: 13px; text-align: center; font-weight: 600; color: var(--danger); min-height: 38px; display: flex; align-items: center; justify-content: center;">
                            0€
                        </div>
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; font-weight: 600; color: var(--gray); text-transform: uppercase; display: block; margin-bottom: 6px;">
                            DB2 (%)
                        </label>
                        <div id="param-db2" style="padding: 10px; background: var(--gray-light); border-radius: 6px; font-size: 16px; text-align: center; font-weight: 700; min-height: 38px; display: flex; align-items: center; justify-content: center;">
                            0%
                        </div>
                    </div>
                </div>
                
                <!-- Gesamt-KPIs -->
                <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                    <div style="background: white; border: 1px solid var(--border); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary);" id="total-revenue">0€</div>
                        <div style="font-size: 11px; color: var(--gray); text-transform: uppercase;">Total Revenue (6 Jahre)</div>
                    </div>
                    
                    <div style="background: white; border: 1px solid var(--border); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--success);" id="avg-margin">0%</div>
                        <div style="font-size: 11px; color: var(--gray); text-transform: uppercase;">Ø DB2-Marge</div>
                    </div>
                    
                    <div style="background: white; border: 1px solid var(--border); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: var(--warning);" id="peak-volume">0</div>
                        <div style="font-size: 11px; color: var(--gray); text-transform: uppercase;">Peak Absatz</div>
                    </div>
                </div>
            </div>
            
            <!-- Jahres-Entwicklung Section -->
            <div style="margin-bottom: 32px;">
                <h3 style="font-size: 16px; font-weight: 600; color: var(--text); margin-bottom: 20px; padding-bottom: 8px; border-bottom: 1px solid var(--border);">
                    📈 Jahres-Entwicklung
                </h3>
                
                <!-- Mengenmodelle Auswahl -->
                <div style="margin-bottom: 20px; padding: 16px; background: #f0f9ff; border-radius: 8px; border: 1px solid var(--primary-light);">
                    <div style="font-size: 12px; font-weight: 600; color: var(--text); margin-bottom: 12px;">
                        🎯 Mengenentwicklung - Mathematische Modelle
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;">
                        <button onclick="applyVolumeModel('linear')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            📊 Linear<br>
                            <span style="font-size: 9px; color: var(--gray);">Konstant</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('s-curve')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            📈 S-Kurve<br>
                            <span style="font-size: 9px; color: var(--gray);">Marktreife</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('exponential')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            🚀 Exponentiell<br>
                            <span style="font-size: 9px; color: var(--gray);">Viral</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('bell')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            🔔 Glockenkurve<br>
                            <span style="font-size: 9px; color: var(--gray);">Trend</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('plateau')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            📉 Plateau<br>
                            <span style="font-size: 9px; color: var(--gray);">Sättigung</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('hockey-stick')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            🏒 Hockey-Stick<br>
                            <span style="font-size: 9px; color: var(--gray);">Breakout</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('cyclical')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            🔄 Zyklisch<br>
                            <span style="font-size: 9px; color: var(--gray);">Saison</span>
                        </button>
                        
                        <button onclick="applyVolumeModel('custom')" style="padding: 8px 12px; border: 1px solid var(--border); background: white; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.borderColor='var(--primary)'; this.style.background='var(--gray-light)'"
                                onmouseout="this.style.borderColor='var(--border)'; this.style.background='white'">
                            ✏️ Manuell<br>
                            <span style="font-size: 9px; color: var(--gray);">Custom</span>
                        </button>
                    </div>
                    
                    <!-- Growth Metrics Display -->
                    <div style="margin-top: 12px; padding: 12px; background: white; border-radius: 6px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                        <div style="text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; color: var(--primary);" id="metric-cagr">0%</div>
                            <div style="font-size: 10px; color: var(--gray); text-transform: uppercase;">CAGR</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; color: var(--success);" id="metric-total-growth">0%</div>
                            <div style="font-size: 10px; color: var(--gray); text-transform: uppercase;">Total Wachstum</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; color: var(--warning);" id="metric-max-yoy">0%</div>
                            <div style="font-size: 10px; color: var(--gray); text-transform: uppercase;">Max YoY</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 18px; font-weight: bold; color: var(--text);" id="metric-volatility">0%</div>
                            <div style="font-size: 10px; color: var(--gray); text-transform: uppercase;">Volatilität</div>
                        </div>
                    </div>
                </div>
                
                <!-- Jahres-Boxen mit YoY Anzeige -->
                <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 16px;">
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary); text-align: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                            2025
                        </div>
                        <div id="yoy-2025" style="position: absolute; top: 8px; right: 8px; font-size: 9px; font-weight: bold; color: var(--success);">-</div>
                        <input type="text" id="year-2025-volume" placeholder="Menge" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 8px;"
                               onchange="formatNumberInput(this); calculateYearOverYear(); updateCalculations();" onblur="formatNumberInput(this)">
                        <input type="text" id="year-2025-price" placeholder="Preis" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center;"
                               onchange="formatDecimalInput(this); updateCalculations();" onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary); text-align: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                            2026
                        </div>
                        <div id="yoy-2026" style="position: absolute; top: 8px; right: 8px; font-size: 9px; font-weight: bold; color: var(--success);">-</div>
                        <input type="text" id="year-2026-volume" placeholder="Menge" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 8px;"
                               onchange="formatNumberInput(this); calculateYearOverYear(); updateCalculations();" onblur="formatNumberInput(this)">
                        <input type="text" id="year-2026-price" placeholder="Preis" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center;"
                               onchange="formatDecimalInput(this); updateCalculations();" onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary); text-align: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                            2027
                        </div>
                        <div id="yoy-2027" style="position: absolute; top: 8px; right: 8px; font-size: 9px; font-weight: bold; color: var(--success);">-</div>
                        <input type="text" id="year-2027-volume" placeholder="Menge" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 8px;"
                               onchange="formatNumberInput(this); calculateYearOverYear(); updateCalculations();" onblur="formatNumberInput(this)">
                        <input type="text" id="year-2027-price" placeholder="Preis" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center;"
                               onchange="formatDecimalInput(this); updateCalculations();" onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary); text-align: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                            2028
                        </div>
                        <div id="yoy-2028" style="position: absolute; top: 8px; right: 8px; font-size: 9px; font-weight: bold; color: var(--success);">-</div>
                        <input type="text" id="year-2028-volume" placeholder="Menge" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 8px;"
                               onchange="formatNumberInput(this); calculateYearOverYear(); updateCalculations();" onblur="formatNumberInput(this)">
                        <input type="text" id="year-2028-price" placeholder="Preis" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center;"
                               onchange="formatDecimalInput(this); updateCalculations();" onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary); text-align: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                            2029
                        </div>
                        <div id="yoy-2029" style="position: absolute; top: 8px; right: 8px; font-size: 9px; font-weight: bold; color: var(--success);">-</div>
                        <input type="text" id="year-2029-volume" placeholder="Menge" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 8px;"
                               onchange="formatNumberInput(this); calculateYearOverYear(); updateCalculations();" onblur="formatNumberInput(this)">
                        <input type="text" id="year-2029-price" placeholder="Preis" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center;"
                               onchange="formatDecimalInput(this); updateCalculations();" onblur="formatDecimalInput(this)">
                    </div>
                    
                    <div style="background: var(--gray-light); border-radius: 8px; padding: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--primary); text-align: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;">
                            2030
                        </div>
                        <div id="yoy-2030" style="position: absolute; top: 8px; right: 8px; font-size: 9px; font-weight: bold; color: var(--success);">-</div>
                        <input type="text" id="year-2030-volume" placeholder="Menge" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center; margin-bottom: 8px;"
                               onchange="formatNumberInput(this); calculateYearOverYear(); updateCalculations();" onblur="formatNumberInput(this)">
                        <input type="text" id="year-2030-price" placeholder="Preis" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 12px; text-align: center;"
                               onchange="formatDecimalInput(this); updateCalculations();" onblur="formatDecimalInput(this)">
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="padding: 20px 0; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="backToArtikelOverview()" style="padding: 10px 20px; border: 1px solid var(--border); background: var(--white); color: var(--gray); border-radius: 6px; font-size: 13px; cursor: pointer;">
                    Abbrechen
                </button>
                <button onclick="saveArtikelChanges()" style="padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer;">
                    💾 Alle Änderungen speichern
                </button>
            </div>
        </div>
    `;
}

function getProjekteTabContent() {
    return `
        <div style="padding: 20px; background: var(--gray-light); border-radius: 8px;">
            <h3 style="margin-bottom: 20px;">Projekt-Kosten Planung</h3>
            
            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
                <thead>
                    <tr style="background: var(--primary); color: white;">
                        <th style="padding: 12px; text-align: left;">Kategorie</th>
                        <th style="padding: 12px; text-align: center;">2024</th>
                        <th style="padding: 12px; text-align: center;">2025</th>
                        <th style="padding: 12px; text-align: center;">2026</th>
                        <th style="padding: 12px; text-align: center;">2027</th>
                        <th style="padding: 12px; text-align: center;">2028</th>
                        <th style="padding: 12px; text-align: center;">2029</th>
                        <th style="padding: 12px; text-align: center;">2030</th>
                        <th style="padding: 12px; text-align: center;">Gesamt</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">Personal</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">0</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">981</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">1.485</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">1.727</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">1.881</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">2.040</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">2.203</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center; font-weight: bold;">10.317</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border);">Material</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">0</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">83</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">105</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">128</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">142</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">156</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">171</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center; font-weight: bold;">785</td>
                    </tr>
                    <tr style="background: #fef3c7;">
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); font-weight: 600;">CAPEX</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center; font-weight: 600;">1.250</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">1.000</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">1.250</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">800</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">800</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">800</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center;">800</td>
                        <td style="padding: 12px; border-bottom: 1px solid var(--border); text-align: center; font-weight: bold;">6.700</td>
                    </tr>
                    <tr style="background: var(--primary); color: white;">
                        <td style="padding: 12px; font-weight: bold;">Gesamt</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">1.570</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">2.544</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">3.200</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">2.895</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">2.943</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">3.116</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">3.294</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">19.562</td>
                    </tr>
                </tbody>
            </table>
        </div>
    `;
}

function getWirtschaftlichkeitTabContent() {
    return `
        <div style="padding: 20px; background: var(--gray-light); border-radius: 8px;">
            <h3 style="margin-bottom: 20px;">💰 Wirtschaftlichkeitsberechnung & Amortisation</h3>
            
            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; margin-bottom: 20px;">
                <thead>
                    <tr style="background: var(--primary); color: white;">
                        <th style="padding: 12px; text-align: left;">Kennzahl</th>
                        <th style="padding: 12px; text-align: center;">2024</th>
                        <th style="padding: 12px; text-align: center;">2025</th>
                        <th style="padding: 12px; text-align: center;">2026</th>
                        <th style="padding: 12px; text-align: center;">2027</th>
                        <th style="padding: 12px; text-align: center;">2028</th>
                        <th style="padding: 12px; text-align: center;">2029</th>
                        <th style="padding: 12px; text-align: center;">2030</th>
                        <th style="padding: 12px; text-align: center;">Gesamt</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #dbeafe;">
                        <td style="padding: 12px;">📈 Umsatz (in T€)</td>
                        <td style="padding: 12px; text-align: center;">0</td>
                        <td style="padding: 12px; text-align: center;">2.900</td>
                        <td style="padding: 12px; text-align: center;">10.800</td>
                        <td style="padding: 12px; text-align: center;">24.200</td>
                        <td style="padding: 12px; text-align: center;">42.300</td>
                        <td style="padding: 12px; text-align: center;">47.000</td>
                        <td style="padding: 12px; text-align: center;">48.800</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold;">176.000</td>
                    </tr>
                    <tr>
                        <td style="padding: 12px;">⚙️ Herstellkosten (HK)</td>
                        <td style="padding: 12px; text-align: center;">0</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-1.900</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-7.200</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-15.800</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-27.500</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-30.600</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-31.800</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold; color: var(--danger);">-114.800</td>
                    </tr>
                    <tr style="background: #f0f9ff; font-weight: 600;">
                        <td style="padding: 12px;">= DB2 (nach variablen Kosten)</td>
                        <td style="padding: 12px; text-align: center;">0</td>
                        <td style="padding: 12px; text-align: center;">855</td>
                        <td style="padding: 12px; text-align: center;">3.060</td>
                        <td style="padding: 12px; text-align: center;">7.190</td>
                        <td style="padding: 12px; text-align: center;">12.685</td>
                        <td style="padding: 12px; text-align: center;">14.050</td>
                        <td style="padding: 12px; text-align: center;">14.560</td>
                        <td style="padding: 12px; text-align: center; color: var(--success);">52.400</td>
                    </tr>
                    <tr style="background: #fef3c7;">
                        <td style="padding: 12px;">🏗️ Projektkosten</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-1.570</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-2.544</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-3.200</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-2.895</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-2.943</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-3.116</td>
                        <td style="padding: 12px; text-align: center; color: var(--danger);">-3.294</td>
                        <td style="padding: 12px; text-align: center; font-weight: bold; color: var(--danger);">-19.562</td>
                    </tr>
                    <tr style="background: var(--primary); color: white; font-weight: bold;">
                        <td style="padding: 12px;">= DB3 (nach Projektkosten)</td>
                        <td style="padding: 12px; text-align: center;">-1.570</td>
                        <td style="padding: 12px; text-align: center;">-1.689</td>
                        <td style="padding: 12px; text-align: center;">-140</td>
                        <td style="padding: 12px; text-align: center;">4.295</td>
                        <td style="padding: 12px; text-align: center;">9.742</td>
                        <td style="padding: 12px; text-align: center;">10.934</td>
                        <td style="padding: 12px; text-align: center;">11.266</td>
                        <td style="padding: 12px; text-align: center;">32.838</td>
                    </tr>
                </tbody>
            </table>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div style="background: white; padding: 16px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 28px; font-weight: bold; color: var(--success);">3.2 Jahre</div>
                    <div style="font-size: 12px; color: var(--gray);">Payback-Zeit</div>
                    <div style="font-size: 11px; color: var(--gray); margin-top: 4px;">Break-Even in Q2/2027</div>
                </div>
                
                <div style="background: white; padding: 16px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 28px; font-weight: bold; color: var(--primary);">32.8M€</div>
                    <div style="font-size: 12px; color: var(--gray);">NPV (7 Jahre)</div>
                    <div style="font-size: 11px; color: var(--gray); margin-top: 4px;">ohne Diskontierung</div>
                </div>
                
                <div style="background: white; padding: 16px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 28px; font-weight: bold; color: var(--warning);">168%</div>
                    <div style="font-size: 12px; color: var(--gray);">ROI</div>
                    <div style="font-size: 11px; color: var(--gray); margin-top: 4px;">32.8M€ / 19.6M€</div>
                </div>
            </div>
            
            <div style="margin-top: 16px; padding: 16px; background: #f0fdf4; border-left: 4px solid var(--success); border-radius: 8px;">
                <div style="font-weight: bold; color: var(--success); margin-bottom: 8px;">✅ BUSINESS CASE POSITIV</div>
                <div style="font-size: 13px; color: var(--text);">
                    <strong>Empfehlung:</strong> Freigabe empfohlen.<br>
                    <strong>Kritisch:</strong> 3.4M€ Vorfinanzierung bis Break-Even.<br>
                    <strong>Risiko:</strong> Marktpenetration muss planmäßig erfolgen.
                </div>
            </div>
        </div>
    `;
}

function aiAction(action) {
    console.log('AI Action triggered:', action);
    
    cfoDashboard.aiController.addAIMessage({
        level: 'info',
        title: '🔍 ' + action.replace('-', ' ').toUpperCase(),
        text: 'Analyse wird durchgeführt...',
        timestamp: 'AI Action'
    });
}

// Initialize charts on page load
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    initializeAI();
});

// Additional helper functions for artikel editing
function loadArtikelData() {
    if (!cfoDashboard.currentArtikel) return;
    
    // Default data for example articles
    const artikelData = {
        'crimp': {
            name: 'Crimpautomat',
            type: 'neu',
            release: '2024-12',
            umsatzerhaltung: 'nein',
            assumptions: 'Innovation durch neue Linie',
            hkProStueck: 3.00,
            years: {
                2025: { volume: 200, price: 5.00 },
                2026: { volume: 1000, price: 5.15 },
                2027: { volume: 2500, price: 5.30 },
                2028: { volume: 5000, price: 5.46 },
                2029: { volume: 5000, price: 5.62 },
                2030: { volume: 5000, price: 5.79 }
            }
        },
        'komax': {
            name: 'Mini-Komax ohne CORE', 
            type: 'neu',
            release: '2024-12',
            umsatzerhaltung: 'nein',
            assumptions: 'Premium-Segment erschließen',
            hkProStueck: 670.00,
            years: {
                2025: { volume: 6, price: 1000.00 },
                2026: { volume: 14, price: 1020.00 },
                2027: { volume: 27, price: 1040.40 },
                2028: { volume: 42, price: 1061.21 },
                2029: { volume: 53, price: 1082.43 },
                2030: { volume: 53, price: 1104.08 }
            }
        },
        'digital': {
            name: 'Digital Shopfloor Backend',
            type: 'cross',
            release: '2025-06',
            umsatzerhaltung: 'ja',
            assumptions: '40% Aufteilung mit Bestückung',
            hkProStueck: 192.00,
            years: {
                2025: { volume: 50, price: 480.00 },
                2026: { volume: 150, price: 480.00 },
                2027: { volume: 200, price: 480.00 },
                2028: { volume: 250, price: 480.00 },
                2029: { volume: 250, price: 480.00 },
                2030: { volume: 200, price: 480.00 }
            }
        }
    };
    
    // Check if it's a custom artikel or default one
    const data = cfoDashboard.artikelData[cfoDashboard.currentArtikel] || artikelData[cfoDashboard.currentArtikel];
    
    if (data) {
        cfoDashboard.currentArtikelData = data; // Store for later use
        
        // Set basic fields
        if (document.getElementById('edit-name')) {
            document.getElementById('edit-name').value = data.name;
            document.getElementById('edit-type').value = data.type;
            document.getElementById('edit-release').value = data.release;
            document.getElementById('edit-umsatzerhaltung').value = data.umsatzerhaltung || 'nein';
            document.getElementById('edit-assumptions').value = data.assumptions;
            
            // Load year data with formatting
            for (let year = 2025; year <= 2030; year++) {
                const volumeInput = document.getElementById(`year-${year}-volume`);
                const priceInput = document.getElementById(`year-${year}-price`);
                
                if (volumeInput && data.years[year]) {
                    volumeInput.value = formatThousands(data.years[year].volume);
                }
                if (priceInput && data.years[year]) {
                    priceInput.value = formatDecimal(data.years[year].price);
                }
            }
            
            // Load financial parameters for selected year (default 2027)
            loadYearData('2027');
            
            // Calculate totals
            updateTotals();
        }
    }
}

// Load financial data for specific year
function loadYearData(year) {
    if (!cfoDashboard.currentArtikelData) return;
    
    const data = cfoDashboard.currentArtikelData;
    const yearData = data.years[year];
    
    if (yearData) {
        // Update parameter fields
        if (document.getElementById('param-menge')) {
            document.getElementById('param-menge').value = formatThousands(yearData.volume);
            document.getElementById('param-preis').value = formatDecimal(yearData.price);
            
            // Set HK pro Stück
            document.getElementById('param-hk-stueck').value = formatDecimal(data.hkProStueck);
            
            // Calculate financials
            calculateFinancials();
        }
    }
}

// Update HK pro Stück in data
function updateHKProStueck() {
    const hkProStueck = parseFormattedNumber(document.getElementById('param-hk-stueck')?.value) || 0;
    if (cfoDashboard.currentArtikelData) {
        cfoDashboard.currentArtikelData.hkProStueck = hkProStueck;
    }
}

// Calculate financial metrics
function calculateFinancials() {
    const menge = parseFormattedNumber(document.getElementById('param-menge')?.value) || 0;
    const preis = parseFormattedNumber(document.getElementById('param-preis')?.value) || 0;
    const hkProStueck = parseFormattedNumber(document.getElementById('param-hk-stueck')?.value) || 
                        cfoDashboard.currentArtikelData?.hkProStueck || 0;
    
    // Calculate metrics
    const umsatz = menge * preis;
    const hkGesamt = menge * hkProStueck;
    const db2Absolut = umsatz - hkGesamt;
    const db2Percent = umsatz > 0 ? (db2Absolut / umsatz * 100) : 0;
    
    // Update displays
    if (document.getElementById('param-umsatz')) {
        document.getElementById('param-umsatz').textContent = formatDecimal(umsatz) + '€';
    }
    
    if (document.getElementById('param-hk-gesamt')) {
        document.getElementById('param-hk-gesamt').textContent = formatDecimal(hkGesamt) + '€';
    }
    
    if (document.getElementById('param-db2')) {
        document.getElementById('param-db2').textContent = db2Percent.toFixed(1) + '%';
        // Color coding
        document.getElementById('param-db2').style.color = 
            db2Percent >= 35 ? 'var(--success)' : 
            db2Percent >= 25 ? 'var(--primary)' : 
            'var(--danger)';
    }
    
    // Update year data when changed
    const selectedYear = document.getElementById('year-selector')?.value;
    if (selectedYear) {
        const volumeInput = document.getElementById(`year-${selectedYear}-volume`);
        const priceInput = document.getElementById(`year-${selectedYear}-price`);
        if (volumeInput) volumeInput.value = formatThousands(menge);
        if (priceInput) priceInput.value = formatDecimal(preis);
    }
    
    // Update totals
    updateTotals();
}

// Update total calculations
function updateTotals() {
    if (!cfoDashboard.currentArtikelData) return;
    
    let totalRevenue = 0;
    let totalDB2 = 0;
    let peakVolume = 0;
    let yearsWithData = 0;
    
    const data = cfoDashboard.currentArtikelData;
    
    // Calculate totals from all years
    for (let year = 2025; year <= 2030; year++) {
        const volumeInput = document.getElementById(`year-${year}-volume`);
        const priceInput = document.getElementById(`year-${year}-price`);
        
        if (volumeInput && priceInput) {
            const volume = parseFormattedNumber(volumeInput.value) || 0;
            const price = parseFormattedNumber(priceInput.value) || 0;
            
            if (volume > 0 && price > 0) {
                const yearRevenue = volume * price;
                const yearHK = volume * data.hkProStueck;
                const yearDB2 = ((yearRevenue - yearHK) / yearRevenue * 100);
                
                totalRevenue += yearRevenue;
                totalDB2 += yearDB2;
                yearsWithData++;
                
                if (volume > peakVolume) {
                    peakVolume = volume;
                }
            }
        }
    }
    
    // Update display
    if (document.getElementById('total-revenue')) {
        if (totalRevenue >= 1000000) {
            document.getElementById('total-revenue').textContent = formatDecimal(totalRevenue / 1000000) + 'M€';
        } else if (totalRevenue >= 1000) {
            document.getElementById('total-revenue').textContent = formatDecimal(totalRevenue / 1000) + 'k€';
        } else {
            document.getElementById('total-revenue').textContent = formatDecimal(totalRevenue) + '€';
        }
    }
    
    if (document.getElementById('avg-margin')) {
        const avgMargin = yearsWithData > 0 ? (totalDB2 / yearsWithData) : 0;
        document.getElementById('avg-margin').textContent = avgMargin.toFixed(1) + '%';
        document.getElementById('avg-margin').style.color = 
            avgMargin >= 35 ? 'var(--success)' : 
            avgMargin >= 25 ? 'var(--primary)' : 
            'var(--danger)';
    }
    
    if (document.getElementById('peak-volume')) {
        document.getElementById('peak-volume').textContent = formatThousands(peakVolume);
    }
}

function updateCalculations() {
    calculateYearOverYear();
    updateTotals();
}

// Apply mathematical volume models
function applyVolumeModel(modelType) {
    // Get start volume from current first year or param-menge
    let startVolume = parseFormattedNumber(document.getElementById('year-2025-volume')?.value) || 
                     parseFormattedNumber(document.getElementById('param-menge')?.value) || 200;
    
    // Get peak volume
    let peakVolume = parseFormattedNumber(document.getElementById('peak-volume')?.textContent) || 5000;
    
    // If peak is less than start, auto-calculate reasonable peak
    if (peakVolume <= startVolume) {
        peakVolume = startVolume * 10; // Default 10x growth potential
    }
    
    let volumes = [];
    const years = [2025, 2026, 2027, 2028, 2029, 2030];
    
    switch(modelType) {
        case 'linear':
            const increment = (peakVolume - startVolume) / 5;
            for (let i = 0; i < 6; i++) {
                volumes.push(Math.round(startVolume + (increment * i)));
            }
            break;
            
        case 's-curve':
            for (let i = 0; i < 6; i++) {
                const t = i / 5;
                const sigmoid = 1 / (1 + Math.exp(-10 * (t - 0.5)));
                volumes.push(Math.round(startVolume + (peakVolume - startVolume) * sigmoid));
            }
            break;
            
        case 'exponential':
            const expGrowthRate = Math.pow(peakVolume / startVolume, 1/5);
            for (let i = 0; i < 6; i++) {
                const vol = startVolume * Math.pow(expGrowthRate, i);
                volumes.push(Math.min(Math.round(vol), peakVolume * 2));
            }
            break;
            
        case 'bell':
            const peakYear = 2.5; // Peak between year 3 and 4
            for (let i = 0; i < 6; i++) {
                const gaussian = Math.exp(-Math.pow(i - peakYear, 2) / 2);
                volumes.push(Math.round(startVolume + (peakVolume - startVolume) * gaussian));
            }
            break;
            
        case 'plateau':
            for (let i = 0; i < 6; i++) {
                if (i < 3) {
                    volumes.push(Math.round(startVolume + (peakVolume - startVolume) * (i / 2.5)));
                } else {
                    volumes.push(peakVolume);
                }
            }
            break;
            
        case 'hockey-stick':
            for (let i = 0; i < 6; i++) {
                if (i < 2) {
                    volumes.push(Math.round(startVolume * (1 + i * 0.1)));
                } else {
                    const explosiveGrowth = startVolume * 1.2 * Math.pow(2.5, i - 2);
                    volumes.push(Math.min(Math.round(explosiveGrowth), peakVolume));
                }
            }
            break;
            
        case 'cyclical':
            for (let i = 0; i < 6; i++) {
                const cycle = Math.sin(i * Math.PI / 2) * 0.3 + 0.7;
                volumes.push(Math.round(startVolume + (peakVolume - startVolume) * (i / 5) * cycle));
            }
            break;
            
        case 'custom':
            // Don't auto-fill
            return;
    }
    
    // Apply volumes to year inputs
    years.forEach((year, index) => {
        const volumeInput = document.getElementById(`year-${year}-volume`);
        if (volumeInput && volumes[index] !== undefined) {
            volumeInput.value = formatThousands(volumes[index]);
        }
    });
    
    // Calculate YoY and metrics
    calculateYearOverYear();
    
    // Add KI feedback
    cfoDashboard.aiController.addAIMessage({
        level: 'success',
        title: `📊 ${modelType.toUpperCase()} Modell angewendet`,
        text: `Volumenverlauf für ${volumes.length} Jahre generiert. Peak bei ${formatThousands(Math.max(...volumes))} Stück.`,
        recommendation: 'Prüfen Sie die Werte auf Plausibilität für Ihren Markt.',
        timestamp: 'Modell-Anwendung'
    });
}

// Calculate Year-over-Year growth
function calculateYearOverYear() {
    const years = [2025, 2026, 2027, 2028, 2029, 2030];
    let volumes = [];
    let yoyGrowths = [];
    
    // Collect volumes
    years.forEach(year => {
        const volume = parseFormattedNumber(document.getElementById(`year-${year}-volume`)?.value) || 0;
        volumes.push(volume);
    });
    
    // Calculate YoY for each year
    for (let i = 0; i < volumes.length; i++) {
        const yoyElement = document.getElementById(`yoy-${years[i]}`);
        if (yoyElement) {
            if (i === 0) {
                yoyElement.textContent = 'Start';
                yoyElement.style.color = 'var(--gray)';
            } else if (volumes[i] > 0 && volumes[i-1] > 0) {
                const yoyGrowth = ((volumes[i] - volumes[i-1]) / volumes[i-1] * 100);
                yoyGrowths.push(yoyGrowth);
                yoyElement.textContent = (yoyGrowth >= 0 ? '+' : '') + yoyGrowth.toFixed(0) + '%';
                
                // Color coding based on growth rate
                if (yoyGrowth > 100) {
                    yoyElement.style.color = 'var(--danger)'; // Red for unrealistic
                } else if (yoyGrowth > 50) {
                    yoyElement.style.color = 'var(--warning)'; // Orange for aggressive
                } else if (yoyGrowth > 0) {
                    yoyElement.style.color = 'var(--success)'; // Green for positive
                } else {
                    yoyElement.style.color = 'var(--danger)'; // Red for negative
                }
            } else {
                yoyElement.textContent = '-';
                yoyElement.style.color = 'var(--gray)';
            }
        }
    }
    
    // Calculate and display metrics
    if (volumes[0] > 0 && volumes[5] > 0) {
        // CAGR
        const cagr = (Math.pow(volumes[5] / volumes[0], 1/5) - 1) * 100;
        if (document.getElementById('metric-cagr')) {
            document.getElementById('metric-cagr').textContent = cagr.toFixed(1) + '%';
        }
        
        // Total Growth
        const totalGrowth = ((volumes[5] - volumes[0]) / volumes[0] * 100);
        if (document.getElementById('metric-total-growth')) {
            document.getElementById('metric-total-growth').textContent = totalGrowth.toFixed(0) + '%';
        }
        
        // Max YoY
        const maxYoy = yoyGrowths.length > 0 ? Math.max(...yoyGrowths) : 0;
        if (document.getElementById('metric-max-yoy')) {
            document.getElementById('metric-max-yoy').textContent = maxYoy.toFixed(0) + '%';
        }
        
        // Volatility
        const avgVolume = volumes.reduce((a,b) => a+b, 0) / volumes.length;
        const maxVolume = Math.max(...volumes);
        const minVolume = Math.min(...volumes.filter(v => v > 0));
        const volatility = avgVolume > 0 ? ((maxVolume - minVolume) / avgVolume * 100) : 0;
        if (document.getElementById('metric-volatility')) {
            document.getElementById('metric-volatility').textContent = volatility.toFixed(0) + '%';
        }
    }
    
    // Update totals
    updateTotals();
}

function saveArtikelChanges() {
    cfoDashboard.aiController.addAIMessage({
        level: 'success',
        title: '✅ Änderungen gespeichert',
        text: 'Artikel-Parameter aktualisiert. Dashboard-Charts werden neu berechnet.',
        recommendation: 'Prüfen Sie die Auswirkungen auf NPV und Payback im Dashboard.',
        timestamp: 'Speicherung'
    });
    
    // Here you would normally save the data back to the server
    // For now, just go back to overview
    backToArtikelOverview();
}

function initializeAI() {
    // Initial welcome message
    cfoDashboard.aiController.addAIMessage({
        level: 'success',
        title: '🚀 KI-Controller aktiviert',
        text: 'System bereit. Business Case WCAR geladen: NPV +44.7M€, Payback 3.4J, DB2 34%.',
        recommendation: 'Verwenden Sie "Neuer Artikel hinzufügen" um das Portfolio zu erweitern.',
        timestamp: 'System-Start'
    });
}

function initializeCharts() {
    // Initialize all 6 charts
    initUmsatzChart();
    initAbsatzChart();
    initDB2Chart();
    initProjektkostenChart();
    initDB3JahrChart();
    initDB3KumuliertChart();
}

function initUmsatzChart() {
    const ctx = document.getElementById('umsatz-chart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
            datasets: [{
                label: 'Umsatz',
                data: [0.0, 2.9, 10.8, 24.2, 42.3, 47.0, 48.8],
                backgroundColor: '#9ca3af',
                borderColor: '#6b7280',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + '';
                        }
                    }
                }
            }
        }
    });
}

function initAbsatzChart() {
    const ctx = document.getElementById('absatz-chart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
            datasets: [{
                label: 'Absatz',
                data: [0.0, 0.2, 1.1, 2.8, 5.5, 5.6, 5.6],
                backgroundColor: '#9ca3af',
                borderColor: '#6b7280',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function initDB2Chart() {
    const ctx = document.getElementById('db2-chart').getContext('2d');
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
            datasets: [{
                label: 'DB2',
                data: [0.0, 1.0, 3.7, 8.5, 15.4, 17.1, 17.8],
                backgroundColor: '#9ca3af',
                borderColor: '#6b7280',
                borderWidth: 1,
                yAxisID: 'y'
            }, {
                label: 'DB2 %',
                data: [0, 33, 34, 35, 36, 36, 36],
                type: 'line',
                borderColor: '#6b7280',
                backgroundColor: 'transparent',
                borderWidth: 2,
                yAxisID: 'y1',
                pointStyle: 'circle',
                pointRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    beginAtZero: true
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    beginAtZero: true,
                    max: 40,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    },
                    grid: {
                        drawOnChartArea: false,
                    },
                }
            }
        }
    });
}

function initProjektkostenChart() {
    const ctx = document.getElementById('projektkosten-chart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
            datasets: [{
                label: 'Projektkosten',
                data: [1.6, 2.5, 3.2, 2.9, 2.9, 3.1, 2.5],
                backgroundColor: '#9ca3af',
                borderColor: '#6b7280',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function initDB3JahrChart() {
    const ctx = document.getElementById('db3-jahr-chart').getContext('2d');
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
            datasets: [{
                label: 'DB3',
                data: [-1.6, -1.6, 0.5, 5.6, 12.4, 14.0, 15.3],
                backgroundColor: function(context) {
                    const value = context.parsed.y;
                    return value < 0 ? '#ef4444' : '#9ca3af';
                },
                borderColor: '#6b7280',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left'
                }
            }
        }
    });
}

function initDB3KumuliertChart() {
    const ctx = document.getElementById('db3-kumuliert-chart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2024', '2025', '2026', '2027', '2028', '2029', '2030'],
            datasets: [{
                label: 'DB3 kumuliert',
                data: [-1.6, -3.1, -2.6, 3.0, 15.5, 29.4, 44.7],
                backgroundColor: function(context) {
                    const value = context.parsed.y;
                    return value < 0 ? '#ef4444' : '#9ca3af';
                },
                borderColor: '#6b7280',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: false
                }
            }
        }
    });
}
    </script>
</body>
</html>
